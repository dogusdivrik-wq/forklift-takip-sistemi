<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forklift BakÄ±m Sistemi Pro</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* OPUS DESIGN SYSTEM */
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e1a;--card:#131825;--border:#1e293b;--inp:#0f172a;--text:#e2e8f0;--dim:#94a3b8;--mute:#64748b;--dark:#475569;--amber:#f59e0b;--red:#ef4444;--green:#22c55e;--blue:#3b82f6;--cyan:#06b6d4;--pink:#ec4899}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.btn{padding:10px 16px;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-weight:700;font-size:13px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .15s}
.btn:active{transform:scale(.97)}
.btn-amber{background:var(--amber);color:#000}.btn-red{background:var(--red);color:#fff}
.btn-green{background:var(--green);color:#000}.btn-blue{background:var(--blue);color:#fff}
.btn-cyan{background:var(--cyan);color:#000}.btn-pink{background:var(--pink);color:#fff}
.btn-ghost{background:transparent;color:var(--dim);border:1px solid var(--border)}
.btn-sm{padding:6px 10px;font-size:11px;border-radius:6px}
.btn-xs{padding:4px 8px;font-size:10px;border-radius:5px}
.btn-dng{background:transparent;color:var(--red);border:1px solid #ef444440}
.inp{width:100%;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:13px;outline:none;color:white;}
.inp:focus{border-color:var(--amber)}.inp::placeholder{color:var(--dark)}
select.inp{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%2394a3b8' d='M5 7L1 3h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px}
textarea.inp{resize:vertical;min-height:80px}
.lbl{font-size:11px;color:var(--mute);font-weight:600;margin-bottom:4px;display:block;letter-spacing:.3px;text-transform:uppercase;}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.mono{font-family:'JetBrains Mono',monospace}
.tabs{display:flex;gap:4px;background:var(--inp);border-radius:10px;padding:4px;border:1px solid var(--border);overflow-x:auto;}
.tab{flex:1;padding:8px 6px;text-align:center;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;color:var(--dim);transition:all .2s;user-select:none;white-space:nowrap;}
.tab.active{background:var(--amber);color:#000}
.chk-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;cursor:pointer;user-select:none}
.chk-item.done{border-color:#22c55e25;background:#22c55e08}
.chkbox{width:20px;height:20px;border-radius:5px;border:2px solid var(--dark);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chkbox.done{background:var(--green);border-color:var(--green)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.g-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;backdrop-filter:blur(3px);}
.mbody{max-width:550px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.5);}
.prog{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:8px}
.pfill{height:100%;border-radius:3px;transition:width .4s ease}
.mcard{padding:14px;background:var(--inp);border-radius:10px;border-left:3px solid}
.dr{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.dr:last-child{border-bottom:none}
.dl{color:var(--mute);min-width:110px;font-weight:600;flex-shrink:0}
.dv{color:var(--text);flex:1}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--green);color:#000;padding:12px 24px;border-radius:12px;font-weight:700;font-size:14px;z-index:2000;box-shadow:0 4px 20px #22c55e40}
.loading-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 3000; color: white; flex-direction: column; gap: 15px; backdrop-filter: blur(5px); font-weight:700;}
.fl-filter-chip{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;user-select:none;border:1px solid var(--border);background:var(--inp);color:var(--dim);transition:all .2s;white-space:nowrap}
.fl-filter-chip.active{border-color:var(--amber);background:#f59e0b18;color:var(--amber)}
.fuel-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700}
.fuel-badge.electric{background:#a855f720;color:#c084fc;border:1px solid #a855f730}
.fuel-badge.diesel{background:#64748b20;color:#94a3b8;border:1px solid #64748b30}
.fuel-badge.gasoline{background:#f59e0b20;color:#fbbf24;border:1px solid #f59e0b30}
.fuel-badge.lpg{background:#f9731620;color:#fb923c;border:1px solid #f9731630}
.fuel-badge.hybrid{background:#22c55e20;color:#4ade80;border:1px solid #22c55e30}
.tp-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;background:#06b6d420;color:#22d3ee;border:1px solid #06b6d430}
.st-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;background:#ec489920;color:#f472b6;border:1px solid #ec489930}
@media(max-width:600px){.grid-2{grid-template-columns:1fr}.g-auto{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="app"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo,useRef,memo}=React;

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby29FSo8URGOLlHAkNUevL1SCwXtzR83Tttal0fiYluGfiNy8qYpEtu5CFokt1kRu0O/exec";

/* DEFAULT LÄ°STELER - STANDART (Dizel/Benzinli/LPG/Hibrit) */
const DEF_M250=["Motor yaÄŸÄ± seviyesini kontrol et", "YaÄŸ filtresi", "Hava filtresi", "Hidrolik yaÄŸ seviyesi", "Fren hidroliÄŸi", "Lastik basÄ±nÃ§larÄ±", "Zincir gerginliÄŸi", "Ã‡atal aÅŸÄ±nmasÄ±", "Gres yaÄŸlama", "Hidrolik hortumlar", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Egzoz sistemi", "IÅŸÄ±klar ve Korna", "Emniyet kemeri", "El freni"];
const DEF_M500=["Motor yaÄŸÄ± deÄŸiÅŸimi", "YaÄŸ filtresi deÄŸiÅŸimi", "Hava filtresi deÄŸiÅŸimi", "YakÄ±t filtresi", "Hidrolik yaÄŸ deÄŸiÅŸimi", "Hidrolik filtre", "Diferansiyel yaÄŸÄ±", "Fren balatalarÄ±", "AsansÃ¶r rulmanlarÄ±", "Motor takozlarÄ±", "AlternatÃ¶r kayÄ±ÅŸÄ±", "SoÄŸutma sistemi", "Bujiler/EnjektÃ¶rler", "TÃ¼m contalar"];
const DEF_M2000=["Motor komple bakÄ±m", "ÅanzÄ±man yaÄŸÄ± deÄŸiÅŸimi", "ÅanzÄ±man filtresi", "Diferansiyel komple bakÄ±m", "Hidrolik sistem komple bakÄ±m", "Hidrolik pompa kontrolÃ¼", "Hidrolik silindir contalarÄ±", "Direksiyon sistemi komple", "Fren sistemi komple revizyon", "Ã–n aks/Arka aks kontrolÃ¼", "AsansÃ¶r zinciri deÄŸiÅŸimi", "Ã‡atal kontrol/deÄŸiÅŸim", "TÃ¼m rulmanlar kontrol", "Elektrik sistemi komple kontrol", "MarÅŸ motoru/AlternatÃ¶r kontrol", "RadyatÃ¶r temizlik/kontrol", "Egzoz sistemi komple", "TÃ¼m hortum ve kelepÃ§eler", "Kabin/Koruma kafesi kontrol", "Genel test ve kalibrasyon"];
const DEF_WCHK=["Ã‡alÄ±ÅŸma saati", "Motor yaÄŸÄ±", "SoÄŸutma suyu", "Hidrolik yaÄŸ", "Fren testi", "Direksiyon testi", "Ã‡atallar", "Lastikler", "AydÄ±nlatma", "Korna", "Emniyet kemeri", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Genel temizlik"];

/* DEFAULT LÄ°STELER - ELEKTRÄ°KLÄ° */
const DEF_EM250=["Batarya su seviyesi kontrolÃ¼", "Batarya kutup baÅŸlarÄ± temizliÄŸi", "Åarj sistemi kontrolÃ¼", "Hidrolik yaÄŸ seviyesi", "Fren hidroliÄŸi", "Lastik basÄ±nÃ§larÄ±", "Zincir gerginliÄŸi", "Ã‡atal aÅŸÄ±nmasÄ±", "Gres yaÄŸlama", "Hidrolik hortumlar", "SÄ±zÄ±ntÄ± kontrolÃ¼", "IÅŸÄ±klar ve Korna", "Emniyet kemeri", "El freni"];
const DEF_EM500=["Batarya yoÄŸunluk testi", "Batarya baÄŸlantÄ± kontrolÃ¼", "Åarj cihazÄ± kontrolÃ¼", "Hidrolik yaÄŸ deÄŸiÅŸimi", "Hidrolik filtre", "Fren balatalarÄ±", "AsansÃ¶r rulmanlarÄ±", "Motor fÄ±rÃ§alarÄ± kontrolÃ¼", "KontaktÃ¶r kontrolÃ¼", "Kablolama kontrolÃ¼", "TÃ¼m contalar"];
const DEF_EM2000=["Batarya kapasite testi", "Batarya komple kontrol", "Elektrik motoru komple bakÄ±m", "Motor fÄ±rÃ§alarÄ± deÄŸiÅŸimi", "Kontrol Ã¼nitesi (controller) bakÄ±m", "Hidrolik sistem komple bakÄ±m", "Hidrolik pompa kontrolÃ¼", "Hidrolik silindir contalarÄ±", "Direksiyon sistemi komple", "Fren sistemi komple revizyon", "Ã–n aks/Arka aks kontrolÃ¼", "AsansÃ¶r zinciri deÄŸiÅŸimi", "Ã‡atal kontrol/deÄŸiÅŸim", "TÃ¼m rulmanlar kontrol", "TÃ¼m kablolar ve konnektÃ¶rler", "TÃ¼m hortum ve kelepÃ§eler", "Kabin/Koruma kafesi kontrol", "Genel test ve kalibrasyon"];
const DEF_EWCHK=["Ã‡alÄ±ÅŸma saati", "Batarya su seviyesi", "Batarya ÅŸarj durumu", "Hidrolik yaÄŸ", "Fren testi", "Direksiyon testi", "Ã‡atallar", "Lastikler", "AydÄ±nlatma", "Korna", "Emniyet kemeri", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Genel temizlik"];

/* DEFAULT LÄ°STELER - ELEKTRÄ°KLÄ° TRANSPALET & Ä°STÄ°F MAKÄ°NESÄ° */
const DEF_TP_MONTHLY=["Batarya su seviyesi", "Batarya kutup baÅŸlarÄ± temizliÄŸi", "Åarj cihazÄ± kontrolÃ¼", "Batarya ÅŸarj durumu", "Tekerlekler ve rulmanlar", "Ã‡atal durumu ve aÅŸÄ±nma", "Hidrolik yaÄŸ seviyesi", "Hidrolik sÄ±zÄ±ntÄ± kontrolÃ¼", "KaldÄ±rma/indirme testi", "Kumanda kolu Ã§alÄ±ÅŸmasÄ±", "Fren sistemi testi", "Korna ve uyarÄ± sesleri", "GÃ¶vde ve ÅŸase kontrolÃ¼", "Kablo ve konnektÃ¶r kontrolÃ¼", "Genel temizlik"];
const DEF_ST_MONTHLY=["Batarya durumu kontrolÃ¼", "Hidrolik lift silindir sÄ±zÄ±ntÄ± kontrolÃ¼", "YÃ¼rÃ¼yÃ¼ÅŸ ve kaldÄ±rma motoru testi", "Frenlerin tutuÅŸ durumu", "Tekerlek aÅŸÄ±nma kontrolÃ¼", "Acil stop butonu kontrolÃ¼", "YÃ¼k korkuluÄŸu ve ÅŸase kontrolÃ¼", "Kablolama gÃ¶zle kontrol", "Korna ve uyarÄ± lambalarÄ±", "Kumanda paneli tuÅŸ fonksiyonlarÄ±"];

const FUELS=[{v:"diesel",l:"Dizel",e:"â›½"},{v:"gasoline",l:"Benzinli",e:"â›½"},{v:"lpg",l:"LPG",e:"ğŸ”¥"},{v:"electric",l:"Elektrikli",e:"âš¡"},{v:"hybrid",l:"Hibrit",e:"ğŸ”‹"}];
const PRIO={low:{l:"DÃ¼ÅŸÃ¼k",c:"#60a5fa"},normal:{l:"Normal",c:"#fbbf24"},high:{l:"YÃ¼ksek",c:"#f97316"},critical:{l:"Kritik",c:"#ef4444"}};

const uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);
const fd=d=>d?new Date(d).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”";
const gf=t=>FUELS.find(f=>f.v===t)||{v:"diesel",l:"Dizel",e:"â›½"};
const isElectric = (fuel) => fuel === "electric";

/* LÄ°STE YÃ–NETÄ°MÄ° (LocalStorage) */
const getSavedLists = () => {
Â  Â  const s = localStorage.getItem("opus_lists");
Â  Â  if(s) {
Â  Â  Â  Â  const parsed = JSON.parse(s);
Â  Â  Â  Â  if(!parsed.m2000) parsed.m2000 = DEF_M2000;
Â  Â  Â  Â  if(!parsed.em250) parsed.em250 = DEF_EM250;
Â  Â  Â  Â  if(!parsed.em500) parsed.em500 = DEF_EM500;
Â  Â  Â  Â  if(!parsed.em2000) parsed.em2000 = DEF_EM2000;
Â  Â  Â  Â  if(!parsed.eweekly) parsed.eweekly = DEF_EWCHK;
Â  Â  Â  Â  if(!parsed.tp_monthly) parsed.tp_monthly = DEF_TP_MONTHLY;
Â  Â  Â  Â  if(!parsed.st_monthly) parsed.st_monthly = DEF_ST_MONTHLY;
Â  Â  Â  Â  return parsed;
Â  Â  }
Â  Â  return { m250: DEF_M250, m500: DEF_M500, m2000: DEF_M2000, weekly: DEF_WCHK, em250: DEF_EM250, em500: DEF_EM500, em2000: DEF_EM2000, eweekly: DEF_EWCHK, tp_monthly: DEF_TP_MONTHLY, st_monthly: DEF_ST_MONTHLY };
};

const getFuelTypes = () => JSON.parse(localStorage.getItem("opus_fuel_types") || "{}");
const saveFuelType = (flId, fuelType) => {
Â  Â  const ft = getFuelTypes();
Â  Â  ft[flId] = fuelType;
Â  Â  localStorage.setItem("opus_fuel_types", JSON.stringify(ft));
};
const getFuelType = (flId) => getFuelTypes()[flId] || "diesel";

const getListForType = (lists, maintType, fuelType) => {
Â  Â  const elc = isElectric(fuelType);
Â  Â  switch(maintType) {
Â  Â  Â  Â  case 'm250': return elc ? lists.em250 : lists.m250;
Â  Â  Â  Â  case 'm500': return elc ? lists.em500 : lists.m500;
Â  Â  Â  Â  case 'm2000': return elc ? lists.em2000 : lists.m2000;
Â  Â  Â  Â  case 'weekly': return elc ? lists.eweekly : lists.weekly;
Â  Â  Â  Â  default: return [];
Â  Â  }
};

/* --- BÄ°LEÅENLER --- */
const FuelBadge = ({fuelType}) => {
Â  Â  const f = gf(fuelType);
Â  Â  return <span className={`fuel-badge ${fuelType}`}>{f.e} {f.l}</span>;
};

const TPBadge = () => <span className="tp-badge">ğŸ”‹ Elektrikli Transpalet</span>;
const STBadge = () => <span className="st-badge">ğŸ—ï¸ Ä°stif Makinesi</span>;

const ChkList=memo(function ChkList({items,chkRef}){
Â  const [checks,setChecks]=useState({});
Â  useEffect(()=>{chkRef.current=checks;},[checks]);
Â  return(<div style={{display:"flex",flexDirection:"column",gap:4,maxHeight:260,overflowY:"auto",paddingRight:4}}>
Â  {items.map((item,i)=>(
Â  <div key={i} className={`chk-item${checks[i]?" done":""}`} onClick={()=>setChecks(p=>({...p,[i]:!p[i]}))}>
Â  <div className={`chkbox${checks[i]?" done":""}`}>{checks[i]&&"âœ“"}</div>
Â  <span style={{fontSize:13,color:checks[i]?"var(--text)":"var(--dim)"}}>{item}</span>
Â  </div>
Â  ))}
Â  </div>);
});

function QRCode({data,sz=120}){
Â  const url = "https://api.qrserver.com/v1/create-qr-code/?size="+sz+"x"+sz+"&data=" + encodeURIComponent(window.location.href.split('?')[0] + "?id=" + data.split('://')[1]);
Â  return <img src={url} style={{borderRadius:8, border:'4px solid white'}} width={sz} height={sz} alt="QR" />;
}

function Confirm({msg,onYes,onNo}){
Â  return(<div className="overlay" onClick={onNo}><div className="card mbody" style={{maxWidth:380,textAlign:"center"}} onClick={e=>e.stopPropagation()}>
Â  <p style={{fontSize:15,marginBottom:16,lineHeight:1.6}}>{msg}</p>
Â  <div style={{display:"flex",gap:8,justifyContent:"center"}}><button className="btn btn-red" onClick={onYes}>Evet</button><button className="btn btn-ghost" onClick={onNo}>Ä°ptal</button></div>
Â  </div></div>);
}

const FormTemplate = ({ title, color, items, onSubmit, sel, noHours }) => {
Â  Â  const r={tech:useRef(),hours:useRef(),notes:useRef(),date:useRef()};
Â  Â  const chkRef=useRef({});
Â  Â  const today = new Date().toISOString().split('T')[0];

Â  Â  const handle=()=>{
Â  Â  Â  Â  const tech=r.tech.current.value.trim();
Â  Â  Â  Â  const date=r.date.current.value;
Â  Â  Â  Â  if(!tech || !date) return alert("Ä°sim ve Tarih zorunludur!");
Â  Â  Â  Â  if(!noHours) {
Â  Â  Â  Â  Â  Â  const hours=parseFloat(r.hours.current.value);
Â  Â  Â  Â  Â  Â  if(isNaN(hours)) return alert("Saat zorunludur!");
Â  Â  Â  Â  Â  Â  if(hours < sel.hours) {
Â  Â  Â  Â  Â  Â  Â  Â  if(!confirm(`âš ï¸ UYARI: GirdiÄŸiniz saat (${hours}), mevcut saatten (${sel.hours}) DAHA DÃœÅÃœK.\n\nYine de kaydetmek istiyor musunuz?`)) return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  onSubmit({tech, hours, date, notes:r.notes.current.value, chk:chkRef.current});
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  onSubmit({tech, hours:0, date, notes:r.notes.current.value, chk:chkRef.current});
Â  Â  Â  Â  }
Â  Â  Â  Â  r.tech.current.value=""; if(!noHours && r.hours.current)r.hours.current.value=""; r.notes.current.value="";
Â  Â  };

Â  Â  return (<div className="card">
Â  Â  Â  Â  <h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:color}}>{title}</h3>
Â  Â  Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  Â  Â  Â  Â  <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={today} /></div>
Â  Â  Â  Â  Â  Â  {noHours ? (
Â  Â  Â  Â  Â  Â  Â  Â  <div><label className="lbl">Personel</label><input ref={r.tech} className="inp" placeholder="Ad Soyad"/></div>
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label className="lbl">Personel</label><input ref={r.tech} className="inp" placeholder="Ad Soyad"/></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  {items && <>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,color:"var(--dim)",fontWeight:600,marginTop:5}}>YapÄ±lacak Ä°ÅŸler</div>
Â  Â  Â  Â  Â  Â  Â  Â  <ChkList items={items} chkRef={chkRef}/>
Â  Â  Â  Â  Â  Â  </>}
Â  Â  Â  Â  Â  Â  <div><label className="lbl">Notlar</label><textarea ref={r.notes} className="inp" placeholder="Detaylar..."/></div>
Â  Â  Â  Â  Â  Â  <button className="btn" style={{background:color, color:['var(--amber)','var(--green)','var(--cyan)','var(--pink)'].includes(color)?'black':'white', width:'100%', justifyContent:'center'}} onClick={handle}>KAYDET</button>
Â  Â  Â  Â  </div>
Â  Â  </div>);
}

const FaultForm=({sel,onSubmit,isNoHours})=>{
Â  Â  const r={by:useRef(),hours:useRef(),prio:useRef(),desc:useRef(),date:useRef()};
Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  const handle=()=>{
Â  Â  Â  Â  const by=r.by.current.value.trim(),desc=r.desc.current.value.trim(), date=r.date.current.value;
Â  Â  Â  Â  const hours = isNoHours ? 0 : parseFloat(r.hours.current?.value);
Â  Â  Â  Â  if(!by||!desc||!date)return alert("Eksik bilgi.");
Â  Â  Â  Â  if(!isNoHours && hours < sel.hours) {
Â  Â  Â  Â  Â  Â  if(!confirm(`âš ï¸ GirdiÄŸiniz saat (${hours}) mevcut saatten (${sel.hours}) dÃ¼ÅŸÃ¼k! Devam edilsin mi?`)) return;
Â  Â  Â  Â  }
Â  Â  Â  Â  onSubmit({by,hours,prio:r.prio.current.value,desc,date});
Â  Â  Â  Â  r.by.current.value="";if(!isNoHours)r.hours.current.value="";r.desc.current.value="";r.prio.current.value="normal";
Â  Â  };
Â  Â  return(<div className="card"><h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:"var(--red)"}}>ğŸ”´ ArÄ±za Bildirimi</h3>
Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={today} /></div>
Â  Â  <div><label className="lbl">Bildiren</label><input ref={r.by} className="inp" placeholder="Ad Soyad"/></div>
Â  Â  <div className="grid-2">
Â  Â  Â  Â  {!isNoHours && <div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>}
Â  Â  Â  Â  <div><label className="lbl">Ã–ncelik</label><select ref={r.prio} className="inp" defaultValue="normal">{Object.entries(PRIO).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}</select></div>
Â  Â  </div>
Â  Â  <div><label className="lbl">AÃ§Ä±klama</label><textarea ref={r.desc} className="inp" placeholder="ArÄ±za nedir?"/></div>
Â  Â  <button className="btn btn-red" style={{width:"100%",justifyContent:"center"}} onClick={handle}>ğŸ”´ ArÄ±za Bildir</button>
Â  Â  </div></div>);
};

const ListEditor = ({ onClose, onSave }) => {
Â  Â  const [lists, setLists] = useState(getSavedLists());
Â  Â  const [activeTab, setActiveTab] = useState("m250");
Â  Â  const [newItem, setNewItem] = useState("");
Â  Â  const currentList = lists[activeTab];
Â  Â  const add = () => { if(newItem){ setLists({...lists, [activeTab]: [...currentList, newItem]}); setNewItem(""); }};
Â  Â  const del = (idx) => { setLists({...lists, [activeTab]: currentList.filter((_,i)=>i!==idx)}); };
Â  Â  const save = () => { localStorage.setItem("opus_lists", JSON.stringify(lists)); onSave(lists); onClose(); };

Â  Â  return (<div className="overlay" onClick={onClose}><div className="card mbody" onClick={e=>e.stopPropagation()}>
Â  Â  Â  Â  <h3 style={{marginBottom:6}}>ğŸ“ Kontrol Listelerini DÃ¼zenle</h3>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style={{fontSize:11, color:'var(--mute)', fontWeight:700, marginTop:12, marginBottom:4, letterSpacing:1}}>â›½ STANDART FORKLÄ°FT (Dizel/Benzin/LPG/Hibrit)</div>
Â  Â  Â  Â  <div className="tabs" style={{marginBottom:6}}>
Â  Â  Â  Â  Â  Â  {[{k:'m250',l:'250h'},{k:'m500',l:'500h'},{k:'m2000',l:'2000h'},{k:'weekly',l:'AylÄ±k'}].map(t=>(
Â  Â  Â  Â  Â  Â  Â  Â  <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style={{fontSize:11, color:'#c084fc', fontWeight:700, marginTop:8, marginBottom:4, letterSpacing:1}}>âš¡ ELEKTRÄ°KLÄ° FORKLÄ°FT</div>
Â  Â  Â  Â  <div className="tabs" style={{marginBottom:6}}>
Â  Â  Â  Â  Â  Â  {[{k:'em250',l:'250h'},{k:'em500',l:'500h'},{k:'em2000',l:'2000h'},{k:'eweekly',l:'AylÄ±k'}].map(t=>(
Â  Â  Â  Â  Â  Â  Â  Â  <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} style={activeTab===t.k?{background:'#a855f7',color:'#fff'}:{}} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style={{fontSize:11, color:'#22d3ee', fontWeight:700, marginTop:8, marginBottom:4, letterSpacing:1}}>ğŸ”‹ ELEKTRÄ°KLÄ° KÃœÃ‡ÃœK EKÄ°PMANLAR</div>
Â  Â  Â  Â  <div className="tabs" style={{marginBottom:10}}>
Â  Â  Â  Â  Â  Â  <div className={`tab ${activeTab==='tp_monthly'?'active':''}`} style={activeTab==='tp_monthly'?{background:'var(--cyan)',color:'#000'}:{}} onClick={()=>setActiveTab('tp_monthly')}>Transpalet</div>
Â  Â  Â  Â  Â  Â  <div className={`tab ${activeTab==='st_monthly'?'active':''}`} style={activeTab==='st_monthly'?{background:'var(--pink)',color:'#fff'}:{}} onClick={()=>setActiveTab('st_monthly')}>Ä°stif Makinesi</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style={{fontSize:12, fontWeight:700, color: activeTab==='tp_monthly'?'#22d3ee':activeTab==='st_monthly'?'var(--pink)':activeTab.startsWith('e') ? '#c084fc' : 'var(--amber)', marginBottom:8, display:'flex', alignItems:'center', gap:6}}>
Â  Â  Â  Â  Â  Â  <span>{activeTab==='tp_monthly'?'ğŸ”‹':activeTab==='st_monthly'?'ğŸ—ï¸':activeTab.startsWith('e') ? 'âš¡' : 'â›½'}</span>
Â  Â  Â  Â  Â  Â  <span>{activeTab==='tp_monthly'?'Transpalet â€” AylÄ±k Kontrol':activeTab==='st_monthly'?'Ä°stif Makinesi â€” AylÄ±k Kontrol':(activeTab.startsWith('e') ? 'Elektrikli' : 'Standart') + ' â€” ' + activeTab.replace('e','').replace('weekly','AylÄ±k').replace('m','').replace('250','250 Saat').replace('500','500 Saat').replace('2000','2000 Saat')}</span>
Â  Â  Â  Â  Â  Â  <span style={{marginLeft:'auto', fontSize:11, color:'var(--dim)'}}>{currentList.length} madde</span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style={{display:'flex', gap:5, marginBottom:10}}>
Â  Â  Â  Â  Â  Â  <input className="inp" value={newItem} onChange={e=>setNewItem(e.target.value)} placeholder="Yeni madde..." onKeyDown={e=>{if(e.key==='Enter')add()}} />
Â  Â  Â  Â  Â  Â  <button className="btn btn-amber" onClick={add}>+</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{maxHeight:250, overflowY:'auto'}}>
Â  Â  Â  Â  Â  Â  {currentList.map((it,i)=>(<div key={i} style={{display:'flex', justifyContent:'space-between', alignItems:'center', padding:8, borderBottom:'1px solid #333'}}><span style={{fontSize:13}}>{it}</span><button style={{color:'red', background:'none', border:'none', cursor:'pointer', fontSize:14}} onClick={()=>del(i)}>ğŸ—‘</button></div>))}
Â  Â  Â  Â  Â  Â  {currentList.length===0 && <div style={{padding:20, textAlign:'center', color:'var(--dark)', fontSize:13}}>Liste boÅŸ. YukarÄ±dan madde ekleyin.</div>}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button className="btn btn-green" style={{width:'100%', marginTop:10, justifyContent:'center'}} onClick={save}>ğŸ’¾ KAYDET VE Ã‡IK</button>
Â  Â  </div></div>);
}

const FuelTypeModal = ({forklift, onClose, onSave}) => {
Â  Â  const [selected, setSelected] = useState(getFuelType(forklift.id));
Â  Â  const save = () => { saveFuelType(forklift.id, selected); onSave(); onClose(); };
Â  Â  return (<div className="overlay" onClick={onClose}><div className="card mbody" style={{maxWidth:400}} onClick={e=>e.stopPropagation()}>
Â  Â  Â  Â  <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:14}}>
Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:16, fontWeight:700}}>YakÄ±t Tipi DeÄŸiÅŸtir</h3>
Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{fontSize:13, color:'var(--dim)', marginBottom:14}}><b style={{color:'var(--text)'}}>{forklift.name}</b> iÃ§in yakÄ±t tipini seÃ§in</div>
Â  Â  Â  Â  <div style={{display:'flex', flexDirection:'column', gap:6}}>
Â  Â  Â  Â  Â  Â  {FUELS.map(f=>(
Â  Â  Â  Â  Â  Â  Â  Â  <div key={f.v} onClick={()=>setSelected(f.v)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{display:'flex', alignItems:'center', gap:10, padding:'12px 14px', borderRadius:10, cursor:'pointer', border:`2px solid ${selected===f.v?(f.v==='electric'?'#a855f7':'var(--amber)'):'var(--border)'}`, background:selected===f.v?(f.v==='electric'?'#a855f710':'#f59e0b08'):'var(--inp)', transition:'all .2s'}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style={{fontSize:20}}>{f.e}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style={{fontWeight:700, fontSize:14, color:selected===f.v?'var(--text)':'var(--dim)'}}>{f.l}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {selected===f.v && <span style={{marginLeft:'auto', color:f.v==='electric'?'#a855f7':'var(--amber)', fontWeight:800}}>âœ“</span>}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{marginTop:14, padding:10, borderRadius:8, background:'#f59e0b10', border:'1px solid #f59e0b20', fontSize:12, color:'var(--amber)'}}>
Â  Â  Â  Â  Â  Â  âš  YakÄ±t tipi deÄŸiÅŸtirildiÄŸinde, bakÄ±m formlarÄ±ndaki kontrol listesi otomatik olarak ilgili tipe gÃ¶re deÄŸiÅŸecektir.
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button className="btn btn-green" style={{width:'100%', marginTop:12, justifyContent:'center'}} onClick={save}>ğŸ’¾ Kaydet</button>
Â  Â  </div></div>);
};

/* ANA UYGULAMA */
function App(){
Â  const [data,setData]=useState({forklifts:[],faults:[],m250:[],m500:[],m2000:[],weekly:[]});
Â  const [lists, setLists] = useState(getSavedLists());
Â  const [pg,setPg]=useState("dash");
Â  const [sub,setSub]=useState("overview");
Â  const [sel,setSel]=useState(null);
Â  const [tab,setTab]=useState("status");
Â  const [modal,setModal]=useState(null);
Â  const [dateFilt, setDateFilt] = useState({start:"", end:""});
Â  const [detailModal,setDetailModal]=useState(null);
Â  const [confirmDel,setConfirmDel]=useState(null);
Â  const [repTgt,setRepTgt]=useState(null);
Â  const [toast,setToast]=useState(null);
Â  const [editFL,setEditFL]=useState(null);
Â  const [loading, setLoading]=useState(false);
Â  const [deletedIDs, setDeletedIDs] = useState(() => JSON.parse(localStorage.getItem('deleted_fl_ids') || "[]"));
Â  const [selFL, setSelFL] = useState(null);
Â  const [fuelModal, setFuelModal] = useState(null);
Â  const [fuelRefresh, setFuelRefresh] = useState(0);

Â  const [transpalets, setTranspalets] = useState([]);
Â  const [tpChecks, setTpChecks] = useState([]);
Â  const [tpFaults, setTpFaults] = useState([]);
Â  const [selTP, setSelTP] = useState(null);
Â  const [tpRepTgt, setTpRepTgt] = useState(null);
Â  const [tpTab, setTpTab] = useState("status");

Â  const [stackers, setStackers] = useState([]);
Â  const [stChecks, setStChecks] = useState([]);
Â  const [stFaults, setStFaults] = useState([]);
Â  const [selST, setSelST] = useState(null);
Â  const [stRepTgt, setStRepTgt] = useState(null);
Â  const [stTab, setStTab] = useState("status");

Â  const flRefs={name:useRef(),brand:useRef(),model:useRef(),hours:useRef(),fuel:useRef()};
Â  const tpRefs={name:useRef(),brand:useRef(),model:useRef()};
Â  const stRefs={name:useRef(),brand:useRef(),model:useRef()};
Â  const tpRepRefs={by:useRef(),desc:useRef(),date:useRef()};
Â  const stRepRefs={by:useRef(),desc:useRef(),date:useRef()};
Â  const rpRefs={by:useRef(),hours:useRef(),desc:useRef(),parts:useRef(),date:useRef()};

Â  const fetchData = () => {
Â  Â  setLoading(true);
Â  Â  fetch(GOOGLE_SCRIPT_URL + "?action=read")
Â  Â  Â  .then(r => r.json())
Â  Â  Â  .then(resp => {
Â  Â  Â  Â  setLoading(false);
Â  Â  Â  Â  if(resp.data) processGoogleData(resp.data);
Â  Â  Â  })
Â  Â  Â  .catch(e => { setLoading(false); showToast("BaÄŸlantÄ± hatasÄ±"); });
Â  };

Â  const processGoogleData = (rawData) => {
Â  Â  const newData = { forklifts:[], faults:[], m250:[], m500:[], m2000:[], weekly:[] };
Â  Â  const flMap = {};
Â  Â  const tpMap = {};
Â  Â  const tpChecksList = [];
Â  Â  const tpFaultsList = [];
Â  Â  const stMap = {};
Â  Â  const stChecksList = [];
Â  Â  const stFaultsList = [];

Â  Â  const repairs = rawData.filter(r => r.type === 'repair');
Â  Â  const tpRepairs = rawData.filter(r => r.type === 'tp_repair');
Â  Â  const stRepairs = rawData.filter(r => r.type === 'st_repair');

Â  Â  rawData.forEach(row => {
Â  Â  Â  if(deletedIDs.includes(row.flId)) return;
Â  Â  Â  if(row.type === 'forklift_register') {
Â  Â  Â  Â  flMap[row.flId] = {Â 
Â  Â  Â  Â  Â  Â  id: row.flId, name: row.flName, brand: row.person,Â 
Â  Â  Â  Â  Â  Â  model: row.note, hours: Number(row.hours),Â 
Â  Â  Â  Â  Â  Â  status: 'active', fuel: getFuelType(row.flId)
Â  Â  Â  Â  };
Â  Â  Â  }
Â  Â  Â  if(row.type === 'transpalet_register') {
Â  Â  Â  Â  tpMap[row.flId] = {
Â  Â  Â  Â  Â  Â  id: row.flId, name: row.flName, brand: row.person,
Â  Â  Â  Â  Â  Â  model: row.note, hours: 0, status: 'active', isTP: true
Â  Â  Â  Â  };
Â  Â  Â  }
Â  Â  Â  if(row.type === 'stacker_register') {
Â  Â  Â  Â  stMap[row.flId] = {
Â  Â  Â  Â  Â  Â  id: row.flId, name: row.flName, brand: row.person,
Â  Â  Â  Â  Â  Â  model: row.note, hours: 0, status: 'active', isST: true
Â  Â  Â  Â  };
Â  Â  Â  }
Â  Â  });

Â  Â  rawData.forEach(row => {
Â  Â  Â  if(deletedIDs.includes(row.flId)) return;
Â  Â  Â  if(flMap[row.flId] && Number(row.hours) > flMap[row.flId].hours) {
Â  Â  Â  Â  Â  flMap[row.flId].hours = Number(row.hours);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const checksArr = (row.checks && row.checks.trim()) ? row.checks.split(',').map(s=>s.trim()).filter(s=>s!=='') : [];

Â  Â  Â  const baseRec = {
Â  Â  Â  Â  Â  id: row.id, fid: row.flId, fn: row.flName,
Â  Â  Â  Â  Â  h: Number(row.hours), notes: row.note, dt: row.timestamp,
Â  Â  Â  Â  Â  done: checksArr.length, checksArr: checksArr
Â  Â  Â  };

Â  Â  Â  if(row.type === 'm250') newData.m250.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm250', getFuelType(row.flId)).length});
Â  Â  Â  if(row.type === 'm500') newData.m500.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm500', getFuelType(row.flId)).length});
Â  Â  Â  if(row.type === 'm2000') newData.m2000.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm2000', getFuelType(row.flId)).length});
Â  Â  Â  if(row.type === 'weekly') newData.weekly.push({...baseRec, tech: row.person, tot: getListForType(lists, 'weekly', getFuelType(row.flId)).length});
Â  Â  Â Â 
Â  Â  Â if(row.type === 'fault') {
          const isRepaired = repairs.some(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp));
          const repairLog = isRepaired ? repairs.find(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp)) : null;
          const status = isRepaired ? 'closed' : 'open';
          newData.faults.push({
              ...baseRec, desc: row.note, by: row.person, st: status, od: row.timestamp, prio:'high',
              closedBy: repairLog ? repairLog.person : null, 
              closedDesc: repairLog ? repairLog.note : null, 
              closedDt: repairLog ? repairLog.timestamp : null
          });
          if(status === 'open' && flMap[row.flId]) flMap[row.flId].status = 'fault';
      }

Â  Â  Â  if(row.type === 'tp_monthly') {
Â  Â  Â  Â  Â  tpChecksList.push({ id: row.id, tpId: row.flId, tech: row.person, dt: row.timestamp, notes: row.note, checksArr: checksArr, done: checksArr.length });
Â  Â  Â  }
Â  Â  Â  if(row.type === 'st_monthly') {
Â  Â  Â  Â  Â  stChecksList.push({ id: row.id, stId: row.flId, tech: row.person, dt: row.timestamp, notes: row.note, checksArr: checksArr, done: checksArr.length });
Â  Â  Â  }

Â  Â  Â  if(row.type === 'tp_fault') {
Â  Â  Â  Â  Â  const isRepaired = tpRepairs.some(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp));
Â  Â  Â  Â  Â  const repairLog = isRepaired ? tpRepairs.find(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp)) : null;
Â  Â  Â  Â  Â  tpFaultsList.push({
Â  Â  Â  Â  Â  Â  Â  id: row.id, tpId: row.flId, tpName: row.flName, by: row.person, desc: row.note, prio: 'high', dt: row.timestamp, st: isRepaired ? 'closed' : 'open', closedBy: repairLog ? repairLog.person : null, closedDesc: repairLog ? repairLog.note : null, closedDt: repairLog ? repairLog.timestamp : null
Â  Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  if(row.type === 'st_fault') {
Â  Â  Â  Â  Â  const isRepaired = stRepairs.some(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp));
Â  Â  Â  Â  Â  const repairLog = isRepaired ? stRepairs.find(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp)) : null;
Â  Â  Â  Â  Â  stFaultsList.push({
Â  Â  Â  Â  Â  Â  Â  id: row.id, stId: row.flId, stName: row.flName, by: row.person, desc: row.note, prio: 'high', dt: row.timestamp, st: isRepaired ? 'closed' : 'open', closedBy: repairLog ? repairLog.person : null, closedDesc: repairLog ? repairLog.note : null, closedDt: repairLog ? repairLog.timestamp : null
Â  Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });

Â  Â  newData.forklifts = Object.values(flMap);
Â  Â  setData(newData);
Â  Â  setTranspalets(Object.values(tpMap));
Â  Â  setTpChecks(tpChecksList);
Â  Â  setTpFaults(tpFaultsList);
Â  Â  setStackers(Object.values(stMap));
Â  Â  setStChecks(stChecksList);
Â  Â  setStFaults(stFaultsList);
Â  };

Â  const sendData = (type, payload) => {
Â  Â  setLoading(true);
Â  Â  const d = new FormData();
Â  Â  d.append("action", "write");
Â  Â  d.append("id", uid());
Â  Â  d.append("type", type);
Â  Â  d.append("flId", payload.flId || sel?.id);
Â  Â  d.append("flName", payload.flName || sel?.name);
Â  Â  d.append("person", payload.person);Â 
Â  Â  d.append("hours", payload.hours);
Â  Â  d.append("note", payload.note || payload.desc || "");
Â  Â  if(payload.date) d.append("customDate", payload.date);Â 
Â  Â Â 
Â  Â  let chkStr = "";
Â  Â  if(payload.chk) {
Â  Â  Â  Â  if(type === 'tp_monthly') {
Â  Â  Â  Â  Â  Â  chkStr = Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>lists.tp_monthly[k]).join(", ");
Â  Â  Â  Â  } else if (type === 'st_monthly') {
Â  Â  Â  Â  Â  Â  chkStr = Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>lists.st_monthly[k]).join(", ");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const fuelType = sel ? getFuelType(sel.id) : "diesel";
Â  Â  Â  Â  Â  Â  const listArr = getListForType(lists, type, fuelType);
Â  Â  Â  Â  Â  Â  chkStr = Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>listArr[k]).join(", ");
Â  Â  Â  Â  }
Â  Â  }
Â  Â  d.append("checks", chkStr);

Â  Â  fetch(GOOGLE_SCRIPT_URL, { method: "POST", body: d })
Â  Â  Â  .then(r => r.json())
Â  Â  Â  .then(resp => {
Â  Â  Â  Â  if(resp.result === "success") {
Â  Â  Â  Â  Â  showToast("Kaydedildi!");
Â  Â  Â  Â  Â  fetchData(); setTab("status"); setModal(null); setRepTgt(null);
Â  Â  Â  Â  Â  if(!['tp_monthly','tp_fault'].includes(type)) setSelTP(null);
Â  Â  Â  Â  Â  if(!['st_monthly','st_fault'].includes(type)) setSelST(null);
Â  Â  Â  Â  } else { alert("Hata"); setLoading(false); }
Â  Â  Â  })
Â  Â  Â  .catch(e => { setLoading(false); alert("BaÄŸlantÄ± HatasÄ±"); });
Â  };

Â  useEffect(() => {Â 
Â  Â  fetchData();Â 
Â  Â  const p = new URLSearchParams(window.location.search);
Â  Â  const qid = p.get('id');
Â  Â  if(qid) window.autoSelectId = qid;
Â  }, []);

Â  useEffect(() => {
Â  Â  if(window.autoSelectId && (data.forklifts.length > 0 || transpalets.length > 0 || stackers.length > 0)) {
Â  Â  Â  Â  const qid = window.autoSelectId;
Â  Â  Â  Â  const f = data.forklifts.find(x => x.id === qid);
Â  Â  Â  Â  if(f) { setSel(f); setSelTP(null); setSelST(null); setPg("mob"); window.autoSelectId = null; return; }
Â  Â  Â  Â  const tp = transpalets.find(x => x.id === qid);
Â  Â  Â  Â  if(tp) { setSelTP(tp); setSel(null); setSelST(null); setTpTab("status"); setPg("mob"); window.autoSelectId = null; return; }
Â  Â  Â  Â  const st = stackers.find(x => x.id === qid);
Â  Â  Â  Â  if(st) { setSelST(st); setSel(null); setSelTP(null); setStTab("status"); setPg("mob"); window.autoSelectId = null; return; }
Â  Â  }
Â  }, [data, transpalets, stackers]);

Â  const showToast=m=>{setToast(m);setTimeout(()=>setToast(null),2e3);};
Â Â 
Â  const gS=useCallback(f=>{
Â  Â  const fuelType = getFuelType(f.id);
Â  Â  const m2=data.m250.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
Â  Â  const m5=data.m500.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
Â  Â  const m20=data.m2000.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
Â  Â  const ws=data.weekly.filter(w=>w.fid===f.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
Â  Â  const fts=data.faults.filter(x=>x.fid===f.id);
Â  Â  const opn=fts.filter(x=>x.st==="open");
Â  Â  const l2h=m2[0]?.h||0,l5h=m5[0]?.h||0,l20h=m20[0]?.h||0;
Â  Â  const n2=l2h+250,n5=l5h+500,n20=l20h+2000,r2=n2-f.hours,r5=n5-f.hours,r20=n20-f.hours;
Â  Â  const dw=ws[0]?Math.floor((Date.now()-new Date(ws[0].dt).getTime())/864e5):999;
Â  Â  return{l2:m2[0],l5:m5[0],l20:m20[0],lw:ws[0],l2h,l5h,l20h,n2,n5,n20,r2,r5,r20,o2:r2<=0,o5:r5<=0,o20:r20<=0,w2:r2>0&&r2<=30,w5:r5>0&&r5<=50,w20:r20>0&&r20<=200,dw,ow:dw>30,opn,allF:fts,inF:opn.length>0||f.status==="fault"};
Â  },[data,lists,fuelRefresh]);

Â  const deleteEquipment = (id, type) => {
Â  Â  Â  const newDel = [...deletedIDs, id];
Â  Â  Â  setDeletedIDs(newDel);
Â  Â  Â  localStorage.setItem('deleted_fl_ids', JSON.stringify(newDel));
Â  Â  Â  fetchData();
Â  Â  Â  showToast(`${type} Gizlendi (Silindi)`);
Â  };

Â  const addFL=()=>{
Â  Â  const name=flRefs.name.current?.value?.trim();if(!name)return alert("Ad zorunlu.");
Â  Â  const flId = "FL-"+uid();
Â  Â  const fuelType = flRefs.fuel.current?.value || "diesel";
Â  Â  saveFuelType(flId, fuelType);
Â  Â  sendData('forklift_register', {
Â  Â  Â  Â  flId: flId, flName: name, person: flRefs.brand.current.value.trim(),Â 
Â  Â  Â  Â  hours: parseFloat(flRefs.hours.current.value)||0, note: flRefs.model.current.value.trim()Â 
Â  Â  });
Â  Â  setModal(null);
Â  };

Â  const addTP = () => {
Â  Â  Â  const name = tpRefs.name.current?.value?.trim(); if(!name) return alert("Ad zorunlu.");
Â  Â  Â  const tpId = "TP-"+uid();
Â  Â  Â  sendData('transpalet_register', { flId: tpId, flName: name, person: tpRefs.brand.current?.value?.trim()||"", note: tpRefs.model.current?.value?.trim()||"", hours: 0 });
Â  Â  Â  setModal(null);
Â  };

Â  const addST = () => {
Â  Â  Â  const name = stRefs.name.current?.value?.trim(); if(!name) return alert("Ad zorunlu.");
Â  Â  Â  const stId = "ST-"+uid();
Â  Â  Â  sendData('stacker_register', { flId: stId, flName: name, person: stRefs.brand.current?.value?.trim()||"", note: stRefs.model.current?.value?.trim()||"", hours: 0 });
Â  Â  Â  setModal(null);
Â  };

Â  const handleFaultSubmit=({by,hours,prio,desc,date})=> sendData('fault', {person:by, hours, note:desc, date});
Â  const handle250=({tech,hours,notes,chk,date})=> sendData('m250', {person:tech, hours, note:notes, chk, date});
Â  const handle500=({tech,hours,notes,chk,date})=> sendData('m500', {person:tech, hours, note:notes, chk, date});
Â  const handle2000=({tech,hours,notes,chk,date})=> sendData('m2000', {person:tech, hours, note:notes, chk, date});
Â  const handleWk=({tech,hours,notes,chk,date})=> sendData('weekly', {person:tech, hours, note:notes, chk, date});

Â  const handleTPCheck = ({tech,hours,notes,chk,date}) => {
Â  Â  Â  sendData('tp_monthly', {flId: selTP.id, flName: selTP.name, person:tech, hours:0, note:notes, chk, date});
Â  Â  Â  setTpTab("status");
Â  };

Â  const handleSTCheck = ({tech,hours,notes,chk,date}) => {
Â  Â  Â  sendData('st_monthly', {flId: selST.id, flName: selST.name, person:tech, hours:0, note:notes, chk, date});
Â  Â  Â  setStTab("status");
Â  };

Â  const getTPStatus = useCallback((tp) => {
Â  Â  Â  const checks = tpChecks.filter(c => c.tpId === tp.id).sort((a,b) => new Date(b.dt) - new Date(a.dt));
Â  Â  Â  const last = checks[0];
Â  Â  Â  const dw = last ? Math.floor((Date.now() - new Date(last.dt).getTime()) / 864e5) : 999;
Â  Â  Â  const faults = tpFaults.filter(f => f.tpId === tp.id).sort((a,b) => new Date(b.dt) - new Date(a.dt));
Â  Â  Â  const openFaults = faults.filter(f => f.st === 'open');
Â  Â  Â  return { last, dw, overdue: dw > 30, checks, faults, openFaults, hasFault: openFaults.length > 0 };
Â  }, [tpChecks, tpFaults]);

Â  const getSTStatus = useCallback((st) => {
Â  Â  Â  const checks = stChecks.filter(c => c.stId === st.id).sort((a,b) => new Date(b.dt) - new Date(a.dt));
Â  Â  Â  const last = checks[0];
Â  Â  Â  const dw = last ? Math.floor((Date.now() - new Date(last.dt).getTime()) / 864e5) : 999;
Â  Â  Â  const faults = stFaults.filter(f => f.stId === st.id).sort((a,b) => new Date(b.dt) - new Date(a.dt));
Â  Â  Â  const openFaults = faults.filter(f => f.st === 'open');
Â  Â  Â  return { last, dw, overdue: dw > 30, checks, faults, openFaults, hasFault: openFaults.length > 0 };
Â  }, [stChecks, stFaults]);

Â  const StatusBadge = ({s}) => {
Â  Â  Â  if(s.hasFault) return <span className="badge" style={{background:"#ef444425",color:"#ef4444"}}>ğŸ”´ ARIZALI</span>;
Â  Â  Â  if(s.overdue) return <span className="badge" style={{background:"#ef444418",color:"#f87171"}}>âš  GecikmiÅŸ</span>;
Â  Â  Â  return <span className="badge" style={{background:"#22c55e18",color:"#4ade80"}}>âœ“ Aktif</span>;
Â  };

Â  const submitTPFault = (tpId, tpName, by, desc, prio, date) => {
Â  Â  Â  sendData('tp_fault', { flId: tpId, flName: tpName, person: by, hours: 0, note: desc, date });
Â  Â  Â  setTpTab("status");
Â  };

Â  const submitSTFault = (stId, stName, by, desc, prio, date) => {
Â  Â  Â  sendData('st_fault', { flId: stId, flName: stName, person: by, hours: 0, note: desc, date });
Â  Â  Â  setStTab("status");
Â  };

Â  const closeTPFault = (faultId, flId, by, desc, date) => {
Â  Â  Â  sendData('tp_repair', { flId: flId, person: by, hours: 0, note: desc, date });
Â  Â  Â  setTpRepTgt(null);
Â  };

Â  const closeSTFault = (faultId, flId, by, desc, date) => {
Â  Â  Â  sendData('st_repair', { flId: flId, person: by, hours: 0, note: desc, date });
Â  Â  Â  setStRepTgt(null);
Â  };

Â  const TPRepairModal = () => tpRepTgt && (
Â  Â  Â  <div className="overlay" onClick={()=>setTpRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Transpalet ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setTpRepTgt(null)}>âœ•</button></div>
Â  Â  Â  <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{tpRepTgt.tpName}</div><div style={{color:"var(--dim)",marginTop:4}}>{tpRepTgt.desc}</div></div>
Â  Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  Â  <div><label className="lbl">Tarih</label><input ref={tpRepRefs.date} type="date" className="inp" defaultValue={new Date().toISOString().split('T')[0]} /></div>
Â  Â  Â  <div><label className="lbl">Tamir Eden *</label><input ref={tpRepRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
Â  Â  Â  <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={tpRepRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
Â  Â  Â  <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{
Â  Â  Â  Â  Â  const by=tpRepRefs.by.current?.value?.trim(); if(!by) return alert("Ä°sim gir");
Â  Â  Â  Â  Â  closeTPFault(tpRepTgt.id, tpRepTgt.tpId, by, tpRepRefs.desc.current?.value, tpRepRefs.date.current?.value);
Â  Â  Â  }}>âœ… ArÄ±zayÄ± Kapat</button>
Â  Â  Â  </div></div></div>
Â  );

Â  const STRepairModal = () => stRepTgt && (
Â  Â  Â  <div className="overlay" onClick={()=>setStRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Ä°stif Makinesi ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setStRepTgt(null)}>âœ•</button></div>
Â  Â  Â  <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{stRepTgt.stName}</div><div style={{color:"var(--dim)",marginTop:4}}>{stRepTgt.desc}</div></div>
Â  Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  Â  <div><label className="lbl">Tarih</label><input ref={stRepRefs.date} type="date" className="inp" defaultValue={new Date().toISOString().split('T')[0]} /></div>
Â  Â  Â  <div><label className="lbl">Tamir Eden *</label><input ref={stRepRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
Â  Â  Â  <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={stRepRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
Â  Â  Â  <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{
Â  Â  Â  Â  Â  const by=stRepRefs.by.current?.value?.trim(); if(!by) return alert("Ä°sim gir");
Â  Â  Â  Â  Â  closeSTFault(stRepTgt.id, stRepTgt.stId, by, stRepRefs.desc.current?.value, stRepRefs.date.current?.value);
Â  Â  Â  }}>âœ… ArÄ±zayÄ± Kapat</button>
Â  Â  Â  </div></div></div>
Â  );
// KODUNDA BULUNAN MEVCUT KISIM
  const STRepairModal = () => stRepTgt && (
      <div className="overlay" onClick={()=>setStRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Ä°stif Makinesi ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setStRepTgt(null)}>âœ•</button></div>
      <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{stRepTgt.stName}</div><div style={{color:"var(--dim)",marginTop:4}}>{stRepTgt.desc}</div></div>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Tarih</label><input ref={stRepRefs.date} type="date" className="inp" defaultValue={new Date().toISOString().split('T')[0]} /></div>
      <div><label className="lbl">Tamir Eden *</label><input ref={stRepRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
      <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={stRepRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
      <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{
          const by=stRepRefs.by.current?.value?.trim(); if(!by) return alert("Ä°sim gir");
          closeSTFault(stRepTgt.id, stRepTgt.stId, by, stRepRefs.desc.current?.value, stRepRefs.date.current?.value);
      }}>âœ… ArÄ±zayÄ± Kapat</button>
      </div></div></div>
  );

  const RepairModal = () => repTgt && !repTgt.isTP && !repTgt.isST && (
      <div className="overlay" onClick={()=>setRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Forklift ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setRepTgt(null)}>âœ•</button></div>
      <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{repTgt.fn}</div><div style={{color:"var(--dim)",marginTop:4}}>{repTgt.desc}</div></div>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Tarih</label><input ref={rpRefs.date} type="date" className="inp" defaultValue={new Date().toISOString().split('T')[0]} /></div>
      <div><label className="lbl">Tamir Eden *</label><input ref={rpRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
      <div><label className="lbl">Saat</label><input ref={rpRefs.hours} type="number" className="inp" placeholder="GÃ¼ncel saat"/></div>
      <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={rpRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
      <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={() => {
          doCloseFault();
          setRepTgt(null);
      }}>âœ… ArÄ±zayÄ± Kapat</button>
      </div></div></div>
  );

  const EditEquipmentModal = () => {
    if (!editFL) return null;
    const isTP = editFL.isTP;
    const isST = editFL.isST;
    const isSmall = isTP || isST;
    const r = { name: useRef(), brand: useRef(), model: useRef(), hours: useRef() };

    const handleSave = () => {
      const name = r.name.current?.value?.trim();
      if (!name) return alert("Ad zorunlu.");
      const brand = r.brand.current?.value?.trim() || "";
      const model = r.model.current?.value?.trim() || "";
      const hours = isSmall ? 0 : parseFloat(r.hours.current?.value) || 0;

      if (isTP) { sendData('transpalet_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: 0 }); }
      else if (isST) { sendData('stacker_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: 0 }); }
      else { sendData('forklift_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: hours }); }
      setEditFL(null);
    };

    return (
      <div className="overlay" onClick={() => setEditFL(null)}>
        <div className="card mbody" style={{border: `1px solid ${isTP ? 'var(--cyan)' : isST ? 'var(--pink)' : 'var(--amber)'}`}} onClick={e => e.stopPropagation()}>
          <div style={{display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14}}>
            <h3 style={{fontSize: 18, fontWeight: 800, color: isTP ? "var(--cyan)" : isST ? "var(--pink)" : "var(--amber)"}}>
              âœï¸ {isTP ? 'Transpalet DÃ¼zenle' : isST ? 'Ä°stif Makinesi DÃ¼zenle' : 'Forklift DÃ¼zenle'}
            </h3>
            <button className="btn btn-ghost btn-sm" onClick={() => setEditFL(null)}>âœ•</button>
          </div>
          <div className="grid-2">
            <div><label className="lbl">Ad *</label><input ref={r.name} className="inp" defaultValue={editFL.name}/></div>
            <div><label className="lbl">Marka</label><input ref={r.brand} className="inp" defaultValue={editFL.brand}/></div>
            <div><label className="lbl">Model</label><input ref={r.model} className="inp" defaultValue={editFL.model}/></div>
            {!isSmall && <div><label className="lbl">Saat (GÃ¼ncelle)</label><input ref={r.hours} className="inp" type="number" defaultValue={editFL.hours}/></div>}
          </div>
          <div style={{marginTop: 14, fontSize: 11, color: "var(--dim)"}}>Not: Ekipman ID'si ({editFL.id}) aynÄ± kalacak.</div>
          <button className={`btn ${isTP ? 'btn-cyan' : isST ? 'btn-pink' : 'btn-amber'}`} style={{width: "100%", justifyContent: "center", marginTop: 14}} onClick={handleSave}>
            ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet
          </button>
        </div>
      </div>
    );
  };
Â  Â  if (!editFL) return null;
Â  Â  const isTP = editFL.isTP;
Â  Â  const isST = editFL.isST;
Â  Â  const isSmall = isTP || isST;
Â  Â  const r = { name: useRef(), brand: useRef(), model: useRef(), hours: useRef() };

Â  Â  const handleSave = () => {
Â  Â  Â  const name = r.name.current?.value?.trim();
Â  Â  Â  if (!name) return alert("Ad zorunlu.");
Â  Â  Â  const brand = r.brand.current?.value?.trim() || "";
Â  Â  Â  const model = r.model.current?.value?.trim() || "";
Â  Â  Â  const hours = isSmall ? 0 : parseFloat(r.hours.current?.value) || 0;

Â  Â  Â  if (isTP) { sendData('transpalet_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: 0 }); }
Â  Â  Â  else if (isST) { sendData('stacker_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: 0 }); }
Â  Â  Â  else { sendData('forklift_register', { flId: editFL.id, flName: name, person: brand, note: model, hours: hours }); }
Â  Â  Â  setEditFL(null);
Â  Â  };

Â  Â  return (
Â  Â  Â  <div className="overlay" onClick={() => setEditFL(null)}>
Â  Â  Â  Â  <div className="card mbody" style={{border: `1px solid ${isTP ? 'var(--cyan)' : isST ? 'var(--pink)' : 'var(--amber)'}`}} onClick={e => e.stopPropagation()}>
Â  Â  Â  Â  Â  <div style={{display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14}}>
Â  Â  Â  Â  Â  Â  <h3 style={{fontSize: 18, fontWeight: 800, color: isTP ? "var(--cyan)" : isST ? "var(--pink)" : "var(--amber)"}}>
Â  Â  Â  Â  Â  Â  Â  âœï¸ {isTP ? 'Transpalet DÃ¼zenle' : isST ? 'Ä°stif Makinesi DÃ¼zenle' : 'Forklift DÃ¼zenle'}
Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={() => setEditFL(null)}>âœ•</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="grid-2">
Â  Â  Â  Â  Â  Â  <div><label className="lbl">Ad *</label><input ref={r.name} className="inp" defaultValue={editFL.name}/></div>
Â  Â  Â  Â  Â  Â  <div><label className="lbl">Marka</label><input ref={r.brand} className="inp" defaultValue={editFL.brand}/></div>
Â  Â  Â  Â  Â  Â  <div><label className="lbl">Model</label><input ref={r.model} className="inp" defaultValue={editFL.model}/></div>
Â  Â  Â  Â  Â  Â  {!isSmall && <div><label className="lbl">Saat (GÃ¼ncelle)</label><input ref={r.hours} className="inp" type="number" defaultValue={editFL.hours}/></div>}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style={{marginTop: 14, fontSize: 11, color: "var(--dim)"}}>Not: Ekipman ID'si ({editFL.id}) aynÄ± kalacak.</div>
Â  Â  Â  Â  Â  <button className={`btn ${isTP ? 'btn-cyan' : isST ? 'btn-pink' : 'btn-amber'}`} style={{width: "100%", justifyContent: "center", marginTop: 14}} onClick={handleSave}>
Â  Â  Â  Â  Â  Â  ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  );
Â  };

Â  const doCloseFault=()=>{
Â  Â  const by=rpRefs.by.current?.value?.trim(); if(!by)return alert("Ä°sim gir");
Â  Â  const date = rpRefs.date.current.value;
Â  Â  sendData('repair', {flId: repTgt.fid, person:by, hours: rpRefs.hours.current?.value, note: rpRefs.desc.current?.value, date});
Â  };

Â  const stats=useMemo(()=>{
Â  Â  let ov=0,wr=0,ft=0;
Â  Â  data.forklifts.forEach(f=>{const s=gS(f);if(s.inF)ft++;if(s.o2||s.o5||s.o20||s.ow)ov++;else if(s.w2||s.w5||s.w20)wr++;});
Â  Â  let tpOv=0,tpFt=0; transpalets.forEach(tp=>{const s=getTPStatus(tp);if(s.overdue) tpOv++;if(s.hasFault) tpFt++;});
Â  Â  let stOv=0,stFt=0; stackers.forEach(st=>{const s=getSTStatus(st);if(s.overdue) stOv++;if(s.hasFault) stFt++;});
Â  Â  const tpOpenFaults = tpFaults.filter(f=>f.st==='open').length;
Â  Â  const stOpenFaults = stFaults.filter(f=>f.st==='open').length;
Â  Â  return{tot:data.forklifts.length,ft:ft+tpFt+stFt,ov:ov+tpOv+stOv,wr,of:data.faults.filter(f=>f.st==="open").length+tpOpenFaults+stOpenFaults,tpTot:transpalets.length,tpOv, stTot:stackers.length, stOv};
Â  },[data,gS,transpalets,tpChecks,tpFaults,stackers,stChecks,stFaults]);

Â  const Badge=({f})=>{const s=gS(f);
Â  Â  if(s.inF)return<span className="badge" style={{background:"#ef444425",color:"#ef4444"}}>ğŸ”´ ARIZALI</span>;
Â  Â  if(s.o2||s.o5||s.o20)return<span className="badge" style={{background:"#ef444418",color:"#f87171"}}>âš  GecikmiÅŸ</span>;
Â  Â  if(s.w2||s.w5||s.w20)return<span className="badge" style={{background:"#f59e0b18",color:"#fbbf24"}}>â° YaklaÅŸÄ±yor</span>;
Â  Â  return<span className="badge" style={{background:"#22c55e18",color:"#4ade80"}}>âœ“ Aktif</span>;
Â  };

Â  const MaintDetail=({type,record,onClose})=>{
Â  Â  const isTP = type === "tp_monthly";
Â  Â  const isST = type === "st_monthly";
Â  Â  const isSmall = isTP || isST;
Â  Â  const fuelType = isSmall ? null : getFuelType(record.fid);
Â  Â  const color=type==="m250"?"var(--amber)":type==="m500"?"var(--blue)":type==="m2000"?"#a855f7":type==="tp_monthly"?"var(--cyan)":type==="st_monthly"?"var(--pink)":"var(--green)";
Â  Â  const doneItems = record.checksArr || [];
Â  Â  return(<div className="overlay" onClick={onClose}><div className="card mbody" style={{border:`1px solid ${color}40`}} onClick={e=>e.stopPropagation()}>
Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
Â  Â  <h3 style={{fontSize:16,fontWeight:700,color}}>{isTP?'TRANSPALET AYLIK KONTROL DETAYI':isST?'Ä°STÄ°F MAKÄ°NESÄ° KONTROL DETAYI':type.toUpperCase()+' DETAYI'}</h3><button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button></div>
Â  Â  <div style={{marginBottom:12}}>
Â  Â  <div className="dr"><span className="dl">{isTP?'Transpalet':isST?'Ä°stif Mak.':'Forklift'}</span><span className="dv" style={{fontWeight:700}}>{record.fn} {isTP?<TPBadge/>:isST?<STBadge/>:<FuelBadge fuelType={fuelType}/>}</span></div>
Â  Â  <div className="dr"><span className="dl">Personel</span><span className="dv">{record.tech||"â€”"}</span></div>
Â  Â  {!isSmall&&<div className="dr"><span className="dl">Saat</span><span className="dv mono">{record.h}h</span></div>}
Â  Â  <div className="dr"><span className="dl">Tarih</span><span className="dv">{fd(record.dt)}</span></div>
Â  Â  {record.notes&&<div className="dr"><span className="dl">Notlar</span><span className="dv">{record.notes}</span></div>}
Â  Â  </div>
Â  Â  <div style={{fontSize:12,color:"var(--mute)",fontWeight:600,marginBottom:8}}>YAPILAN Ä°ÅLER ({doneItems.length} madde)</div>
Â  Â  <div style={{display:"flex",flexDirection:"column",gap:3,maxHeight:300,overflowY:"auto"}}>
Â  Â  {doneItems.length > 0 ? doneItems.map((item,i)=>(
Â  Â  <div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#22c55e08",borderRadius:6,border:"1px solid #22c55e20"}}><span style={{fontSize:14}}>âœ…</span><span style={{fontSize:12,color:"var(--text)"}}>{item}</span></div>
Â  Â  )) : <div style={{padding:16,textAlign:"center",color:"var(--dark)",fontSize:13}}>KayÄ±tlÄ± yapÄ±lan iÅŸ bulunamadÄ±</div>}
Â  Â  </div></div></div>);
Â  };

Â  const DateFilterBar = () => (
Â  Â  Â  <div style={{display:'flex', gap:10, marginBottom:10, alignItems:'center', background:'var(--inp)', padding:8, borderRadius:8, flexWrap:'wrap'}}>
Â  Â  Â  Â  <div style={{fontSize:12, fontWeight:700, color:'var(--dim)'}}>TARÄ°H FÄ°LTRESÄ°:</div>
Â  Â  Â  Â  <input type="date" className="inp" style={{padding:5, width:'auto'}} onChange={e=>setDateFilt({...dateFilt, start:e.target.value})} />
Â  Â  Â  Â  <span style={{color:'var(--dim)'}}>-</span>
Â  Â  Â  Â  <input type="date" className="inp" style={{padding:5, width:'auto'}} onChange={e=>setDateFilt({...dateFilt, end:e.target.value})} />
Â  Â  Â  Â  {(dateFilt.start||dateFilt.end) && <button className="btn btn-ghost btn-xs" onClick={()=>setDateFilt({start:"", end:""})}>Temizle</button>}
Â  Â  Â  </div>
Â  );

Â  const filterByDate = (items) => {
Â  Â  Â  if(!dateFilt.start && !dateFilt.end) return items;
Â  Â  Â  return items.filter(i => {
Â  Â  Â  Â  Â  const d = i.dt.split('T')[0];
Â  Â  Â  Â  Â  if(dateFilt.start && d < dateFilt.start) return false;
Â  Â  Â  Â  Â  if(dateFilt.end && d > dateFilt.end) return false;
Â  Â  Â  Â  Â  return true;
Â  Â  Â  });
Â  };

Â  const FlFilterBar = () => (
Â  Â  Â  <div style={{display:'flex', gap:6, marginBottom:14, flexWrap:'wrap', alignItems:'center'}}>
Â  Â  Â  Â  <span style={{fontSize:11, color:'var(--mute)', fontWeight:700}}>EKÄ°PMAN:</span>
Â  Â  Â  Â  <div className={`fl-filter-chip${selFL===null?' active':''}`} onClick={()=>setSelFL(null)}>TÃ¼mÃ¼</div>
Â  Â  Â  Â  {data.forklifts.map(f=>(
Â  Â  Â  Â  Â  Â  <div key={f.id} className={`fl-filter-chip${selFL===f.id?' active':''}`} onClick={()=>setSelFL(selFL===f.id?null:f.id)}>
Â  Â  Â  Â  Â  Â  Â  Â  {isElectric(getFuelType(f.id))?'âš¡':'â›½'} {f.name}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  Â  {transpalets.map(tp=>(
Â  Â  Â  Â  Â  Â  <div key={tp.id} className={`fl-filter-chip${selFL===tp.id?' active':''}`} onClick={()=>setSelFL(selFL===tp.id?null:tp.id)}>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”‹ {tp.name}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  Â  {stackers.map(st=>(
Â  Â  Â  Â  Â  Â  <div key={st.id} className={`fl-filter-chip${selFL===st.id?' active':''}`} onClick={()=>setSelFL(selFL===st.id?null:st.id)}>
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ—ï¸ {st.name}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>
Â  );

Â  const Dash=()=>(
Â  Â  <div style={{padding:24,maxWidth:1200,margin:"0 auto"}}>
Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12,marginBottom:24}}>
Â  Â  Â  Â  <div><h1 style={{fontSize:26,fontWeight:900}}><span style={{color:"var(--amber)"}}>âš™</span> Forklift BakÄ±m</h1><p style={{color:"var(--mute)",fontSize:13,marginTop:2}}>Ana Kontrol Paneli</p></div>
Â  Â  Â  Â  <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
Â  Â  Â  Â  Â  <button className="btn btn-amber" onClick={()=>setPg("qr")}>ğŸ“± QR</button>
Â  Â  Â  Â  Â  <button className="btn btn-blue" onClick={()=>{setPg("mob");setSel(null);setSelTP(null);setSelST(null);}}>ğŸ“‹ Mobil GiriÅŸ</button>
Â  Â  Â  Â  Â  <button className="btn btn-ghost" onClick={()=>{setEditFL(null);setModal("settings")}}>âš™ Ayarlar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div className="g-auto" style={{marginBottom:24}}>
Â  Â  Â  Â  {[{l:"Forklift",v:stats.tot,c:"var(--blue)"},{l:"Transpalet",v:stats.tpTot,c:"var(--cyan)"},{l:"Ä°stif Mak.",v:stats.stTot,c:"var(--pink)"},{l:"ArÄ±zalÄ±",v:stats.ft,c:stats.ft?"var(--red)":"var(--green)"},{l:"GecikmiÅŸ",v:stats.ov,c:stats.ov?"var(--red)":"var(--green)"},{l:"AÃ§Ä±k ArÄ±za",v:stats.of,c:stats.of?"var(--red)":"var(--green)"}].map((s,i)=>
Â  Â  Â  Â  Â  <div key={i} className="card" style={{padding:14,borderLeft:`3px solid ${s.c}`}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700,textTransform:"uppercase"}}>{s.l}</div><div className="mono" style={{fontSize:26,fontWeight:800,color:s.c,marginTop:2}}>{s.v}</div></div>
Â  Â  Â  Â  )}
Â  Â  Â  </div>

Â  Â  Â  <div className="tabs" style={{marginBottom:18,maxWidth:800}}>
Â  Â  Â  Â  {[{k:"overview",l:"Genel BakÄ±ÅŸ"},{k:"faults",l:"ArÄ±zalar"},{k:"maint",l:"BakÄ±m KayÄ±tlarÄ±"},{k:"weekly",l:"AylÄ±k"},{k:"fleet",l:"Filo YÃ¶netimi"}].map(t=>
Â  Â  Â  Â  Â  <div key={t.k} className={`tab${sub===t.k?" active":""}`} onClick={()=>setSub(t.k)} style={{fontSize:12}}>{t.l}</div>
Â  Â  Â  Â  )}
Â  Â  Â  </div>

Â  Â  Â  {(data.forklifts.length>=1 || transpalets.length>=1 || stackers.length>=1) && ["overview","faults","maint","weekly"].includes(sub) && <FlFilterBar />}
Â  Â  Â  {["faults","maint","weekly"].includes(sub)&&<DateFilterBar />}
Â  Â  Â Â 
Â  Â  Â  {sub==="overview"&&(()=>{
Â  Â  Â  Â  const flList = data.forklifts.filter(f=>selFL?f.id===selFL:true);
Â  Â  Â  Â  const tpList = transpalets.filter(tp=>selFL?tp.id===selFL:true);
Â  Â  Â  Â  const stList = stackers.filter(st=>selFL?st.id===selFL:true);
Â  Â  Â  Â  if(!flList.length && !tpList.length && !stList.length) return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Ekipman bulunamadÄ±.</div>;
Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  {flList.map(f=>{const s=gS(f);const fuelType=getFuelType(f.id);return(
Â  Â  Â  Â  Â  Â  <div key={f.id} className="card" style={{marginBottom:12,borderColor:s.inF?"#ef444440":s.o2||s.o5||s.o20?"#f59e0b25":undefined}}>
Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div><div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><h3 style={{fontSize:17,fontWeight:800}}>{f.name}</h3><FuelBadge fuelType={fuelType}/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span><Badge f={f}/></div><div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8}}><div className="mono" style={{fontSize:22,fontWeight:800,color:"var(--amber)"}}>{f.hours}h</div></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div className="g-auto" style={{marginTop:14}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>250 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o2?"var(--red)":s.w2?"var(--amber)":"#4ade80",marginTop:3}}>{s.o2?Math.abs(s.r2)+"h GECÄ°KMÄ°Å":s.r2+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(250-Math.max(0,s.r2))/250*100)+"%",background:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>500 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o5?"var(--red)":s.w5?"var(--amber)":"#4ade80",marginTop:3}}>{s.o5?Math.abs(s.r5)+"h GECÄ°KMÄ°Å":s.r5+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(500-Math.max(0,s.r5))/500*100)+"%",background:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>2000 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o20?"var(--red)":s.w20?"var(--amber)":"#4ade80",marginTop:3}}>{s.o20?Math.abs(s.r20)+"h GECÄ°KMÄ°Å":s.r20+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(2000-Math.max(0,s.r20))/2000*100)+"%",background:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:s.ow?"var(--red)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>AYLIK</div><div style={{fontSize:14,fontWeight:700,color:s.ow?"var(--red)":"#4ade80",marginTop:3}}>{s.ow?s.dw+" gÃ¼n gecikmiÅŸ":s.dw<999?(30-s.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>)})}
Â  Â  Â  Â  Â  Â  {tpList.map(tp => {
Â  Â  Â  Â  Â  Â  Â  Â  const tpS = getTPStatus(tp);
Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={tp.id} className="card" style={{marginBottom:12,borderColor:tpS.hasFault?"#ef444440":tpS.overdue?"#f59e0b25":undefined}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:17,fontWeight:800}}>{tp.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TPBadge/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{tp.id}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <StatusBadge s={tpS}/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[tp.brand,tp.model].filter(Boolean).join(" â€¢ ")}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="g-auto" style={{marginTop:14}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:tpS.overdue?"var(--red)":"var(--green)"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>AYLIK KONTROL</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:14,fontWeight:700,color:tpS.overdue?"var(--red)":"#4ade80",marginTop:3}}>{tpS.overdue?tpS.dw+" gÃ¼n gecikmiÅŸ":tpS.dw<999?(30-tpS.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  {stList.map(st => {
Â  Â  Â  Â  Â  Â  Â  Â  const stS = getSTStatus(st);
Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={st.id} className="card" style={{marginBottom:12,borderColor:stS.hasFault?"#ef444440":stS.overdue?"#f59e0b25":undefined}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:17,fontWeight:800}}>{st.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <STBadge/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{st.id}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <StatusBadge s={stS}/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[st.brand,st.model].filter(Boolean).join(" â€¢ ")}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="g-auto" style={{marginTop:14}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mcard" style={{borderLeftColor:stS.overdue?"var(--red)":"var(--green)"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>AYLIK KONTROL</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:14,fontWeight:700,color:stS.overdue?"var(--red)":"#4ade80",marginTop:3}}>{stS.overdue?stS.dw+" gÃ¼n gecikmiÅŸ":stS.dw<999?(30-stS.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  );
Â  Â  Â  })()}

Â  Â  Â  {sub==="faults"&&(()=>{
Â  Â  Â  Â  Â  let fs=data.faults.filter(f=>selFL?f.fid===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
Â  Â  Â  Â  Â  fs = filterByDate(fs);
Â  Â  Â  Â  Â  let tpFs = tpFaults.map(f=>({...f, id:f.id, fn:f.tpName, by:f.by, desc:f.desc, od:f.dt, st:f.st, h:0, prio:f.prio||'normal', isTP:true})).filter(f=>selFL?f.tpId===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
Â  Â  Â  Â  Â  tpFs = filterByDate(tpFs.map(f=>({...f,dt:f.od})));
Â  Â  Â  Â  Â  let stFs = stFaults.map(f=>({...f, id:f.id, fn:f.stName, by:f.by, desc:f.desc, od:f.dt, st:f.st, h:0, prio:f.prio||'normal', isST:true})).filter(f=>selFL?f.stId===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
Â  Â  Â  Â  Â  stFs = filterByDate(stFs.map(f=>({...f,dt:f.od})));
Â  Â  Â  Â  Â  const all = [...fs, ...tpFs, ...stFs].sort((a,b)=>new Date(b.od)-new Date(a.od));
Â  Â  Â  Â  Â  if(!all.length)return<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>ArÄ±za kaydÄ± yok</div>;
Â  return all.map(f=><div key={f.id} className="card" style={{marginBottom:8,borderLeft:`3px solid ${f.st==="open"?(PRIO[f.prio]?.c||"#fbbf24"):"var(--green)"}`}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}><span style={{fontWeight:700,fontSize:14}}>{f.fn}</span>{f.isTP&&<TPBadge/>}{f.isST&&<STBadge/>}<span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e"}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"âœ… KAPALI"}</span></div><p style={{fontSize:13,marginTop:6,lineHeight:1.5}}>{f.desc}</p><div style={{fontSize:11,color:"var(--mute)",marginTop:6}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b>{(!f.isTP&&!f.isST)&&(" â€¢ Saat: "+f.h+"h")} â€¢ {fd(f.od)}</div>{f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}</div><div style={{display:"flex",flexDirection:"column",gap:4}}>{f.st==="open"&&(!f.isTP&&!f.isST)&&<button className="btn btn-green btn-sm" onClick={()=>setRepTgt(f)}>ğŸ”§ Kapat</button>}{f.st==="open"&&f.isTP&&<button className="btn btn-green btn-sm" onClick={()=>setTpRepTgt(f)}>ğŸ”§ Kapat</button>}{f.st==="open"&&f.isST&&<button className="btn btn-green btn-sm" onClick={()=>setStRepTgt(f)}>ğŸ”§ Kapat</button>}</div></div></div>);
Â  Â  Â  })()}

Â  Â  Â  {sub==="maint"&&<div>
Â  Â  Â  Â  {(()=>{
Â  Â  Â  Â  Â  Â  let rs=[...data.m250,...data.m500,...data.m2000].filter(m=>selFL?m.fid===selFL:true).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
Â  Â  Â  Â  Â  Â  rs = filterByDate(rs);
Â  Â  Â  Â  Â  Â  if(!rs.length)return<div className="card" style={{textAlign:"center",padding:24,color:"var(--dark)",marginBottom:16}}>KayÄ±t yok</div>;
Â  Â  Â  Â  Â  Â  return rs.map(r=>{
Â  Â  Â  Â  Â  Â  Â  Â  const fuelType = getFuelType(r.fid);
Â  Â  Â  Â  Â  Â  Â  Â  const m2000Len = getListForType(lists, 'm2000', fuelType).length;
Â  Â  Â  Â  Â  Â  Â  Â  const m500Len = getListForType(lists, 'm500', fuelType).length;
Â  Â  Â  Â  Â  Â  Â  Â  const type=r.tot===m2000Len?"m2000":r.tot===m500Len?"m500":"m250";
Â  Â  Â  Â  Â  Â  Â  Â  const color=type==="m2000"?"#a855f7":type==="m500"?"var(--blue)":"var(--amber)";
Â  Â  Â  Â  Â  Â  Â  Â  const colorBg=type==="m2000"?"#a855f720":type==="m500"?"#3b82f620":"#f59e0b20";
Â  Â  Â  Â  Â  Â  Â  Â  return<div key={r.id} className="card" style={{marginBottom:6,borderLeft:`3px solid ${color}`,cursor:"pointer"}} onClick={()=>setDetailModal({type,record:r})}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}><div><span style={{fontWeight:700}}>{r.fn}</span>{isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>}<span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>@ {r.h}h</span></div><span className="badge" style={{background:colorBg,color}}>{r.done} yapÄ±ldÄ± â€” detay â†’</span></div><div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Teknisyen: <b style={{color:"var(--dim)"}}>{r.tech}</b> â€¢ {fd(r.dt)}</div></div>;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  })()}
Â  Â  Â  </div>}

Â  Â  Â  {sub==="weekly"&&(()=>{
Â  Â  Â  Â  Â  let ws = data.weekly.map(w => ({...w, isTP: false, isST: false})).filter(w=>selFL?w.fid===selFL:true);
Â  Â  Â  Â  Â  let tps = tpChecks.map(c => ({...c, isTP: true, isST: false, fid: c.tpId, fn: transpalets.find(t=>t.id===c.tpId)?.name || "Transpalet", h: 0})).filter(c=>selFL?c.fid===selFL:true);
Â  Â  Â  Â  Â  let sts = stChecks.map(c => ({...c, isST: true, isTP: false, fid: c.stId, fn: stackers.find(s=>s.id===c.stId)?.name || "Ä°stif Makinesi", h: 0})).filter(c=>selFL?c.fid===selFL:true);
Â  Â  Â  Â  Â  let allWs = [...ws, ...tps, ...sts].sort((a,b)=>new Date(b.dt)-new Date(a.dt));
Â  Â  Â  Â  Â  allWs = filterByDate(allWs);

Â  Â  Â  Â  Â  if(!allWs.length) return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>KayÄ±t yok</div>;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  return allWs.map(w => {
Â  Â  Â  Â  Â  Â  Â  const fuelType = (w.isTP||w.isST) ? null : getFuelType(w.fid);
Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={w.id} className="card" style={{marginBottom:6,borderLeft:`3px solid ${w.isTP?"var(--cyan)":w.isST?"var(--pink)":"var(--green)"}`,cursor:"pointer"}} onClick={()=>setDetailModal({type: w.isTP ? "tp_monthly" : w.isST ? "st_monthly" : "weekly", record: w})}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style={{fontWeight:700}}>{w.fn}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {w.isTP ? <span style={{marginLeft:5}}><TPBadge/></span> : w.isST ? <span style={{marginLeft:5}}><STBadge/></span> : (isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(!w.isTP&&!w.isST) && <span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>{w.h}h</span>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="badge" style={{background:w.isTP?"#06b6d420":w.isST?"#ec489920":"#22c55e20",color:w.isTP?"#22d3ee":w.isST?"#f472b6":"#4ade80"}}>{w.done} yapÄ±ldÄ± â€” detay â†’</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>{(w.isTP||w.isST)?"Personel":"OperatÃ¶r"}: <b style={{color:"var(--dim)"}}>{w.tech}</b> â€¢ {fd(w.dt)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  });
Â  Â  Â  })()}

Â  Â  Â  {sub==="fleet"&&(<div>
Â  Â  Â  Â  <div style={{fontSize:13,fontWeight:700,color:"var(--amber)",marginBottom:10}}>âš™ FORKLÄ°FTLER</div>
Â  Â  Â  Â  {!data.forklifts.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)",marginBottom:16}}>Forklift yok.</div>:data.forklifts.map(f=>{
Â  Â  Â  Â  Â  const fuelType = getFuelType(f.id);
Â  Â  Â  Â  Â  return <div key={f.id} className="card" style={{marginBottom:12}}>
Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:16,fontWeight:800}}>{f.name} <FuelBadge fuelType={fuelType}/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></h3>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",gap:6}}>
Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...f, isTP:false, isST:false})}>âœï¸ DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={()=>setFuelModal(f)}>â›½ YakÄ±t Tipi</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-dng btn-sm" onClick={()=>deleteEquipment(f.id, "Forklift")}>ğŸ—‘ Sil</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="g-auto">
Â  Â  Â  Â  Â  Â  <div><div className="lbl">MARKA</div><div>{f.brand||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  <div><div className="lbl">MODEL</div><div>{f.model||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  <div><div className="lbl">SAAT</div><div className="mono" style={{fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div></div>
Â  Â  Â  Â  Â  Â  <div><div className="lbl">YAKIT TÄ°PÄ°</div><div><FuelBadge fuelType={fuelType}/></div></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>;
Â  Â  Â  Â  })}

Â  Â  Â  Â  <div style={{fontSize:13,fontWeight:700,color:"var(--cyan)",marginBottom:10,marginTop:20}}>ğŸ”‹ ELEKTRÄ°KLÄ° TRANSPALETLER</div>
Â  Â  Â  Â  {!transpalets.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)",marginBottom:16}}>Transpalet yok.</div>:transpalets.map(tp=>(
Â  Â  Â  Â  Â  <div key={tp.id} className="card" style={{marginBottom:12}}>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
Â  Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:16,fontWeight:800}}>{tp.name} <TPBadge/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{tp.id}</span></h3>
Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",gap:6}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...tp, isTP:true, isST:false})}>âœï¸ DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-dng btn-sm" onClick={()=>deleteEquipment(tp.id, "Transpalet")}>ğŸ—‘ Sil</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="g-auto">
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">MARKA</div><div>{tp.brand||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">MODEL</div><div>{tp.model||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">DURUM</div><div><StatusBadge s={getTPStatus(tp)}/></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}

Â  Â  Â  Â  <div style={{fontSize:13,fontWeight:700,color:"var(--pink)",marginBottom:10,marginTop:20}}>ğŸ—ï¸ Ä°STÄ°F MAKÄ°NELERÄ°</div>
Â  Â  Â  Â  {!stackers.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)"}}>Ä°stif Makinesi yok.</div>:stackers.map(st=>(
Â  Â  Â  Â  Â  <div key={st.id} className="card" style={{marginBottom:12}}>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
Â  Â  Â  Â  Â  Â  Â  <h3 style={{fontSize:16,fontWeight:800}}>{st.name} <STBadge/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{st.id}</span></h3>
Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",gap:6}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...st, isTP:false, isST:true})}>âœï¸ DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-dng btn-sm" onClick={()=>deleteEquipment(st.id, "Ä°stif Makinesi")}>ğŸ—‘ Sil</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="g-auto">
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">MARKA</div><div>{st.brand||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">MODEL</div><div>{st.model||"â€”"}</div></div>
Â  Â  Â  Â  Â  Â  Â  <div><div className="lbl">DURUM</div><div><StatusBadge s={getSTStatus(st)}/></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>)}
Â  Â  </div>
Â  );

Â  const QRPage=()=>(<div style={{padding:24,maxWidth:1100,margin:"0 auto"}}><div style={{display:"flex",alignItems:"center",gap:12,marginBottom:24}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setPg("dash")}>â†</button><div><h2 style={{fontSize:22,fontWeight:800}}>QR Kod / Barkod</h2><p style={{fontSize:13,color:"var(--dim)"}}>YazdÄ±rÄ±p ekipmanlara yapÄ±ÅŸtÄ±rÄ±n</p></div></div>
Â  {data.forklifts.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--amber)",marginBottom:10}}>âš™ FORKLÄ°FTLER</div>}
Â  <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginBottom:24}}>{data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={`forklift://${f.id}`} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{f.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{f.brand} {f.model}</div><div style={{marginTop:4}}><FuelBadge fuelType={fuelType}/></div><div className="mono" style={{fontSize:12,color:"var(--amber)",marginTop:3}}>{f.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSel(f);setSelTP(null);setSelST(null);setPg("mob");setTab("status")}}>Mobil AÃ§</button></div>;})}</div>
Â Â 
Â  {transpalets.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--cyan)",marginBottom:10}}>ğŸ”‹ ELEKTRÄ°KLÄ° TRANSPALETLER</div>}
Â  <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginBottom:24}}>{transpalets.map(tp=><div key={tp.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={`transpalet://${tp.id}`} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{tp.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{tp.brand} {tp.model}</div><div style={{marginTop:4}}><TPBadge/></div><div className="mono" style={{fontSize:12,color:"var(--cyan)",marginTop:3}}>{tp.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSelTP(tp);setSel(null);setSelST(null);setTpTab("status");setPg("mob")}}>Mobil AÃ§</button></div>)}</div>

Â  {stackers.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--pink)",marginBottom:10}}>ğŸ—ï¸ Ä°STÄ°F MAKÄ°NELERÄ°</div>}
Â  <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16}}>{stackers.map(st=><div key={st.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={`stacker://${st.id}`} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{st.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{st.brand} {st.model}</div><div style={{marginTop:4}}><STBadge/></div><div className="mono" style={{fontSize:12,color:"var(--pink)",marginTop:3}}>{st.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSelST(st);setSel(null);setSelTP(null);setStTab("status");setPg("mob")}}>Mobil AÃ§</button></div>)}</div>

Â  {!data.forklifts.length&&!transpalets.length&&!stackers.length&&<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Ekipman yok.</div>}
Â  </div>);

Â  const Mobile=()=>{
Â  Â  if(!sel && !selTP && !selST){
Â  Â  Â  Â  return(
Â  Â  Â  Â  <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
Â  Â  Â  Â  Â  Â  <div style={{textAlign:"center",marginBottom:16}}><div style={{fontSize:12,color:"var(--amber)",fontWeight:700,letterSpacing:2}}>MOBÄ°L GÄ°RÄ°Å</div><h2 style={{fontSize:20,fontWeight:800,marginTop:4}}>Ekipman SeÃ§in</h2></div>
Â  Â  Â  Â  Â  Â  {!data.forklifts.length && !transpalets.length && !stackers.length && <div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z ekipman yok.</div>}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {data.forklifts.length > 0 && <div style={{fontSize:12, fontWeight:700, color:"var(--amber)", marginBottom:8}}>FORKLÄ°FTLER</div>}
Â  Â  Â  Â  Â  Â  {data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:gS(f).inF?"#ef444440":undefined}} onClick={()=>{setSel(f);setTab("status")}}>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:'flex',alignItems:'center',gap:6}}>{f.name} <FuelBadge fuelType={fuelType}/> <span style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></div><div style={{fontSize:12,color:"var(--dim)"}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><div className="mono" style={{fontSize:16,fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div><Badge f={f}/></div></div></div>;})}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {transpalets.length > 0 && <div style={{fontSize:12, fontWeight:700, color:"var(--cyan)", marginBottom:8, marginTop:16}}>TRANSPALETLER</div>}
Â  Â  Â  Â  Â  Â  {transpalets.map(tp => { const tpS = getTPStatus(tp); return (
Â  Â  Â  Â  Â  Â  Â  Â  <div key={tp.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:tpS.hasFault?"#ef444440":tpS.overdue?"#ef444430":undefined}} onClick={()=>{setSelTP(tp);setTpTab("status")}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:"flex",alignItems:"center",gap:6}}>{tp.name} <TPBadge/></div><div style={{fontSize:12,color:"var(--dim)"}}>{[tp.brand,tp.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><StatusBadge s={tpS}/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>);})}

Â  Â  Â  Â  Â  Â  {stackers.length > 0 && <div style={{fontSize:12, fontWeight:700, color:"var(--pink)", marginBottom:8, marginTop:16}}>Ä°STÄ°F MAKÄ°NELERÄ°</div>}
Â  Â  Â  Â  Â  Â  {stackers.map(st => { const stS = getSTStatus(st); return (
Â  Â  Â  Â  Â  Â  Â  Â  <div key={st.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:stS.hasFault?"#ef444440":stS.overdue?"#ef444430":undefined}} onClick={()=>{setSelST(st);setStTab("status")}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:"flex",alignItems:"center",gap:6}}>{st.name} <STBadge/></div><div style={{fontSize:12,color:"var(--dim)"}}>{[st.brand,st.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><StatusBadge s={stS}/></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>);})}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setPg("dash");setSel(null);setSelTP(null);setSelST(null)}}>â† Ana Panel</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  );
Â  Â  }

Â  Â  if(sel) {
Â  Â  Â  Â  const st=gS(sel);
Â  Â  Â  Â  const fuelType = getFuelType(sel.id);
Â  Â  Â  Â  const selIsElectric = isElectric(fuelType);

Â  Â  Â  Â  return(
Â  Â  Â  Â  <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setSel(null)}>â†</button><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{sel.name}</span><FuelBadge fuelType={fuelType}/><Badge f={sel}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[sel.brand,sel.model].filter(Boolean).join(" â€¢ ")} â€¢ {sel.hours}h</div></div></div>
Â  Â  Â  Â  <div className="tabs" style={{marginBottom:12}}>
Â  Â  Â  Â  {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"m250",l:"250h"},{k:"m500",l:"500h"},{k:"m2000",l:"2000h"},{k:"wk",l:"AylÄ±k"}].map(t=>
Â  Â  Â  Â  <div key={t.k} className={`tab${tab===t.k?" active":""}`} onClick={()=>setTab(t.k)}>{t.l}</div>)}
Â  Â  Â  Â  </div>

Â  Â  Â  Â  {tab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>250 SAAT BAKIM</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o2?"var(--red)":st.w2?"var(--amber)":"#4ade80"}}>{st.o2?Math.abs(st.r2)+"h":st.r2+"h"}</div><div style={{fontSize:11,color:st.o2?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o2?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l2h}h<br/>Sonraki: {st.n2}h</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(250-Math.max(0,st.r2))/250*100))+"%",background:st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)"}}/></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>500 SAAT BAKIM</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o5?"var(--red)":st.w5?"var(--amber)":"#4ade80"}}>{st.o5?Math.abs(st.r5)+"h":st.r5+"h"}</div><div style={{fontSize:11,color:st.o5?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o5?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l5h}h<br/>Sonraki: {st.n5}h</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(500-Math.max(0,st.r5))/500*100))+"%",background:st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)"}}/></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>2000 SAAT BAKIM</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o20?"var(--red)":st.w20?"var(--amber)":"#4ade80"}}>{st.o20?Math.abs(st.r20)+"h":st.r20+"h"}</div><div style={{fontSize:11,color:st.o20?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o20?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l20h}h<br/>Sonraki: {st.n20}h</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(2000-Math.max(0,st.r20))/2000*100))+"%",background:st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)"}}/></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${st.ow?"var(--red)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>AYLIK KONTROL</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:14,fontWeight:700,color:st.ow?"var(--red)":"#4ade80",marginTop:3}}>{st.ow?"âš  "+st.dw+" gÃ¼n gecikmiÅŸ":st.dw<999?(30-st.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {st.opn.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({st.opn.length})</div>
Â  Â  Â  Â  Â  Â  Â  Â  {st.opn.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}><div style={{fontWeight:600}}>{f.desc}</div><div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.od)}</div></div>)}
Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  </div>}
Â  Â  Â  Â  {tab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={sel} onSubmit={handleFaultSubmit} isNoHours={false} />
            {st.opn.length > 0 && <div className="card" style={{borderLeft:"3px solid var(--red)"}}>
                <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
                {st.opn.map(f => (
                    <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                        <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                        <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.od)}</div>
                        <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                    </div>
                ))}
            </div>}
        </div>}
Â  Â  Â  Â  {tab==="m250"&&<FormTemplate title={`250 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="var(--amber)" items={getListForType(lists,'m250',fuelType)} onSubmit={handle250} sel={sel}/>}
Â  Â  Â  Â  {tab==="m500"&&<FormTemplate title={`500 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="var(--blue)" items={getListForType(lists,'m500',fuelType)} onSubmit={handle500} sel={sel}/>}
Â  Â  Â  Â  {tab==="m2000"&&<FormTemplate title={`2000 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="#a855f7" items={getListForType(lists,'m2000',fuelType)} onSubmit={handle2000} sel={sel}/>}
Â  Â  Â  Â  {tab==="wk"&&<FormTemplate title={`AYLIK KONTROL ${selIsElectric?'âš¡':''}`} color="var(--green)" items={getListForType(lists,'weekly',fuelType)} onSubmit={handleWk} sel={sel}/>}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  );
Â  Â  }

Â  Â  if(selTP) {
Â  Â  Â  Â  const tpS = getTPStatus(selTP);
Â  Â  Â  Â  return(
Â  Â  Â  Â  <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>{setSelTP(null);setTpTab("status")}}>â†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{selTP.name}</span><TPBadge/><StatusBadge s={tpS}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[selTP.brand,selTP.model].filter(Boolean).join(" â€¢ ")}</div></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div className="tabs" style={{marginBottom:12}}>
Â  Â  Â  Â  Â  Â  {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"monthly",l:"AylÄ±k"},{k:"history",l:"GeÃ§miÅŸ"}].map(t=>
Â  Â  Â  Â  Â  Â  Â  Â  <div key={t.k} className={`tab${tpTab===t.k?" active":""}`} onClick={()=>setTpTab(t.k)}>{t.l}</div>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  {tpTab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${tpS.overdue?"var(--red)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>AYLIK KONTROL</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:16,fontWeight:700,color:tpS.overdue?"var(--red)":"#4ade80",marginTop:4}}>{tpS.overdue?"âš  "+tpS.dw+" gÃ¼n gecikmiÅŸ":tpS.dw<999?(30-tpS.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {tpS.last && <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Son kontrol: {fd(tpS.last.dt)} â€” {tpS.last.tech}</div>}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  {tpS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({tpS.openFaults.length})</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {tpS.openFaults.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontWeight:600}}>{f.desc}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>)}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  </div>}

Â  Â  Â  Â  Â  Â  {tpTab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={selTP} isNoHours={true} onSubmit={(data)=>submitTPFault(selTP.id, selTP.name, data.by, data.desc, data.prio, data.date)} />
            {tpS.openFaults.length > 0 && <div className="card" style={{borderLeft:"3px solid var(--red)"}}>
                <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
                {tpS.openFaults.map(f => (
                    <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                        <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                        <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
                        <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setTpRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                    </div>
                ))}
            </div>}
        </div>}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {tpTab==="monthly"&&<FormTemplate title="ğŸ”‹ TRANSPALET AYLIK KONTROL" color="var(--cyan)" items={lists.tp_monthly} onSubmit={handleTPCheck} sel={{hours:0}} noHours={true} />}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {tpTab==="history"&&<div>
Â  Â  Â  Â  Â  Â  Â  Â  {tpS.checks.length > 0 && <div style={{marginBottom:14}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,fontWeight:700,color:"var(--cyan)",marginBottom:8}}>AYLIK KONTROLLER</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {tpS.checks.map(c => (<div key={c.id} className="card" style={{marginBottom:6,borderLeft:"3px solid var(--cyan)",cursor:"pointer"}} onClick={()=>setDetailModal({type:"tp_monthly",record:{...c,fn:selTP.name}})}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontWeight:700,fontSize:13}}>{fd(c.dt)}</span><span className="badge" style={{background:"#06b6d420",color:"#22d3ee"}}>{c.done} yapÄ±ldÄ± â€” detay â†’</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Personel: <b style={{color:"var(--dim)"}}>{c.tech}</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  Â  Â  {tpS.faults.length > 0 && <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,fontWeight:700,color:"var(--red)",marginBottom:8}}>ARIZA KAYITLARI</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {tpS.faults.map(f => (<div key={f.id} className="card" style={{marginBottom:6,borderLeft:`3px solid ${f.st==='open'?'var(--red)':'var(--green)'}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{flex:1}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e",marginBottom:4}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"âœ… KAPALI"}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style={{fontSize:13,marginTop:4,lineHeight:1.5}}>{f.desc}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b> â€¢ {fd(f.dt)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {f.st==="open"&&<button className="btn btn-green btn-sm" onClick={()=>setTpRepTgt(f)}>ğŸ”§ Kapat</button>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  Â  Â  {tpS.checks.length===0 && tpS.faults.length===0 && <div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z kayÄ±t yok</div>}
Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  );
Â  Â  }

Â  Â  if(selST) {
Â  Â  Â  Â  const stS = getSTStatus(selST);
Â  Â  Â  Â  return(
Â  Â  Â  Â  <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
Â  Â  Â  Â  Â  Â  <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
Â  Â  Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>{setSelST(null);setStTab("status")}}>â†</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{selST.name}</span><STBadge/><StatusBadge s={stS}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[selST.brand,selST.model].filter(Boolean).join(" â€¢ ")}</div></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div className="tabs" style={{marginBottom:12}}>
Â  Â  Â  Â  Â  Â  {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"monthly",l:"AylÄ±k"},{k:"history",l:"GeÃ§miÅŸ"}].map(t=>
Â  Â  Â  Â  Â  Â  Â  Â  <div key={t.k} className={`tab${stTab===t.k?" active":""}`} onClick={()=>setStTab(t.k)}>{t.l}</div>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  {stTab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="card" style={{borderLeft:`3px solid ${stS.overdue?"var(--red)":"var(--green)"}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>AYLIK KONTROL</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:16,fontWeight:700,color:stS.overdue?"var(--red)":"#4ade80",marginTop:4}}>{stS.overdue?"âš  "+stS.dw+" gÃ¼n gecikmiÅŸ":stS.dw<999?(30-stS.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stS.last && <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Son kontrol: {fd(stS.last.dt)} â€” {stS.last.tech}</div>}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  {stS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({stS.openFaults.length})</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stS.openFaults.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontWeight:600}}>{f.desc}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>)}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  </div>}

Â  Â  Â  Â  Â  Â  {stTab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={selST} isNoHours={true} onSubmit={(data)=>submitSTFault(selST.id, selST.name, data.by, data.desc, data.prio, data.date)} />
            {stS.openFaults.length > 0 && <div className="card" style={{borderLeft:"3px solid var(--red)"}}>
                <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
                {stS.openFaults.map(f => (
                    <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                        <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                        <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
                        <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setStRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                    </div>
                ))}
            </div>}
        </div>}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {stTab==="monthly"&&<FormTemplate title="ğŸ—ï¸ Ä°STÄ°F MAKÄ°NESÄ° KONTROLÃœ" color="var(--pink)" items={lists.st_monthly} onSubmit={handleSTCheck} sel={{hours:0}} noHours={true} />}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {stTab==="history"&&<div>
Â  Â  Â  Â  Â  Â  Â  Â  {stS.checks.length > 0 && <div style={{marginBottom:14}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,fontWeight:700,color:"var(--pink)",marginBottom:8}}>AYLIK KONTROLLER</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stS.checks.map(c => (<div key={c.id} className="card" style={{marginBottom:6,borderLeft:"3px solid var(--pink)",cursor:"pointer"}} onClick={()=>setDetailModal({type:"st_monthly",record:{...c,fn:selST.name}})}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontWeight:700,fontSize:13}}>{fd(c.dt)}</span><span className="badge" style={{background:"#ec489920",color:"#f472b6"}}>{c.done} yapÄ±ldÄ± â€” detay â†’</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Personel: <b style={{color:"var(--dim)"}}>{c.tech}</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  Â  Â  {stS.faults.length > 0 && <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:12,fontWeight:700,color:"var(--red)",marginBottom:8}}>ARIZA KAYITLARI</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {stS.faults.map(f => (<div key={f.id} className="card" style={{marginBottom:6,borderLeft:`3px solid ${f.st==='open'?'var(--red)':'var(--green)'}`}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{flex:1}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e",marginBottom:4}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"âœ… KAPALI"}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style={{fontSize:13,marginTop:4,lineHeight:1.5}}>{f.desc}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b> â€¢ {fd(f.dt)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {f.st==="open"&&<button className="btn btn-green btn-sm" onClick={()=>setStRepTgt(f)}>ğŸ”§ Kapat</button>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>))}
Â  Â  Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  Â  Â  Â  Â  {stS.checks.length===0 && stS.faults.length===0 && <div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z kayÄ±t yok</div>}
Â  Â  Â  Â  Â  Â  </div>}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  );
Â  Â  }
Â  };

Â  const SettingsModal = () => (
Â  Â  Â  <div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" onClick={e=>e.stopPropagation()}>
Â  Â  Â  Â  <h3>âš™ Ayarlar</h3>
Â  Â  Â  Â  <div style={{display:'flex', flexDirection:'column', gap:10, marginTop:15}}>
Â  Â  Â  Â  Â  Â  <button className="btn btn-blue" onClick={()=>{setModal('list_edit')}}>ğŸ“ Kontrol Listelerini DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  <button className="btn btn-ghost" onClick={()=>{setModal('add')}}>+ Yeni Forklift Ekle</button>
Â  Â  Â  Â  Â  Â  <button className="btn btn-cyan" onClick={()=>{setModal('add_tp')}}>+ Yeni Transpalet Ekle</button>
Â  Â  Â  Â  Â  Â  <button className="btn btn-pink" onClick={()=>{setModal('add_st')}}>+ Yeni Ä°stif Makinesi Ekle</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{marginTop:20, fontSize:12, color:'var(--dim)', textAlign:'center'}}>Selectron v5.3 (Opus)</div>
Â  Â  Â  </div></div>
Â  );

Â  const AddTPModal = () => (<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #06b6d430"}} onClick={e=>e.stopPropagation()}>
Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--cyan)"}}>ğŸ”‹ Yeni Transpalet Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
Â  Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  Â  Â  <div><label className="lbl">Transpalet AdÄ± *</label><input ref={tpRefs.name} className="inp" placeholder="Ã¶r: Transpalet 1"/></div>
Â  Â  Â  Â  <div className="grid-2">
Â  Â  Â  Â  Â  <div><label className="lbl">Marka</label><input ref={tpRefs.brand} className="inp" placeholder="Ã¶r: Linde"/></div>
Â  Â  Â  Â  Â  <div><label className="lbl">Model</label><input ref={tpRefs.model} className="inp" placeholder="Ã¶r: T20"/></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <button className="btn btn-cyan" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addTP}>+ Transpalet Ekle</button>
Â  </div></div>);

Â  const AddSTModal = () => (<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #ec489930"}} onClick={e=>e.stopPropagation()}>
Â  Â  Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--pink)"}}>ğŸ—ï¸ Yeni Ä°stif Makinesi Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
Â  Â  Â  <div style={{display:"flex",flexDirection:"column",gap:10}}>
Â  Â  Â  Â  <div><label className="lbl">Makine AdÄ± *</label><input ref={stRefs.name} className="inp" placeholder="Ã¶r: Ä°stif 1"/></div>
Â  Â  Â  Â  <div className="grid-2">
Â  Â  Â  Â  Â  <div><label className="lbl">Marka</label><input ref={stRefs.brand} className="inp" placeholder="Ã¶r: Jungheinrich"/></div>
Â  Â  Â  Â  Â  <div><label className="lbl">Model</label><input ref={stRefs.model} className="inp" placeholder="Ã¶r: EJC"/></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <button className="btn btn-pink" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addST}>+ Ä°stif Makinesi Ekle</button>
Â  </div></div>);

Â  const AddFLModal=()=>{
Â  return(<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #f59e0b30"}} onClick={e=>e.stopPropagation()}>
Â  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--amber)"}}>Yeni Forklift Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
Â  <div className="grid-2">
Â  <div><label className="lbl">Forklift AdÄ± *</label><input ref={flRefs.name} className="inp" placeholder="Ã¶r: Forklift 1"/></div>
Â  <div><label className="lbl">Marka</label><input ref={flRefs.brand} className="inp" placeholder="Ã¶r: Toyota"/></div>
Â  <div><label className="lbl">Model</label><input ref={flRefs.model} className="inp" placeholder="Ã¶r: 8FG25"/></div>
Â  <div><label className="lbl">Mevcut Saat</label><input ref={flRefs.hours} className="inp" type="number" placeholder="0"/></div>
Â  </div>
Â  <div style={{marginTop:10}}>
Â  Â  <label className="lbl">YakÄ±t Tipi</label>
Â  Â  <select ref={flRefs.fuel} className="inp" defaultValue="diesel">
Â  Â  Â  Â  {FUELS.map(f=><option key={f.v} value={f.v}>{f.e} {f.l}</option>)}
Â  Â  </select>
Â  </div>
Â  <button className="btn btn-amber" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addFL}>+ Forklift Ekle</button>
Â  </div></div>);
Â  };

Â  return(<div>
Â  {toast&&<div className="toast">{toast}</div>}
Â  {loading && <div className="loading-screen"><div>Ä°ÅŸleniyor...</div></div>}
Â  {pg==="dash"&&<Dash/>}
Â  {pg==="mob"&&<Mobile/>}
Â  {pg==="qr"&&<QRPage/>}
Â  {modal==="settings" && <SettingsModal />}
Â  {modal==="add"&&<AddFLModal/>}
Â  {modal==="add_tp"&&<AddTPModal/>}
Â  {modal==="add_st"&&<AddSTModal/>}
Â  {modal==="list_edit" && <ListEditor onClose={()=>setModal("settings")} onSave={setLists} />}
Â  <RepairModal/>
Â  <TPRepairModal/>
Â  <STRepairModal/>
Â  {editFL && <EditEquipmentModal />}
Â  {detailModal&&<MaintDetail type={detailModal.type} record={detailModal.record} onClose={()=>setDetailModal(null)}/>}
Â  {confirmDel&&<Confirm msg={confirmDel.msg} onYes={()=>{if(confirmDel.type==="Transpalet"||confirmDel.type==="Ä°stif Makinesi"||confirmDel.type==="Forklift"){deleteEquipment(confirmDel.id, confirmDel.type)} setConfirmDel(null);}} onNo={()=>setConfirmDel(null)}/>}
Â  {fuelModal&&<FuelTypeModal forklift={fuelModal} onClose={()=>setFuelModal(null)} onSave={()=>{setFuelRefresh(p=>p+1); fetchData();}} />}
Â  </div>);
}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
</script>
</body>
</html>