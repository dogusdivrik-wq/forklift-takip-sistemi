<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forklift BakÄ±m Sistemi Pro</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e1a;--card:#131825;--border:#1e293b;--inp:#0f172a;--text:#e2e8f0;--dim:#94a3b8;--mute:#64748b;--dark:#475569;--amber:#f59e0b;--red:#ef4444;--green:#22c55e;--blue:#3b82f6;--cyan:#06b6d4;--pink:#ec4899}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.btn{padding:10px 16px;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-weight:700;font-size:13px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .15s}
.btn:active{transform:scale(.97)}
.btn-amber{background:var(--amber);color:#000}.btn-red{background:var(--red);color:#fff}
.btn-green{background:var(--green);color:#000}.btn-blue{background:var(--blue);color:#fff}.btn-cyan{background:var(--cyan);color:#000}.btn-pink{background:var(--pink);color:#fff}
.btn-ghost{background:transparent;color:var(--dim);border:1px solid var(--border)}
.btn-sm{padding:6px 10px;font-size:11px;border-radius:6px}
.btn-xs{padding:4px 8px;font-size:10px;border-radius:5px}
.btn-dng{background:transparent;color:var(--red);border:1px solid #ef444440}
.inp{width:100%;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:13px;outline:none;color:white;}
.inp:focus{border-color:var(--amber)}.inp::placeholder{color:var(--dark)}
select.inp{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%2394a3b8' d='M5 7L1 3h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px}
textarea.inp{resize:vertical;min-height:80px}
.lbl{font-size:11px;color:var(--mute);font-weight:600;margin-bottom:4px;display:block;letter-spacing:.3px;text-transform:uppercase;}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.mono{font-family:'JetBrains Mono',monospace}
.tabs{display:flex;gap:4px;background:var(--inp);border-radius:10px;padding:4px;border:1px solid var(--border);overflow-x:auto;}
.tab{flex:1;padding:8px 6px;text-align:center;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;color:var(--dim);transition:all .2s;user-select:none;white-space:nowrap;}
.tab.active{background:var(--amber);color:#000}
.chk-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;cursor:pointer;user-select:none}
.chk-item.done{border-color:#22c55e25;background:#22c55e08}
.chkbox{width:20px;height:20px;border-radius:5px;border:2px solid var(--dark);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chkbox.done{background:var(--green);border-color:var(--green)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.g-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;backdrop-filter:blur(3px);}
.mbody{max-width:550px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.5);}
.prog{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:8px}
.pfill{height:100%;border-radius:3px;transition:width .4s ease}
.mcard{padding:14px;background:var(--inp);border-radius:10px;border-left:3px solid}
.dr{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.dr:last-child{border-bottom:none}
.dl{color:var(--mute);min-width:110px;font-weight:600;flex-shrink:0}
.dv{color:var(--text);flex:1}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--green);color:#000;padding:12px 24px;border-radius:12px;font-weight:700;font-size:14px;z-index:2000;box-shadow:0 4px 20px #22c55e40}
.loading-screen{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:3000;color:white;flex-direction:column;gap:15px;backdrop-filter:blur(5px);font-weight:700;}
.fl-filter-chip{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;user-select:none;border:1px solid var(--border);background:var(--inp);color:var(--dim);transition:all .2s;white-space:nowrap}
.fl-filter-chip.active{border-color:var(--amber);background:#f59e0b18;color:var(--amber)}
.fuel-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700}
.fuel-badge.electric{background:#a855f720;color:#c084fc;border:1px solid #a855f730}
.fuel-badge.diesel{background:#64748b20;color:#94a3b8;border:1px solid #64748b30}
.fuel-badge.gasoline{background:#f59e0b20;color:#fbbf24;border:1px solid #f59e0b30}
.fuel-badge.lpg{background:#f9731620;color:#fb923c;border:1px solid #f9731630}
.fuel-badge.hybrid{background:#22c55e20;color:#4ade80;border:1px solid #22c55e30}
.tp-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;background:#06b6d420;color:#22d3ee;border:1px solid #06b6d430}
.st-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;background:#ec489920;color:#f472b6;border:1px solid #ec489930}
@media(max-width:600px){.grid-2{grid-template-columns:1fr}.g-auto{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="app"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo,useRef,memo}=React;
const GOOGLE_SCRIPT_URL="https://script.google.com/macros/s/AKfycby29FSo8URGOLlHAkNUevL1SCwXtzR83Tttal0fiYluGfiNy8qYpEtu5CFokt1kRu0O/exec";
const DEF_M250=["Motor yaÄŸÄ± seviyesini kontrol et","YaÄŸ filtresi","Hava filtresi","Hidrolik yaÄŸ seviyesi","Fren hidroliÄŸi","Lastik basÄ±nÃ§larÄ±","Zincir gerginliÄŸi","Ã‡atal aÅŸÄ±nmasÄ±","Gres yaÄŸlama","Hidrolik hortumlar","SÄ±zÄ±ntÄ± kontrolÃ¼","Egzoz sistemi","IÅŸÄ±klar ve Korna","Emniyet kemeri","El freni"];
const DEF_M500=["Motor yaÄŸÄ± deÄŸiÅŸimi","YaÄŸ filtresi deÄŸiÅŸimi","Hava filtresi deÄŸiÅŸimi","YakÄ±t filtresi","Hidrolik yaÄŸ deÄŸiÅŸimi","Hidrolik filtre","Diferansiyel yaÄŸÄ±","Fren balatalarÄ±","AsansÃ¶r rulmanlarÄ±","Motor takozlarÄ±","AlternatÃ¶r kayÄ±ÅŸÄ±","SoÄŸutma sistemi","Bujiler/EnjektÃ¶rler","TÃ¼m contalar"];
const DEF_M2000=["Motor komple bakÄ±m","ÅanzÄ±man yaÄŸÄ± deÄŸiÅŸimi","ÅanzÄ±man filtresi","Diferansiyel komple bakÄ±m","Hidrolik sistem komple bakÄ±m","Hidrolik pompa kontrolÃ¼","Hidrolik silindir contalarÄ±","Direksiyon sistemi komple","Fren sistemi komple revizyon","Ã–n aks/Arka aks kontrolÃ¼","AsansÃ¶r zinciri deÄŸiÅŸimi","Ã‡atal kontrol/deÄŸiÅŸim","TÃ¼m rulmanlar kontrol","Elektrik sistemi komple kontrol","MarÅŸ motoru/AlternatÃ¶r kontrol","RadyatÃ¶r temizlik/kontrol","Egzoz sistemi komple","TÃ¼m hortum ve kelepÃ§eler","Kabin/Koruma kafesi kontrol","Genel test ve kalibrasyon"];
const DEF_WCHK=["Ã‡alÄ±ÅŸma saati","Motor yaÄŸÄ±","SoÄŸutma suyu","Hidrolik yaÄŸ","Fren testi","Direksiyon testi","Ã‡atallar","Lastikler","AydÄ±nlatma","Korna","Emniyet kemeri","SÄ±zÄ±ntÄ± kontrolÃ¼","Genel temizlik"];
const DEF_EM250=["Batarya su seviyesi kontrolÃ¼","Batarya kutup baÅŸlarÄ± temizliÄŸi","Åarj sistemi kontrolÃ¼","Hidrolik yaÄŸ seviyesi","Fren hidroliÄŸi","Lastik basÄ±nÃ§larÄ±","Zincir gerginliÄŸi","Ã‡atal aÅŸÄ±nmasÄ±","Gres yaÄŸlama","Hidrolik hortumlar","SÄ±zÄ±ntÄ± kontrolÃ¼","IÅŸÄ±klar ve Korna","Emniyet kemeri","El freni"];
const DEF_EM500=["Batarya yoÄŸunluk testi","Batarya baÄŸlantÄ± kontrolÃ¼","Åarj cihazÄ± kontrolÃ¼","Hidrolik yaÄŸ deÄŸiÅŸimi","Hidrolik filtre","Fren balatalarÄ±","AsansÃ¶r rulmanlarÄ±","Motor fÄ±rÃ§alarÄ± kontrolÃ¼","KontaktÃ¶r kontrolÃ¼","Kablolama kontrolÃ¼","TÃ¼m contalar"];
const DEF_EM2000=["Batarya kapasite testi","Batarya komple kontrol","Elektrik motoru komple bakÄ±m","Motor fÄ±rÃ§alarÄ± deÄŸiÅŸimi","Kontrol Ã¼nitesi (controller) bakÄ±m","Hidrolik sistem komple bakÄ±m","Hidrolik pompa kontrolÃ¼","Hidrolik silindir contalarÄ±","Direksiyon sistemi komple","Fren sistemi komple revizyon","Ã–n aks/Arka aks kontrolÃ¼","AsansÃ¶r zinciri deÄŸiÅŸimi","Ã‡atal kontrol/deÄŸiÅŸim","TÃ¼m rulmanlar kontrol","TÃ¼m kablolar ve konnektÃ¶rler","TÃ¼m hortum ve kelepÃ§eler","Kabin/Koruma kafesi kontrol","Genel test ve kalibrasyon"];
const DEF_EWCHK=["Ã‡alÄ±ÅŸma saati","Batarya su seviyesi","Batarya ÅŸarj durumu","Hidrolik yaÄŸ","Fren testi","Direksiyon testi","Ã‡atallar","Lastikler","AydÄ±nlatma","Korna","Emniyet kemeri","SÄ±zÄ±ntÄ± kontrolÃ¼","Genel temizlik"];
const DEF_TP_MONTHLY=["Batarya su seviyesi","Batarya kutup baÅŸlarÄ± temizliÄŸi","Åarj cihazÄ± kontrolÃ¼","Batarya ÅŸarj durumu","Tekerlekler ve rulmanlar","Ã‡atal durumu ve aÅŸÄ±nma","Hidrolik yaÄŸ seviyesi","Hidrolik sÄ±zÄ±ntÄ± kontrolÃ¼","KaldÄ±rma/indirme testi","Kumanda kolu Ã§alÄ±ÅŸmasÄ±","Fren sistemi testi","Korna ve uyarÄ± sesleri","GÃ¶vde ve ÅŸase kontrolÃ¼","Kablo ve konnektÃ¶r kontrolÃ¼","Genel temizlik"];
const DEF_ST_MONTHLY=["Batarya durumu kontrolÃ¼","Hidrolik lift silindir sÄ±zÄ±ntÄ± kontrolÃ¼","YÃ¼rÃ¼yÃ¼ÅŸ ve kaldÄ±rma motoru testi","Frenlerin tutuÅŸ durumu","Tekerlek aÅŸÄ±nma kontrolÃ¼","Acil stop butonu kontrolÃ¼","YÃ¼k korkuluÄŸu ve ÅŸase kontrolÃ¼","Kablolama gÃ¶zle kontrol","Korna ve uyarÄ± lambalarÄ±","Kumanda paneli tuÅŸ fonksiyonlarÄ±"];
const FUELS=[{v:"diesel",l:"Dizel",e:"â›½"},{v:"gasoline",l:"Benzinli",e:"â›½"},{v:"lpg",l:"LPG",e:"ğŸ”¥"},{v:"electric",l:"Elektrikli",e:"âš¡"},{v:"hybrid",l:"Hibrit",e:"ğŸ”‹"}];
const PRIO={low:{l:"DÃ¼ÅŸÃ¼k",c:"#60a5fa"},normal:{l:"Normal",c:"#fbbf24"},high:{l:"YÃ¼ksek",c:"#f97316"},critical:{l:"Kritik",c:"#ef4444"}};
const uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);
const fd=d=>d?new Date(d).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”";
const gf=t=>FUELS.find(f=>f.v===t)||{v:"diesel",l:"Dizel",e:"â›½"};
const isElectric=(fuel)=>fuel==="electric";
const DEFAULT_LISTS={m250:DEF_M250,m500:DEF_M500,m2000:DEF_M2000,weekly:DEF_WCHK,em250:DEF_EM250,em500:DEF_EM500,em2000:DEF_EM2000,eweekly:DEF_EWCHK,tp_monthly:DEF_TP_MONTHLY,st_monthly:DEF_ST_MONTHLY};
const getListForType=(lists,maintType,fuelType)=>{
  const elc=isElectric(fuelType);
  switch(maintType){
    case 'm250':return elc?lists.em250:lists.m250;
    case 'm500':return elc?lists.em500:lists.m500;
    case 'm2000':return elc?lists.em2000:lists.m2000;
    case 'weekly':return elc?lists.eweekly:lists.weekly;
    default:return[];
  }
};
const TODAY_STR=new Date().toISOString().split('T')[0];
function matchFaultsToRepairs(faultRows,repairRows){
  const sf=[...faultRows].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
  const sr=[...repairRows].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
  const used=new Set();
  const result={};
  sf.forEach(fault=>{
    for(let i=0;i<sr.length;i++){
      if(used.has(i))continue;
      if(sr[i].faultId===fault.id&&sr[i].flId===fault.flId){
        result[fault.id]=sr[i];used.add(i);break;
      }
    }
  });
  sf.forEach(fault=>{
    if(result[fault.id])return;
    let matched=null;
    for(let i=0;i<sr.length;i++){
      if(used.has(i))continue;
      if(sr[i].flId===fault.flId&&!sr[i].faultId&&new Date(sr[i].timestamp)>new Date(fault.timestamp)){
        const dayDiff=(new Date(sr[i].timestamp).getTime()-new Date(fault.timestamp).getTime())/86400000;
        if(dayDiff>=0&&dayDiff<=7){
          matched=sr[i];used.add(i);break;
        }
      }
    }
    result[fault.id]=matched;
  });
  return result;
}
const FuelBadge=({fuelType})=>{const f=gf(fuelType);return <span className={`fuel-badge ${fuelType}`}>{f.e} {f.l}</span>;};
const TPBadge=()=><span className="tp-badge">ğŸ”‹ Elektrikli Transpalet</span>;
const STBadge=()=><span className="st-badge">ğŸ—ï¸ Ä°stif Makinesi</span>;
const ChkList=memo(function ChkList({items,chkRef}){
  const [checks,setChecks]=useState({});
  useEffect(()=>{chkRef.current=checks;},[checks]);
  return(<div style={{display:"flex",flexDirection:"column",gap:4,maxHeight:260,overflowY:"auto",paddingRight:4}}>
    {items.map((item,i)=>(
      <div key={i} className={`chk-item${checks[i]?" done":""}`} onClick={()=>setChecks(p=>({...p,[i]:!p[i]}))}>
        <div className={`chkbox${checks[i]?" done":""}`}>{checks[i]&&"âœ“"}</div>
        <span style={{fontSize:13,color:checks[i]?"var(--text)":"var(--dim)"}}>{item}</span>
      </div>
    ))}
  </div>);
});
function QRCode({data,sz=120}){
  const url="https://api.qrserver.com/v1/create-qr-code/?size="+sz+"x"+sz+"&data="+encodeURIComponent(window.location.href.split('?')[0]+"?id="+data.split('://')[1]);
  return <img src={url} style={{borderRadius:8,border:'4px solid white'}} width={sz} height={sz} alt="QR"/>;
}
function Confirm({msg,onYes,onNo}){
  return(<div className="overlay" onClick={onNo}><div className="card mbody" style={{maxWidth:380,textAlign:"center"}} onClick={e=>e.stopPropagation()}>
    <p style={{fontSize:15,marginBottom:16,lineHeight:1.6}}>{msg}</p>
    <div style={{display:"flex",gap:8,justifyContent:"center"}}><button className="btn btn-red" onClick={onYes}>Evet</button><button className="btn btn-ghost" onClick={onNo}>Ä°ptal</button></div>
  </div></div>);
}
const FormTemplate=({title,color,items,onSubmit,sel,noHours})=>{
  const r={tech:useRef(),hours:useRef(),notes:useRef(),date:useRef()};
  const chkRef=useRef({});
  const handle=()=>{
    const tech=r.tech.current.value.trim();
    const date=r.date.current.value;
    if(!tech||!date)return alert("Ä°sim ve Tarih zorunludur!");
    if(date>TODAY_STR)return alert("Ä°leri tarih girilemez!");
    if(!noHours){
      const hours=parseFloat(r.hours.current.value);
      if(isNaN(hours))return alert("Saat zorunludur!");
      if(hours<sel.hours){
        if(!confirm("âš ï¸ UYARI: GirdiÄŸiniz saat ("+hours+"), mevcut saatten ("+sel.hours+") DAHA DÃœÅÃœK.\n\nYine de kaydetmek istiyor musunuz?"))return;
      }
      onSubmit({tech,hours,date,notes:r.notes.current.value,chk:chkRef.current});
    }else{
      onSubmit({tech,hours:0,date,notes:r.notes.current.value,chk:chkRef.current});
    }
    r.tech.current.value="";
    if(!noHours&&r.hours.current)r.hours.current.value="";
    r.notes.current.value="";
  };
  return(<div className="card">
    <h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:color}}>{title}</h3>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={TODAY_STR} max={TODAY_STR}/></div>
      {noHours?(
        <div><label className="lbl">Personel</label><input ref={r.tech} className="inp" placeholder="Ad Soyad"/></div>
      ):(
        <div className="grid-2">
          <div><label className="lbl">Personel</label><input ref={r.tech} className="inp" placeholder="Ad Soyad"/></div>
          <div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>
        </div>
      )}
      {items&&<>
        <div style={{fontSize:12,color:"var(--dim)",fontWeight:600,marginTop:5}}>YapÄ±lacak Ä°ÅŸler</div>
        <ChkList items={items} chkRef={chkRef}/>
      </>}
      <div><label className="lbl">Notlar</label><textarea ref={r.notes} className="inp" placeholder="Detaylar..."/></div>
      <button className="btn" style={{background:color,color:['var(--amber)','var(--green)','var(--cyan)','var(--pink)'].includes(color)?'black':'white',width:'100%',justifyContent:'center'}} onClick={handle}>KAYDET</button>
    </div>
  </div>);
};
const FaultForm=({sel,onSubmit,isNoHours})=>{
  const r={by:useRef(),hours:useRef(),prio:useRef(),desc:useRef(),date:useRef()};
  const handle=()=>{
    const by=r.by.current.value.trim(),desc=r.desc.current.value.trim(),date=r.date.current.value;
    const hours=isNoHours?0:parseFloat(r.hours.current?.value);
    if(!by||!desc||!date)return alert("Eksik bilgi.");
    if(date>TODAY_STR)return alert("Ä°leri tarih girilemez!");
    if(!isNoHours&&hours<sel.hours){
      if(!confirm("âš ï¸ GirdiÄŸiniz saat ("+hours+") mevcut saatten ("+sel.hours+") dÃ¼ÅŸÃ¼k! Devam edilsin mi?"))return;
    }
    onSubmit({by,hours,prio:r.prio.current.value,desc,date});
    r.by.current.value="";
    if(!isNoHours&&r.hours.current)r.hours.current.value="";
    r.desc.current.value="";
    r.prio.current.value="normal";
  };
  return(<div className="card"><h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:"var(--red)"}}>ğŸ”´ ArÄ±za Bildirimi</h3>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={TODAY_STR} max={TODAY_STR}/></div>
      <div><label className="lbl">Bildiren</label><input ref={r.by} className="inp" placeholder="Ad Soyad"/></div>
      <div className="grid-2">
        {!isNoHours&&<div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>}
        <div><label className="lbl">Ã–ncelik</label><select ref={r.prio} className="inp" defaultValue="normal">{Object.entries(PRIO).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}</select></div>
      </div>
      <div><label className="lbl">AÃ§Ä±klama</label><textarea ref={r.desc} className="inp" placeholder="ArÄ±za nedir?"/></div>
      <button className="btn btn-red" style={{width:"100%",justifyContent:"center"}} onClick={handle}>ğŸ”´ ArÄ±za Bildir</button>
    </div></div>);
};
const ListEditor=({onClose,onSave,lists,sendData})=>{
  const [localLists,setLocalLists]=useState(JSON.parse(JSON.stringify(lists)));
  const [activeTab,setActiveTab]=useState("m250");
  const [newItem,setNewItem]=useState("");
  const currentList=localLists[activeTab]||[];
  const add=()=>{if(newItem){setLocalLists({...localLists,[activeTab]:[...currentList,newItem]});setNewItem("");}};
  const del=(idx)=>{setLocalLists({...localLists,[activeTab]:currentList.filter((_,i)=>i!==idx)});};
  const save=()=>{
    sendData('list_update',{flId:'SYSTEM',flName:'SYSTEM',person:'admin',hours:0,note:JSON.stringify(localLists)});
    onSave(localLists);onClose();
  };
  return(<div className="overlay" onClick={onClose}><div className="card mbody" onClick={e=>e.stopPropagation()}>
    <h3 style={{marginBottom:6}}>ğŸ“ Kontrol Listelerini DÃ¼zenle</h3>
    <div style={{fontSize:11,color:'var(--mute)',fontWeight:700,marginTop:12,marginBottom:4,letterSpacing:1}}>â›½ STANDART FORKLÄ°FT (Dizel/Benzin/LPG/Hibrit)</div>
    <div className="tabs" style={{marginBottom:6}}>
      {[{k:'m250',l:'250h'},{k:'m500',l:'500h'},{k:'m2000',l:'2000h'},{k:'weekly',l:'HaftalÄ±k'}].map(t=>(
        <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
      ))}
    </div>
    <div style={{fontSize:11,color:'#c084fc',fontWeight:700,marginTop:8,marginBottom:4,letterSpacing:1}}>âš¡ ELEKTRÄ°KLÄ° FORKLÄ°FT</div>
    <div className="tabs" style={{marginBottom:6}}>
      {[{k:'em250',l:'250h'},{k:'em500',l:'500h'},{k:'em2000',l:'2000h'},{k:'eweekly',l:'HaftalÄ±k'}].map(t=>(
        <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} style={activeTab===t.k?{background:'#a855f7',color:'#fff'}:{}} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
      ))}
    </div>
    <div style={{fontSize:11,color:'#22d3ee',fontWeight:700,marginTop:8,marginBottom:4,letterSpacing:1}}>ğŸ”‹ ELEKTRÄ°KLÄ° KÃœÃ‡ÃœK EKÄ°PMANLAR</div>
    <div className="tabs" style={{marginBottom:10}}>
      <div className={`tab ${activeTab==='tp_monthly'?'active':''}`} style={activeTab==='tp_monthly'?{background:'var(--cyan)',color:'#000'}:{}} onClick={()=>setActiveTab('tp_monthly')}>Transpalet</div>
      <div className={`tab ${activeTab==='st_monthly'?'active':''}`} style={activeTab==='st_monthly'?{background:'var(--pink)',color:'#fff'}:{}} onClick={()=>setActiveTab('st_monthly')}>Ä°stif Makinesi</div>
    </div>
    <div style={{fontSize:12,fontWeight:700,color:activeTab==='tp_monthly'?'#22d3ee':activeTab==='st_monthly'?'var(--pink)':activeTab.startsWith('e')?'#c084fc':'var(--amber)',marginBottom:8,display:'flex',alignItems:'center',gap:6}}>
      <span>{activeTab==='tp_monthly'?'ğŸ”‹ ':activeTab==='st_monthly'?'ğŸ—ï¸ ':activeTab.startsWith('e')?'âš¡ ':'â›½ '}</span>
      <span>{activeTab==='tp_monthly'?'Transpalet â€” HaftalÄ±k Kontrol':activeTab==='st_monthly'?'Ä°stif Makinesi â€” HaftalÄ±k Kontrol':(activeTab.startsWith('e')?'Elektrikli':'Standart')+' â€” '+activeTab.replace('e','').replace('weekly','HaftalÄ±k').replace('m','').replace('250','250 Saat').replace('500','500 Saat').replace('2000','2000 Saat')}</span>
      <span style={{marginLeft:'auto',fontSize:11,color:'var(--dim)'}}>{currentList.length} madde</span>
    </div>
    <div style={{display:'flex',gap:5,marginBottom:10}}>
      <input className="inp" value={newItem} onChange={e=>setNewItem(e.target.value)} placeholder="Yeni madde..." onKeyDown={e=>{if(e.key==='Enter')add()}}/>
      <button className="btn btn-amber" onClick={add}>+</button>
    </div>
    <div style={{maxHeight:250,overflowY:'auto'}}>
      {currentList.map((it,i)=>(<div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:8,borderBottom:'1px solid #333'}}><span style={{fontSize:13}}>{it}</span><button style={{color:'red',background:'none',border:'none',cursor:'pointer',fontSize:14}} onClick={()=>del(i)}>ğŸ—‘</button></div>))}
      {currentList.length===0&&<div style={{padding:20,textAlign:'center',color:'var(--dark)',fontSize:13}}>Liste boÅŸ. YukarÄ±dan madde ekleyin.</div>}
    </div>
    <button className="btn btn-green" style={{width:'100%',marginTop:10,justifyContent:'center'}} onClick={save}>ğŸ’¾ KAYDET VE Ã‡IK</button>
  </div></div>);
};
const FuelTypeModal=({forklift,onClose,onSave,currentFuel,sendData})=>{
  const [selected,setSelected]=useState(currentFuel);
  const save=()=>{
    sendData('fuel_type_set',{flId:forklift.id,flName:forklift.name,person:'admin',hours:0,note:selected});
    onSave();onClose();
  };
  return(<div className="overlay" onClick={onClose}><div className="card mbody" style={{maxWidth:400}} onClick={e=>e.stopPropagation()}>
    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}}>
      <h3 style={{fontSize:16,fontWeight:700}}>YakÄ±t Tipi DeÄŸiÅŸtir</h3>
      <button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button>
    </div>
    <div style={{fontSize:13,color:'var(--dim)',marginBottom:14}}><b style={{color:'var(--text)'}}>{forklift.name}</b> iÃ§in yakÄ±t tipini seÃ§in</div>
    <div style={{display:'flex',flexDirection:'column',gap:6}}>
      {FUELS.map(f=>(
        <div key={f.v} onClick={()=>setSelected(f.v)} style={{display:'flex',alignItems:'center',gap:10,padding:'12px 14px',borderRadius:10,cursor:'pointer',border:'2px solid '+(selected===f.v?(f.v==='electric'?'#a855f7':'var(--amber)'):'var(--border)'),background:selected===f.v?(f.v==='electric'?'#a855f710':'#f59e0b08'):'var(--inp)',transition:'all .2s'}}>
          <span style={{fontSize:20}}>{f.e}</span>
          <span style={{fontWeight:700,fontSize:14,color:selected===f.v?'var(--text)':'var(--dim)'}}>{f.l}</span>
          {selected===f.v&&<span style={{marginLeft:'auto',color:f.v==='electric'?'#a855f7':'var(--amber)',fontWeight:800}}>âœ“</span>}
        </div>
      ))}
    </div>
    <div style={{marginTop:14,padding:10,borderRadius:8,background:'#f59e0b10',border:'1px solid #f59e0b20',fontSize:12,color:'var(--amber)'}}>
      âš  YakÄ±t tipi deÄŸiÅŸtirildiÄŸinde, bakÄ±m formlarÄ±ndaki kontrol listesi otomatik olarak ilgili tipe gÃ¶re deÄŸiÅŸecektir.
    </div>
    <button className="btn btn-green" style={{width:'100%',marginTop:12,justifyContent:'center'}} onClick={save}>ğŸ’¾ Kaydet</button>
  </div></div>);
};
function App(){
  const [data,setData]=useState({forklifts:[],faults:[],m250:[],m500:[],m2000:[],weekly:[]});
  const [lists,setLists]=useState(DEFAULT_LISTS);
  const [fuelTypes,setFuelTypes]=useState({});
  const [deletedIDs,setDeletedIDs]=useState([]);
  const [hoursOverrides,setHoursOverrides]=useState({});
  const [pg,setPg]=useState("dash");
  const [sub,setSub]=useState("overview");
  const [sel,setSel]=useState(null);
  const [tab,setTab]=useState("status");
  const [modal,setModal]=useState(null);
  const [dateFilt,setDateFilt]=useState({start:"",end:""});
  const [detailModal,setDetailModal]=useState(null);
  const [confirmDel,setConfirmDel]=useState(null);
  const [repTgt,setRepTgt]=useState(null);
  const [toast,setToast]=useState(null);
  const [editFL,setEditFL]=useState(null);
  const [loading,setLoading]=useState(false);
  const [selFL,setSelFL]=useState(null);
  const [fuelModal,setFuelModal]=useState(null);
  const [transpalets,setTranspalets]=useState([]);
  const [tpChecks,setTpChecks]=useState([]);
  const [tpFaults,setTpFaults]=useState([]);
  const [selTP,setSelTP]=useState(null);
  const [tpRepTgt,setTpRepTgt]=useState(null);
  const [tpTab,setTpTab]=useState("status");
  const [stackers,setStackers]=useState([]);
  const [stChecks,setStChecks]=useState([]);
  const [stFaults,setStFaults]=useState([]);
  const [selST,setSelST]=useState(null);
  const [stRepTgt,setStRepTgt]=useState(null);
  const [stTab,setStTab]=useState("status");
  const [passwordUnlocked,setPasswordUnlocked]=useState(false);
  const flRefs={name:useRef(),brand:useRef(),model:useRef(),hours:useRef(),fuel:useRef()};
  const tpRefs={name:useRef(),brand:useRef(),model:useRef()};
  const stRefs={name:useRef(),brand:useRef(),model:useRef()};
  const tpRepRefs={by:useRef(),desc:useRef(),date:useRef()};
  const stRepRefs={by:useRef(),desc:useRef(),date:useRef()};
  const rpRefs={by:useRef(),hours:useRef(),desc:useRef(),parts:useRef(),date:useRef()};
  const showToast=m=>{setToast(m);setTimeout(()=>setToast(null),2e3);};
  const checkPassword=(callback)=>{
    if(passwordUnlocked){callback();return;}
    const pw=prompt("Bu bÃ¶lÃ¼me eriÅŸmek iÃ§in ÅŸifre gereklidir:");
    if(pw==="137998"){setPasswordUnlocked(true);callback();}
    else if(pw!==null){alert("YanlÄ±ÅŸ ÅŸifre!");}
  };
  const getFuelType=(flId)=>fuelTypes[flId]||"diesel";
  const fetchData=(silent)=>{
    if(!silent)setLoading(true);
    fetch(GOOGLE_SCRIPT_URL+"?action=read")
      .then(r=>r.json())
      .then(resp=>{if(!silent)setLoading(false);if(resp.data)processGoogleData(resp.data);})
      .catch(e=>{if(!silent)setLoading(false);if(!silent)showToast("BaÄŸlantÄ± hatasÄ±");});
  };
  const processGoogleData=(rawData)=>{
    const newData={forklifts:[],faults:[],m250:[],m500:[],m2000:[],weekly:[]};
    const flMap={};
    const tpMap={};
    const tpChecksList=[];
    const tpFaultsList=[];
    const stMap={};
    const stChecksList=[];
    const stFaultsList=[];
    const ftMap={};
    const delIDs=[];
    const hoMap={};
    let latestLists=null;
    let latestListsTime=0;
    rawData.forEach(row=>{
      if(row.type==='fuel_type_set'){ftMap[row.flId]=row.note;}
      if(row.type==='equipment_delete'){if(!delIDs.includes(row.flId))delIDs.push(row.flId);}
      if(row.type==='hours_override'){
        const prev=hoMap[row.flId];
        if(!prev||new Date(row.timestamp)>new Date(prev.timestamp)){
          hoMap[row.flId]=row;
        }
      }
      if(row.type==='list_update'){
        const t=new Date(row.timestamp).getTime();
        if(t>latestListsTime){latestListsTime=t;try{latestLists=JSON.parse(row.note);}catch(e){}}
      }
    });
    setFuelTypes(ftMap);
    setDeletedIDs(delIDs);
    setHoursOverrides(hoMap);
    const currentLists=latestLists||DEFAULT_LISTS;
    const mergedLists={...DEFAULT_LISTS,...currentLists};
    setLists(mergedLists);
    const gft=(flId)=>ftMap[flId]||"diesel";
    const repairs=rawData.filter(r=>r.type==='repair');
    const tpRepairs=rawData.filter(r=>r.type==='tp_repair');
    const stRepairs=rawData.filter(r=>r.type==='st_repair');
    const faultRows=rawData.filter(r=>r.type==='fault');
    const tpFaultRows=rawData.filter(r=>r.type==='tp_fault');
    const stFaultRows=rawData.filter(r=>r.type==='st_fault');
    repairs.forEach(r=>{if(r.checks&&r.checks.startsWith('FAULTID:')){r.faultId=r.checks.replace('FAULTID:','');}});
    tpRepairs.forEach(r=>{if(r.checks&&r.checks.startsWith('FAULTID:')){r.faultId=r.checks.replace('FAULTID:','');}});
    stRepairs.forEach(r=>{if(r.checks&&r.checks.startsWith('FAULTID:')){r.faultId=r.checks.replace('FAULTID:','');}});
    const faultRepairMap=matchFaultsToRepairs(faultRows,repairs);
    const tpFaultRepairMap=matchFaultsToRepairs(tpFaultRows,tpRepairs);
    const stFaultRepairMap=matchFaultsToRepairs(stFaultRows,stRepairs);
    rawData.forEach(row=>{
      if(delIDs.includes(row.flId))return;
      if(row.type==='forklift_register'){
        flMap[row.flId]={id:row.flId,name:row.flName,brand:row.person,model:row.note,hours:Number(row.hours),status:'active',fuel:gft(row.flId)};
      }
      if(row.type==='transpalet_register'||row.type==='transpalet_update'){
        tpMap[row.flId]={id:row.flId,name:row.flName,brand:row.person,model:row.note,hours:0,status:'active',isTP:true};
      }
      if(row.type==='stacker_register'||row.type==='stacker_update'){
        stMap[row.flId]={id:row.flId,name:row.flName,brand:row.person,model:row.note,hours:0,status:'active',isST:true};
      }
    });
    rawData.forEach(row=>{
      if(delIDs.includes(row.flId))return;
      if(row.type!=='hours_override'&&row.type!=='forklift_register'){
        if(flMap[row.flId]&&Number(row.hours)>flMap[row.flId].hours){
          flMap[row.flId].hours=Number(row.hours);
        }
      }
      const checksArr=(row.checks&&row.checks.trim()&&!row.checks.startsWith('FAULTID:')&&!row.checks.startsWith('PRIO:'))?row.checks.split(',').map(s=>s.trim()).filter(s=>s!==''):[];
      const baseRec={id:row.id,fid:row.flId,fn:row.flName,h:Number(row.hours),notes:row.note,dt:row.timestamp,done:checksArr.length,checksArr:checksArr};
      if(row.type==='m250')newData.m250.push({...baseRec,tech:row.person,mType:'m250'});
      if(row.type==='m500')newData.m500.push({...baseRec,tech:row.person,mType:'m500'});
      if(row.type==='m2000')newData.m2000.push({...baseRec,tech:row.person,mType:'m2000'});
      if(row.type==='weekly')newData.weekly.push({...baseRec,tech:row.person,mType:'weekly'});
      if(row.type==='fault'){
        const repairLog=faultRepairMap[row.id]||null;
        const status=repairLog?'closed':'open';
        const prio=(row.checks&&row.checks.startsWith('PRIO:'))?row.checks.replace('PRIO:',''):'high';
        newData.faults.push({...baseRec,desc:row.note,by:row.person,st:status,od:row.timestamp,prio:prio,closedBy:repairLog?repairLog.person:null,closedDesc:repairLog?repairLog.note:null,closedDt:repairLog?repairLog.timestamp:null});
        if(status==='open'&&flMap[row.flId])flMap[row.flId].status='fault';
      }
      if(row.type==='tp_monthly'){
        tpChecksList.push({id:row.id,tpId:row.flId,tech:row.person,dt:row.timestamp,notes:row.note,checksArr:checksArr,done:checksArr.length});
      }
      if(row.type==='st_monthly'){
        stChecksList.push({id:row.id,stId:row.flId,tech:row.person,dt:row.timestamp,notes:row.note,checksArr:checksArr,done:checksArr.length});
      }
      if(row.type==='tp_fault'){
        const repairLog=tpFaultRepairMap[row.id]||null;
        const isRepaired=!!repairLog;
        const prio=(row.checks&&row.checks.startsWith('PRIO:'))?row.checks.replace('PRIO:',''):'high';
        tpFaultsList.push({id:row.id,tpId:row.flId,tpName:row.flName,by:row.person,desc:row.note,prio:prio,dt:row.timestamp,st:isRepaired?'closed':'open',closedBy:repairLog?repairLog.person:null,closedDesc:repairLog?repairLog.note:null,closedDt:repairLog?repairLog.timestamp:null});
      }
      if(row.type==='st_fault'){
        const repairLog=stFaultRepairMap[row.id]||null;
        const isRepaired=!!repairLog;
        const prio=(row.checks&&row.checks.startsWith('PRIO:'))?row.checks.replace('PRIO:',''):'high';
        stFaultsList.push({id:row.id,stId:row.flId,stName:row.flName,by:row.person,desc:row.note,prio:prio,dt:row.timestamp,st:isRepaired?'closed':'open',closedBy:repairLog?repairLog.person:null,closedDesc:repairLog?repairLog.note:null,closedDt:repairLog?repairLog.timestamp:null});
      }
    });
    Object.keys(hoMap).forEach(flId=>{
      if(flMap[flId]){
        const overrideRow=hoMap[flId];
        const overrideHours=Number(overrideRow.hours);
        const overrideTime=new Date(overrideRow.timestamp).getTime();
        let maxAfterOverride=overrideHours;
        rawData.forEach(row=>{
          if(row.flId===flId&&row.type!=='hours_override'&&row.type!=='forklift_register'&&row.type!=='equipment_delete'&&row.type!=='fuel_type_set'&&row.type!=='list_update'){
            if(new Date(row.timestamp).getTime()>overrideTime&&Number(row.hours)>maxAfterOverride){
              maxAfterOverride=Number(row.hours);
            }
          }
        });
        flMap[flId].hours=maxAfterOverride;
      }
    });
    const newForklifts=Object.values(flMap);
    const newTranspalets=Object.values(tpMap);
    const newStackers=Object.values(stMap);
    newData.forklifts=newForklifts;
    setData(newData);
    setTranspalets(newTranspalets);
    setTpChecks(tpChecksList);
    setTpFaults(tpFaultsList);
    setStackers(newStackers);
    setStChecks(stChecksList);
    setStFaults(stFaultsList);
    setSel(prev=>{
      if(!prev)return null;
      const updated=newForklifts.find(f=>f.id===prev.id);
      return updated||null;
    });
    setSelTP(prev=>{
      if(!prev)return null;
      const updated=newTranspalets.find(t=>t.id===prev.id);
      return updated||null;
    });
    setSelST(prev=>{
      if(!prev)return null;
      const updated=newStackers.find(s=>s.id===prev.id);
      return updated||null;
    });
  };
  const sendData=(type,payload)=>{
    setLoading(true);
    const d=new FormData();
    d.append("action","write");
    d.append("id",uid());
    d.append("type",type);
    d.append("flId",payload.flId||"");
    d.append("flName",payload.flName||"");
    d.append("person",payload.person);
    d.append("hours",payload.hours);
    d.append("note",payload.note||payload.desc||"");
    if(payload.date)d.append("customDate",payload.date);
    let chkStr="";
    if(type==='fault'||type==='tp_fault'||type==='st_fault'){
      chkStr="PRIO:"+(payload.prio||"normal");
    }else if(payload.faultId&&(type==='repair'||type==='tp_repair'||type==='st_repair')){
      chkStr="FAULTID:"+payload.faultId;
    }else if(payload.chk){
      if(type==='tp_monthly'){
        chkStr=Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>lists.tp_monthly[k]).join(", ");
      }else if(type==='st_monthly'){
        chkStr=Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>lists.st_monthly[k]).join(", ");
      }else{
        const fuelType=payload.flId?getFuelType(payload.flId):"diesel";
        const listArr=getListForType(lists,type,fuelType);
        chkStr=Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>listArr[k]).join(", ");
      }
    }
    d.append("checks",chkStr);
    fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:d})
      .then(r=>r.json())
      .then(resp=>{
        if(resp.result==="success"){
          showToast("Kaydedildi!");
          fetchData();
          setTab("status");
          setModal(null);
          setRepTgt(null);
          setTpRepTgt(null);
          setStRepTgt(null);
        }else{alert("Hata");setLoading(false);}
      })
      .catch(e=>{setLoading(false);alert("BaÄŸlantÄ± HatasÄ±");});
  };
  useEffect(()=>{
    fetchData();
    const p=new URLSearchParams(window.location.search);
    const qid=p.get('id');
    if(qid)window.autoSelectId=qid;
    const interval=setInterval(()=>fetchData(true),60000);
    return ()=>clearInterval(interval);
  },[]);
  useEffect(()=>{
    if(window.autoSelectId&&(data.forklifts.length>0||transpalets.length>0||stackers.length>0)){
      const qid=window.autoSelectId;
      const f=data.forklifts.find(x=>x.id===qid);
      if(f){setSel(f);setSelTP(null);setSelST(null);setPg("mob");window.autoSelectId=null;return;}
      const tp=transpalets.find(x=>x.id===qid);
      if(tp){setSelTP(tp);setSel(null);setSelST(null);setTpTab("status");setPg("mob");window.autoSelectId=null;return;}
      const st=stackers.find(x=>x.id===qid);
      if(st){setSelST(st);setSel(null);setSelTP(null);setStTab("status");setPg("mob");window.autoSelectId=null;return;}
    }
  },[data,transpalets,stackers]);
  const gS=useCallback(f=>{
    const fuelType=getFuelType(f.id);
    const m2=data.m250.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const m5=data.m500.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const m20=data.m2000.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const ws=data.weekly.filter(w=>w.fid===f.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const fts=data.faults.filter(x=>x.fid===f.id);
    const opn=fts.filter(x=>x.st==="open");
    const l2h=m2[0]?.h||0,l5h=m5[0]?.h||0,l20h=m20[0]?.h||0;
    const n2=l2h+250,n5=l5h+500,n20=l20h+2000,r2=n2-f.hours,r5=n5-f.hours,r20=n20-f.hours;
    const dw=ws[0]?Math.floor((Date.now()-new Date(ws[0].dt).getTime())/864e5):999;
    return{l2:m2[0],l5:m5[0],l20:m20[0],lw:ws[0],l2h,l5h,l20h,n2,n5,n20,r2,r5,r20,o2:r2<=0,o5:r5<=0,o20:r20<=0,w2:r2>0&&r2<=30,w5:r5>0&&r5<=50,w20:r20>0&&r20<=200,dw,ow:dw>7,opn,allF:fts,inF:opn.length>0||f.status==="fault"};
  },[data,fuelTypes]);
  const deleteEquipment=(id,type)=>{
    sendData('equipment_delete',{flId:id,flName:type,person:'admin',hours:0,note:'deleted'});
    if(sel?.id===id)setSel(null);
    if(selTP?.id===id)setSelTP(null);
    if(selST?.id===id)setSelST(null);
    showToast(type+" Silindi");
  };
  const addFL=()=>{
    const name=flRefs.name.current?.value?.trim();
    if(!name)return alert("Ad zorunlu.");
    const flId="FL-"+uid();
    const fuelType=flRefs.fuel.current?.value||"diesel";
    setLoading(true);
    const d1=new FormData();
    d1.append("action","write");
    d1.append("id",uid());
    d1.append("type","forklift_register");
    d1.append("flId",flId);
    d1.append("flName",name);
    d1.append("person",flRefs.brand.current.value.trim());
    d1.append("hours",parseFloat(flRefs.hours.current.value)||0);
    d1.append("note",flRefs.model.current.value.trim());
    d1.append("checks","");
    fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:d1}).then(r=>r.json()).then(()=>{
      const d2=new FormData();
      d2.append("action","write");
      d2.append("id",uid());
      d2.append("type","fuel_type_set");
      d2.append("flId",flId);
      d2.append("flName",name);
      d2.append("person","admin");
      d2.append("hours",0);
      d2.append("note",fuelType);
      d2.append("checks","");
      return fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:d2});
    }).then(r=>r.json()).then(()=>{
      showToast("Forklift Eklendi!");
      fetchData();
      setModal(null);
    }).catch(()=>{setLoading(false);alert("Hata");});
  };
  const addTP=()=>{
    const name=tpRefs.name.current?.value?.trim();
    if(!name)return alert("Ad zorunlu.");
    const tpId="TP-"+uid();
    sendData('transpalet_register',{flId:tpId,flName:name,person:tpRefs.brand.current?.value?.trim()||"",note:tpRefs.model.current?.value?.trim()||"",hours:0});
    setModal(null);
  };
  const addST=()=>{
    const name=stRefs.name.current?.value?.trim();
    if(!name)return alert("Ad zorunlu.");
    const stId="ST-"+uid();
    sendData('stacker_register',{flId:stId,flName:name,person:stRefs.brand.current?.value?.trim()||"",note:stRefs.model.current?.value?.trim()||"",hours:0});
    setModal(null);
  };
  const handleFaultSubmit=({by,hours,prio,desc,date})=>sendData('fault',{flId:sel.id,flName:sel.name,person:by,hours,note:desc,prio,date});
  const handle250=({tech,hours,notes,chk,date})=>sendData('m250',{flId:sel.id,flName:sel.name,person:tech,hours,note:notes,chk,date});
  const handle500=({tech,hours,notes,chk,date})=>sendData('m500',{flId:sel.id,flName:sel.name,person:tech,hours,note:notes,chk,date});
  const handle2000=({tech,hours,notes,chk,date})=>sendData('m2000',{flId:sel.id,flName:sel.name,person:tech,hours,note:notes,chk,date});
  const handleWk=({tech,hours,notes,chk,date})=>sendData('weekly',{flId:sel.id,flName:sel.name,person:tech,hours,note:notes,chk,date});
  const handleTPCheck=({tech,hours,notes,chk,date})=>{
    sendData('tp_monthly',{flId:selTP.id,flName:selTP.name,person:tech,hours:0,note:notes,chk,date});
    setTpTab("status");
  };
  const handleSTCheck=({tech,hours,notes,chk,date})=>{
    sendData('st_monthly',{flId:selST.id,flName:selST.name,person:tech,hours:0,note:notes,chk,date});
    setStTab("status");
  };
  const getTPStatus=useCallback((tp)=>{
    const checks=tpChecks.filter(c=>c.tpId===tp.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const last=checks[0];
    const dw=last?Math.floor((Date.now()-new Date(last.dt).getTime())/864e5):999;
    const faults=tpFaults.filter(f=>f.tpId===tp.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const openFaults=faults.filter(f=>f.st==='open');
    return{last,dw,overdue:dw>7,checks,faults,openFaults,hasFault:openFaults.length>0};
  },[tpChecks,tpFaults]);
  const getSTStatus=useCallback((st)=>{
    const checks=stChecks.filter(c=>c.stId===st.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const last=checks[0];
    const dw=last?Math.floor((Date.now()-new Date(last.dt).getTime())/864e5):999;
    const faults=stFaults.filter(f=>f.stId===st.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const openFaults=faults.filter(f=>f.st==='open');
    return{last,dw,overdue:dw>7,checks,faults,openFaults,hasFault:openFaults.length>0};
  },[stChecks,stFaults]);
  const StatusBadge=({s})=>{
    if(s.hasFault)return <span className="badge" style={{background:"#ef444425",color:"#ef4444"}}>ğŸ”´ ARIZALI</span>;
    if(s.overdue)return <span className="badge" style={{background:"#ef444418",color:"#f87171"}}>âš  GecikmiÅŸ</span>;
    return <span className="badge" style={{background:"#22c55e18",color:"#4ade80"}}>âœ“ Aktif</span>;
  };
  const submitTPFault=(tpId,tpName,by,desc,prio,date)=>{
    sendData('tp_fault',{flId:tpId,flName:tpName,person:by,hours:0,note:desc,prio:prio||'normal',date});
    setTpTab("status");
  };
  const submitSTFault=(stId,stName,by,desc,prio,date)=>{
    sendData('st_fault',{flId:stId,flName:stName,person:by,hours:0,note:desc,prio:prio||'normal',date});
    setStTab("status");
  };
  const closeTPFault=(faultId,flId,flName,by,desc,date)=>{
    sendData('tp_repair',{flId:flId,flName:flName,person:by,hours:0,note:desc,date,faultId:faultId});
    setTpRepTgt(null);
  };
  const closeSTFault=(faultId,flId,flName,by,desc,date)=>{
    sendData('st_repair',{flId:flId,flName:flName,person:by,hours:0,note:desc,date,faultId:faultId});
    setStRepTgt(null);
  };
  const doCloseFault=(targetFault)=>{
    const by=rpRefs.by.current?.value?.trim();
    if(!by)return alert("Ä°sim gir");
    if(rpRefs.date.current.value>TODAY_STR)return alert("Ä°leri tarih girilemez!");
    const date=rpRefs.date.current.value;
    sendData('repair',{flId:targetFault.fid,flName:targetFault.fn,person:by,hours:rpRefs.hours.current?.value||0,note:rpRefs.desc.current?.value,date,faultId:targetFault.id});
  };
  const stats=useMemo(()=>{
    let ov=0,wr=0,ft=0;
    data.forklifts.forEach(f=>{const s=gS(f);if(s.inF)ft++;if(s.o2||s.o5||s.o20||s.ow)ov++;else if(s.w2||s.w5||s.w20)wr++;});
    let tpOv=0,tpFt=0;
    transpalets.forEach(tp=>{const s=getTPStatus(tp);if(s.overdue)tpOv++;if(s.hasFault)tpFt++;});
    let stOv=0,stFt=0;
    stackers.forEach(st=>{const s=getSTStatus(st);if(s.overdue)stOv++;if(s.hasFault)stFt++;});
    const tpOpenFaults=tpFaults.filter(f=>f.st==='open').length;
    const stOpenFaults=stFaults.filter(f=>f.st==='open').length;
    return{tot:data.forklifts.length,ft:ft+tpFt+stFt,ov:ov+tpOv+stOv,wr,of:data.faults.filter(f=>f.st==="open").length+tpOpenFaults+stOpenFaults,tpTot:transpalets.length,tpOv,stTot:stackers.length,stOv};
  },[data,gS,transpalets,tpChecks,tpFaults,stackers,stChecks,stFaults]);
  const Badge=({f})=>{const s=gS(f);if(s.inF)return <span className="badge" style={{background:"#ef444425",color:"#ef4444"}}>ğŸ”´ ARIZALI</span>;if(s.o2||s.o5||s.o20)return <span className="badge" style={{background:"#ef444418",color:"#f87171"}}>âš  GecikmiÅŸ</span>;if(s.w2||s.w5||s.w20)return <span className="badge" style={{background:"#f59e0b18",color:"#fbbf24"}}>â° YaklaÅŸÄ±yor</span>;return <span className="badge" style={{background:"#22c55e18",color:"#4ade80"}}>âœ“ Aktif</span>;};
  const MaintDetail=({type,record,onClose})=>{
    const isTP=type==="tp_monthly";
    const isST=type==="st_monthly";
    const isSmall=isTP||isST;
    const fuelType=isSmall?null:getFuelType(record.fid);
    const color=type==="m250"?"var(--amber)":type==="m500"?"var(--blue)":type==="m2000"?"#a855f7":type==="tp_monthly"?"var(--cyan)":type==="st_monthly"?"var(--pink)":"var(--green)";
    const doneItems=record.checksArr||[];
    return(<div className="overlay" onClick={onClose}><div className="card mbody" style={{border:"1px solid "+color+"40"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
        <h3 style={{fontSize:16,fontWeight:700,color:color}}>{isTP?'TRANSPALET HaftalÄ±k KONTROL DETAYI':isST?'Ä°STÄ°F MAKÄ°NESÄ° KONTROL DETAYI':type.toUpperCase()+' DETAYI'}</h3><button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button></div>
      <div style={{marginBottom:12}}>
        <div className="dr"><span className="dl">{isTP?'Transpalet':isST?'Ä°stif Mak.':'Forklift'}</span><span className="dv" style={{fontWeight:700}}>{record.fn} {isTP?<TPBadge/>:isST?<STBadge/>:<FuelBadge fuelType={fuelType}/>}</span></div>
        <div className="dr"><span className="dl">Personel</span><span className="dv">{record.tech||"â€”"}</span></div>
        {!isSmall&&<div className="dr"><span className="dl">Saat</span><span className="dv mono">{record.h}h</span></div>}
        <div className="dr"><span className="dl">Tarih</span><span className="dv">{fd(record.dt)}</span></div>
        {record.notes&&<div className="dr"><span className="dl">Notlar</span><span className="dv">{record.notes}</span></div>}
      </div>
    {(()=>{
  const fullList=isTP?lists.tp_monthly:isST?lists.st_monthly:getListForType(lists,type,fuelType);
  const notDone=fullList?fullList.filter(item=>!doneItems.includes(item)):[];
  return(<>
    <div style={{fontSize:12,color:"var(--mute)",fontWeight:600,marginBottom:8}}>KONTROL KALEMLERÄ° ({doneItems.length}/{doneItems.length+notDone.length})</div>
    <div style={{display:"flex",flexDirection:"column",gap:3,maxHeight:300,overflowY:"auto"}}>
      {doneItems.map((item,i)=>(
        <div key={"d"+i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#22c55e08",borderRadius:6,border:"1px solid #22c55e20"}}><span style={{fontSize:14}}>âœ…</span><span style={{fontSize:12,color:"var(--text)"}}>{item}</span></div>
      ))}
      {notDone.map((item,i)=>(
        <div key={"n"+i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#ef444408",borderRadius:6,border:"1px solid #ef444420"}}><span style={{fontSize:14}}>âŒ</span><span style={{fontSize:12,color:"var(--dim)"}}>{item}</span></div>
      ))}
      {doneItems.length===0&&notDone.length===0&&<div style={{padding:16,textAlign:"center",color:"var(--dark)",fontSize:13}}>KayÄ±t bulunamadÄ±</div>}
    </div>
  </>);
})()}</div></div>);
  };
  const DateFilterBar=()=>(
    <div style={{display:'flex',gap:10,marginBottom:10,alignItems:'center',background:'var(--inp)',padding:8,borderRadius:8,flexWrap:'wrap'}}>
      <div style={{fontSize:12,fontWeight:700,color:'var(--dim)'}}>TARÄ°H FÄ°LTRESÄ°:</div>
      <input type="date" className="inp" value={dateFilt.start} style={{padding:5,width:'auto'}} onChange={e=>setDateFilt({...dateFilt,start:e.target.value})}/>
      <span style={{color:'var(--dim)'}}>-</span>
      <input type="date" className="inp" value={dateFilt.end} style={{padding:5,width:'auto'}} onChange={e=>setDateFilt({...dateFilt,end:e.target.value})}/>
      {(dateFilt.start||dateFilt.end)&&<button className="btn btn-ghost btn-xs" onClick={()=>setDateFilt({start:"",end:""})}>Temizle</button>}
    </div>
  );
  const filterByDate=(items)=>{
    if(!dateFilt.start&&!dateFilt.end)return items;
    return items.filter(i=>{
      const d=(i.dt||i.od||"").split('T')[0];
      if(dateFilt.start&&d<dateFilt.start)return false;
      if(dateFilt.end&&d>dateFilt.end)return false;
      return true;
    });
  };
  const FlFilterBar=()=>(
    <div style={{display:'flex',gap:6,marginBottom:14,flexWrap:'wrap',alignItems:'center'}}>
      <span style={{fontSize:11,color:'var(--mute)',fontWeight:700}}>EKÄ°PMAN:</span>
      <div className={`fl-filter-chip${selFL===null?' active':''}`} onClick={()=>setSelFL(null)}>TÃ¼mÃ¼</div>
      {data.forklifts.map(f=>(
        <div key={f.id} className={`fl-filter-chip${selFL===f.id?' active':''}`} onClick={()=>setSelFL(selFL===f.id?null:f.id)}>
          {isElectric(getFuelType(f.id))?'âš¡':'â›½'} {f.name}
        </div>
      ))}
      {transpalets.map(tp=>(
        <div key={tp.id} className={`fl-filter-chip${selFL===tp.id?' active':''}`} onClick={()=>setSelFL(selFL===tp.id?null:tp.id)}>
          ğŸ”‹ {tp.name}
        </div>
      ))}
      {stackers.map(st=>(
        <div key={st.id} className={`fl-filter-chip${selFL===st.id?' active':''}`} onClick={()=>setSelFL(selFL===st.id?null:st.id)}>
          ğŸ—ï¸ {st.name}
        </div>
      ))}
    </div>
  );
  const TPRepairModal=()=>tpRepTgt&&(
    <div className="overlay" onClick={()=>setTpRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Transpalet ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setTpRepTgt(null)}>âœ•</button></div>
      <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{tpRepTgt.tpName}</div><div style={{color:"var(--dim)",marginTop:4}}>{tpRepTgt.desc}</div></div>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
        <div><label className="lbl">Tarih</label><input ref={tpRepRefs.date} type="date" className="inp" defaultValue={TODAY_STR} max={TODAY_STR}/></div>
        <div><label className="lbl">Tamir Eden</label><input ref={tpRepRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
        <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={tpRepRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
        <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{
          const by=tpRepRefs.by.current?.value?.trim();
          if(!by)return alert("Ä°sim gir");
          if(tpRepRefs.date.current.value>TODAY_STR)return alert("Ä°leri tarih girilemez!");
          closeTPFault(tpRepTgt.id,tpRepTgt.tpId,tpRepTgt.tpName,by,tpRepRefs.desc.current?.value,tpRepRefs.date.current?.value);
        }}>âœ… ArÄ±zayÄ± Kapat</button>
      </div></div></div>
  );
  const STRepairModal=()=>stRepTgt&&(
    <div className="overlay" onClick={()=>setStRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Ä°stif Makinesi ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setStRepTgt(null)}>âœ•</button></div>
      <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{stRepTgt.stName}</div><div style={{color:"var(--dim)",marginTop:4}}>{stRepTgt.desc}</div></div>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
        <div><label className="lbl">Tarih</label><input ref={stRepRefs.date} type="date" className="inp" defaultValue={TODAY_STR} max={TODAY_STR}/></div>
        <div><label className="lbl">Tamir Eden</label><input ref={stRepRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
        <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={stRepRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
        <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{
          const by=stRepRefs.by.current?.value?.trim();
          if(!by)return alert("Ä°sim gir");
          if(stRepRefs.date.current.value>TODAY_STR)return alert("Ä°leri tarih girilemez!");
          closeSTFault(stRepTgt.id,stRepTgt.stId,stRepTgt.stName,by,stRepRefs.desc.current?.value,stRepRefs.date.current?.value);
        }}>âœ… ArÄ±zayÄ± Kapat</button>
      </div></div></div>
  );
  const RepairModal=()=>repTgt&&!repTgt.isTP&&!repTgt.isST&&(
    <div className="overlay" onClick={()=>setRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ Forklift ArÄ±za Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setRepTgt(null)}>âœ•</button></div>
      <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{repTgt.fn}</div><div style={{color:"var(--dim)",marginTop:4}}>{repTgt.desc}</div></div>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
        <div><label className="lbl">Tarih</label><input ref={rpRefs.date} type="date" className="inp" defaultValue={TODAY_STR} max={TODAY_STR}/></div>
        <div><label className="lbl">Tamir Eden</label><input ref={rpRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
        <div><label className="lbl">Saat</label><input ref={rpRefs.hours} type="number" className="inp" placeholder="GÃ¼ncel saat"/></div>
        <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler</label><textarea ref={rpRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
        <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={()=>{doCloseFault(repTgt);setRepTgt(null);}}>âœ… ArÄ±zayÄ± Kapat</button>
      </div></div></div>
  );
  const EditEquipmentModal=()=>{
    const isTP=editFL.isTP;
    const isST=editFL.isST;
    const isSmall=isTP||isST;
    const nameRef=useRef();
    const brandRef=useRef();
    const modelRef=useRef();
    const hoursRef=useRef();
    const handleSave=()=>{
      const name=nameRef.current?.value?.trim();
      if(!name)return alert("Ad zorunlu.");
      const brand=brandRef.current?.value?.trim()||"";
      const model=modelRef.current?.value?.trim()||"";
      const hours=isSmall?0:parseFloat(hoursRef.current?.value)||0;
      if(isTP){
        sendData('transpalet_update',{flId:editFL.id,flName:name,person:brand,note:model,hours:0});
      } else if(isST){
        sendData('stacker_update',{flId:editFL.id,flName:name,person:brand,note:model,hours:0});
      } else {
        const d1=new FormData();
        d1.append("action","write");
        d1.append("id",uid());
        d1.append("type","forklift_register");
        d1.append("flId",editFL.id);
        d1.append("flName",name);
        d1.append("person",brand);
        d1.append("hours",hours);
        d1.append("note",model);
        d1.append("checks","");
        setLoading(true);
        fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:d1}).then(r=>r.json()).then(()=>{
          const d2=new FormData();
          d2.append("action","write");
          d2.append("id",uid());
          d2.append("type","hours_override");
          d2.append("flId",editFL.id);
          d2.append("flName",name);
          d2.append("person","admin");
          d2.append("hours",hours);
          d2.append("note","Saat manuel gÃ¼ncellendi: "+hours+"h");
          d2.append("checks","");
          return fetch(GOOGLE_SCRIPT_URL,{method:"POST",body:d2});
        }).then(r=>r.json()).then(()=>{
          showToast("Forklift GÃ¼ncellendi!");
          fetchData();
          setEditFL(null);
        }).catch(()=>{setLoading(false);alert("Hata");});
        return;
      }
      setEditFL(null);
    };
    const btnClass="btn "+(isTP?'btn-cyan':isST?'btn-pink':'btn-amber');
    return(
      <div className="overlay" onClick={()=>setEditFL(null)}>
        <div className="card mbody" style={{border:"1px solid "+(isTP?'var(--cyan)':isST?'var(--pink)':'var(--amber)')}} onClick={e=>e.stopPropagation()}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
            <h3 style={{fontSize:18,fontWeight:800,color:isTP?"var(--cyan)":isST?"var(--pink)":"var(--amber)"}}>
              âœï¸ {isTP?'Transpalet DÃ¼zenle':isST?'Ä°stif Makinesi DÃ¼zenle':'Forklift DÃ¼zenle'}
            </h3>
            <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL(null)}>âœ•</button>
          </div>
          <div className="grid-2">
            <div><label className="lbl">Ad</label><input ref={nameRef} className="inp" defaultValue={editFL.name}/></div>
            <div><label className="lbl">Marka</label><input ref={brandRef} className="inp" defaultValue={editFL.brand}/></div>
            <div><label className="lbl">Model</label><input ref={modelRef} className="inp" defaultValue={editFL.model}/></div>
            {!isSmall&&<div><label className="lbl">Saat (GÃ¼ncelle)</label><input ref={hoursRef} className="inp" type="number" defaultValue={editFL.hours}/></div>}
          </div>
          {!isSmall&&<div style={{marginTop:10,padding:10,borderRadius:8,background:'#3b82f610',border:'1px solid #3b82f620',fontSize:12,color:'var(--blue)'}}>
            â„¹ï¸ Buradan girilen saat deÄŸeri, mevcut saatten dÃ¼ÅŸÃ¼k olsa bile zorla uygulanÄ±r.
          </div>}
          <div style={{marginTop:14,fontSize:11,color:"var(--dim)"}}>Not: Ekipman ID'si ({editFL.id}) aynÄ± kalacak.</div>
          <button className={btnClass} style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={handleSave}>
            ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet
          </button>
        </div>
      </div>
    );
  };
  const Dash=()=>(
    <div style={{padding:24,maxWidth:1200,margin:"0 auto"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12,marginBottom:24}}>
        <div><h1 style={{fontSize:26,fontWeight:900}}><span style={{color:"var(--amber)"}}>âš™</span> Forklift BakÄ±m</h1><p style={{color:"var(--mute)",fontSize:13,marginTop:2}}>Ana Kontrol Paneli</p></div>
        <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
          <button className="btn btn-amber" onClick={()=>setPg("qr")}>ğŸ“± QR</button>
          <button className="btn btn-blue" onClick={()=>{setPg("mob");setSel(null);setSelTP(null);setSelST(null);}}>ğŸ“‹ Mobil GiriÅŸ</button>
          <button className="btn btn-ghost" onClick={()=>checkPassword(()=>{setEditFL(null);setModal("settings")})}>ğŸ”’ Ayarlar</button>
        </div>
      </div>
      <div className="g-auto" style={{marginBottom:24}}>
        {[{l:"Forklift",v:stats.tot,c:"var(--blue)"},{l:"Transpalet",v:stats.tpTot,c:"var(--cyan)"},{l:"Ä°stif Mak.",v:stats.stTot,c:"var(--pink)"},{l:"ArÄ±zalÄ±",v:stats.ft,c:stats.ft?"var(--red)":"var(--green)"},{l:"GecikmiÅŸ",v:stats.ov,c:stats.ov?"var(--red)":"var(--green)"},{l:"AÃ§Ä±k ArÄ±za",v:stats.of,c:stats.of?"var(--red)":"var(--green)"}].map((s,i)=>
          <div key={i} className="card" style={{padding:14,borderLeft:"3px solid "+s.c}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700,textTransform:"uppercase"}}>{s.l}</div><div className="mono" style={{fontSize:26,fontWeight:800,color:s.c,marginTop:2}}>{s.v}</div></div>
        )}
      </div>
      <div className="tabs" style={{marginBottom:18,maxWidth:800}}>
        {[{k:"overview",l:"Genel BakÄ±ÅŸ"},{k:"faults",l:"ArÄ±zalar"},{k:"maint",l:"BakÄ±m KayÄ±tlarÄ±"},{k:"weekly",l:"HaftalÄ±k"},{k:"fleet",l:"ğŸ”’ Filo YÃ¶netimi"}].map(t=>
          <div key={t.k} className={`tab${sub===t.k?" active":""}`} onClick={()=>{
            if(t.k==="fleet"){checkPassword(()=>setSub(t.k));}else{setSub(t.k);}
          }} style={{fontSize:12}}>{t.l}</div>
        )}
      </div>
      {(data.forklifts.length>=1||transpalets.length>=1||stackers.length>=1)&&["overview","faults","maint","weekly"].includes(sub)&&<FlFilterBar/>}
      {["faults","maint","weekly"].includes(sub)&&<DateFilterBar/>}
      {sub==="overview"&&(()=>{
        const flList=data.forklifts.filter(f=>selFL?f.id===selFL:true);
        const tpList=transpalets.filter(tp=>selFL?tp.id===selFL:true);
        const stList=stackers.filter(st=>selFL?st.id===selFL:true);
        if(!flList.length&&!tpList.length&&!stList.length)return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Ekipman bulunamadÄ±.</div>;
        return(<>
            {flList.map(f=>{const s=gS(f);const fuelType=getFuelType(f.id);return(
              <div key={f.id} className="card" style={{marginBottom:12,borderColor:s.inF?"#ef444440":s.o2||s.o5||s.o20?"#f59e0b25":undefined}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
                  <div><div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><h3 style={{fontSize:17,fontWeight:800}}>{f.name}</h3><FuelBadge fuelType={fuelType}/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span><Badge f={f}/></div><div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div>
                  <div style={{display:"flex",alignItems:"center",gap:8}}><div className="mono" style={{fontSize:22,fontWeight:800,color:"var(--amber)"}}>{f.hours}h</div></div>
                </div>
                <div className="g-auto" style={{marginTop:14}}>
                  <div className="mcard" style={{borderLeftColor:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>250 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o2?"var(--red)":s.w2?"var(--amber)":"#4ade80",marginTop:3}}>{s.o2?Math.abs(s.r2)+"h GECÄ°KMÄ°Å":s.r2+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(250-Math.max(0,s.r2))/250*100)+"%",background:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}/></div><div style={{fontSize:10,color:"var(--mute)",marginTop:4}}>Sonraki bakÄ±m: <b className="mono" style={{color:"var(--text)"}}>{s.n2}h</b>'de</div></div>
                  <div className="mcard" style={{borderLeftColor:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>500 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o5?"var(--red)":s.w5?"var(--amber)":"#4ade80",marginTop:3}}>{s.o5?Math.abs(s.r5)+"h GECÄ°KMÄ°Å":s.r5+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(500-Math.max(0,s.r5))/500*100)+"%",background:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}/></div><div style={{fontSize:10,color:"var(--mute)",marginTop:4}}>Sonraki bakÄ±m: <b className="mono" style={{color:"var(--text)"}}>{s.n5}h</b>'de</div></div>
                  <div className="mcard" style={{borderLeftColor:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>2000 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o20?"var(--red)":s.w20?"var(--amber)":"#4ade80",marginTop:3}}>{s.o20?Math.abs(s.r20)+"h GECÄ°KMÄ°Å":s.r20+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(2000-Math.max(0,s.r20))/2000*100)+"%",background:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}/></div><div style={{fontSize:10,color:"var(--mute)",marginTop:4}}>Sonraki bakÄ±m: <b className="mono" style={{color:"var(--text)"}}>{s.n20}h</b>'de</div></div>
                  <div className="mcard" style={{borderLeftColor:s.ow?"var(--red)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>HaftalÄ±k</div><div style={{fontSize:14,fontWeight:700,color:s.ow?"var(--red)":"#4ade80",marginTop:3}}>{s.ow?s.dw+" gÃ¼n gecikmiÅŸ":s.dw<999?(7-s.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div></div>
                </div>
              </div>);})}
            {tpList.map(tp=>{const tpS=getTPStatus(tp);return(
              <div key={tp.id} className="card" style={{marginBottom:12,borderColor:tpS.hasFault?"#ef444440":tpS.overdue?"#f59e0b25":undefined}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}><div><div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><h3 style={{fontSize:17,fontWeight:800}}>{tp.name}</h3><TPBadge/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{tp.id}</span><StatusBadge s={tpS}/></div><div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[tp.brand,tp.model].filter(Boolean).join(" â€¢ ")}</div></div></div><div className="g-auto" style={{marginTop:14}}><div className="mcard" style={{borderLeftColor:tpS.overdue?"var(--red)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>HaftalÄ±k KONTROL</div><div style={{fontSize:14,fontWeight:700,color:tpS.overdue?"var(--red)":"#4ade80",marginTop:3}}>{tpS.overdue?tpS.dw+" gÃ¼n gecikmiÅŸ":tpS.dw<999?(7-tpS.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div></div></div></div>);})}
            {stList.map(st=>{const stS=getSTStatus(st);return(
              <div key={st.id} className="card" style={{marginBottom:12,borderColor:stS.hasFault?"#ef444440":stS.overdue?"#f59e0b25":undefined}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}><div><div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><h3 style={{fontSize:17,fontWeight:800}}>{st.name}</h3><STBadge/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{st.id}</span><StatusBadge s={stS}/></div><div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[st.brand,st.model].filter(Boolean).join(" â€¢ ")}</div></div></div><div className="g-auto" style={{marginTop:14}}><div className="mcard" style={{borderLeftColor:stS.overdue?"var(--red)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>HaftalÄ±k KONTROL</div><div style={{fontSize:14,fontWeight:700,color:stS.overdue?"var(--red)":"#4ade80",marginTop:3}}>{stS.overdue?stS.dw+" gÃ¼n gecikmiÅŸ":stS.dw<999?(7-stS.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div></div></div></div>);})}
          </>);
      })()}      {sub==="faults"&&(()=>{
        let fs=data.faults.filter(f=>selFL?f.fid===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
        fs=filterByDate(fs.map(f=>({...f,dt:f.od}))).map(f=>{const{dt,...rest}=f;return rest;});
        let tpFs=tpFaults.map(f=>({...f,fn:f.tpName,by:f.by,desc:f.desc,od:f.dt,st:f.st,h:0,prio:f.prio||'normal',isTP:true})).filter(f=>selFL?f.tpId===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
        tpFs=filterByDate(tpFs.map(f=>({...f,dt:f.od})));
        let stFs=stFaults.map(f=>({...f,fn:f.stName,by:f.by,desc:f.desc,od:f.dt,st:f.st,h:0,prio:f.prio||'normal',isST:true})).filter(f=>selFL?f.stId===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
        stFs=filterByDate(stFs.map(f=>({...f,dt:f.od})));
        const all=[...fs,...tpFs,...stFs].sort((a,b)=>new Date(b.od||b.dt)-new Date(a.od||a.dt));
        if(!all.length)return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>ArÄ±za kaydÄ± yok</div>;
        return all.map(f=><div key={f.id} className="card" style={{marginBottom:8,borderLeft:"3px solid "+(f.st==="open"?(PRIO[f.prio]?.c||"#fbbf24"):"var(--green)")}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}>
            <div style={{flex:1}}>
              <div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}>
                <span style={{fontWeight:700,fontSize:14}}>{f.fn}</span>
                {f.isTP&&<TPBadge/>}{f.isST&&<STBadge/>}
                <span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e"}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"âœ… KAPALI"}</span>
                {f.st==="open"&&<span className="badge" style={{background:(PRIO[f.prio]?.c||"#fbbf24")+"20",color:PRIO[f.prio]?.c||"#fbbf24"}}>{PRIO[f.prio]?.l||"Normal"}</span>}
              </div>
              <p style={{fontSize:13,marginTop:6,lineHeight:1.5}}>{f.desc}</p>
              <div style={{fontSize:11,color:"var(--mute)",marginTop:6}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b>{(!f.isTP&&!f.isST)&&(" â€¢ Saat: "+f.h+"h")} â€¢ {fd(f.od||f.dt)}</div>
              {f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}
            </div>
            <div style={{display:"flex",flexDirection:"column",gap:4}}>
              {f.st==="open"&&(!f.isTP&&!f.isST)&&<button className="btn btn-green btn-sm" onClick={()=>setRepTgt(f)}>ğŸ”§ Kapat</button>}
              {f.st==="open"&&f.isTP&&<button className="btn btn-green btn-sm" onClick={()=>setTpRepTgt(f)}>ğŸ”§ Kapat</button>}
              {f.st==="open"&&f.isST&&<button className="btn btn-green btn-sm" onClick={()=>setStRepTgt(f)}>ğŸ”§ Kapat</button>}
            </div>
          </div>
        </div>);
      })()}
      {sub==="maint"&&<div>
        {(()=>{
          let rs=[...data.m250,...data.m500,...data.m2000].filter(m=>selFL?m.fid===selFL:true).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
          rs=filterByDate(rs);
          if(!rs.length)return <div className="card" style={{textAlign:"center",padding:24,color:"var(--dark)",marginBottom:16}}>KayÄ±t yok</div>;
          return rs.map(r=>{
            const fuelType=getFuelType(r.fid);
            const type=r.mType||"m250";
            const color=type==="m2000"?"#a855f7":type==="m500"?"var(--blue)":"var(--amber)";
            const colorBg=type==="m2000"?"#a855f720":type==="m500"?"#3b82f620":"#f59e0b20";
            const typeLabel=type==="m2000"?"2000h":type==="m500"?"500h":"250h";
            return <div key={r.id} className="card" style={{marginBottom:6,borderLeft:"3px solid "+color,cursor:"pointer"}} onClick={()=>setDetailModal({type,record:r})}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}>
                <div>
                  <span style={{fontWeight:700}}>{r.fn}</span>
                  {isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>}
                  <span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>@ {r.h}h</span>
                </div>
                <div style={{display:"flex",gap:4,alignItems:"center"}}>
                  <span className="badge" style={{background:colorBg,color:color}}>{typeLabel}</span>
                  <span className="badge" style={{background:"#22c55e15",color:"#4ade80"}}>{r.done} yapÄ±ldÄ± â€” detay â†’</span>
                </div>
              </div>
              <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Teknisyen: <b style={{color:"var(--dim)"}}>{r.tech}</b> â€¢ {fd(r.dt)}</div>
            </div>;
          });
        })()}
      </div>}
      {sub==="weekly"&&(()=>{
        let ws=data.weekly.map(w=>({...w,isTP:false,isST:false})).filter(w=>selFL?w.fid===selFL:true);
        let tps=tpChecks.map(c=>({...c,isTP:true,isST:false,fid:c.tpId,fn:transpalets.find(t=>t.id===c.tpId)?.name||"Transpalet",h:0})).filter(c=>selFL?c.fid===selFL:true);
        let sts=stChecks.map(c=>({...c,isST:true,isTP:false,fid:c.stId,fn:stackers.find(s=>s.id===c.stId)?.name||"Ä°stif Makinesi",h:0})).filter(c=>selFL?c.fid===selFL:true);
        let allWs=[...ws,...tps,...sts].sort((a,b)=>new Date(b.dt)-new Date(a.dt));
        allWs=filterByDate(allWs);
        if(!allWs.length)return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>KayÄ±t yok</div>;
        return allWs.map(w=>{
          const fuelType=(w.isTP||w.isST)?null:getFuelType(w.fid);
          return(
            <div key={w.id} className="card" style={{marginBottom:6,borderLeft:"3px solid "+(w.isTP?"var(--cyan)":w.isST?"var(--pink)":"var(--green)"),cursor:"pointer"}} onClick={()=>setDetailModal({type:w.isTP?"tp_monthly":w.isST?"st_monthly":"weekly",record:w})}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}>
                <div>
                  <span style={{fontWeight:700}}>{w.fn}</span>
                  {w.isTP?<span style={{marginLeft:5}}><TPBadge/></span>:w.isST?<span style={{marginLeft:5}}><STBadge/></span>:(isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>)}
                  {(!w.isTP&&!w.isST)&&<span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>{w.h}h</span>}
                </div>
                <span className="badge" style={{background:w.isTP?"#06b6d420":w.isST?"#ec489920":"#22c55e20",color:w.isTP?"#22d3ee":w.isST?"#f472b6":"#4ade80"}}>{w.done} yapÄ±ldÄ± â€” detay â†’</span>
              </div>
              <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>{(w.isTP||w.isST)?"Personel":"OperatÃ¶r"}: <b style={{color:"var(--dim)"}}>{w.tech}</b> â€¢ {fd(w.dt)}</div>
            </div>
          );
        });
      })()}
      {sub==="fleet"&&(<div>
        <div style={{fontSize:13,fontWeight:700,color:"var(--amber)",marginBottom:10}}>âš™ FORKLÄ°FTLER</div>
        {!data.forklifts.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)",marginBottom:16}}>Forklift yok.</div>:data.forklifts.map(f=>{
          const fuelType=getFuelType(f.id);
          return <div key={f.id} className="card" style={{marginBottom:12}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
              <h3 style={{fontSize:16,fontWeight:800}}>{f.name} <FuelBadge fuelType={fuelType}/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></h3>
              <div style={{display:"flex",gap:6}}>
                <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...f,isTP:false,isST:false})}>âœï¸ DÃ¼zenle</button>
                <button className="btn btn-ghost btn-sm" onClick={()=>setFuelModal(f)}>â›½ YakÄ±t Tipi</button>
                <button className="btn btn-dng btn-sm" onClick={()=>setConfirmDel({id:f.id,type:"Forklift",msg:f.name+" silinecek. Emin misiniz?"})}>ğŸ—‘ Sil</button>
              </div>
            </div>
            <div className="g-auto">
              <div><div className="lbl">MARKA</div><div>{f.brand||"â€”"}</div></div>
              <div><div className="lbl">MODEL</div><div>{f.model||"â€”"}</div></div>
              <div><div className="lbl">SAAT</div><div className="mono" style={{fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div></div>
              <div><div className="lbl">YAKIT TÄ°PÄ°</div><div><FuelBadge fuelType={fuelType}/></div></div>
            </div>
          </div>;
        })}
        <div style={{fontSize:13,fontWeight:700,color:"var(--cyan)",marginBottom:10,marginTop:20}}>ğŸ”‹ ELEKTRÄ°KLÄ° TRANSPALETLER</div>
        {!transpalets.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)",marginBottom:16}}>Transpalet yok.</div>:transpalets.map(tp=>(
          <div key={tp.id} className="card" style={{marginBottom:12}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
              <h3 style={{fontSize:16,fontWeight:800}}>{tp.name} <TPBadge/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{tp.id}</span></h3>
              <div style={{display:"flex",gap:6}}>
                <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...tp,isTP:true,isST:false})}>âœï¸ DÃ¼zenle</button>
                <button className="btn btn-dng btn-sm" onClick={()=>setConfirmDel({id:tp.id,type:"Transpalet",msg:tp.name+" silinecek. Emin misiniz?"})}>ğŸ—‘ Sil</button>
              </div>
            </div>
            <div className="g-auto">
              <div><div className="lbl">MARKA</div><div>{tp.brand||"â€”"}</div></div>
              <div><div className="lbl">MODEL</div><div>{tp.model||"â€”"}</div></div>
              <div><div className="lbl">DURUM</div><div><StatusBadge s={getTPStatus(tp)}/></div></div>
            </div>
          </div>
        ))}
        <div style={{fontSize:13,fontWeight:700,color:"var(--pink)",marginBottom:10,marginTop:20}}>ğŸ—ï¸ Ä°STÄ°F MAKÄ°NELERÄ°</div>
        {!stackers.length?<div className="card" style={{textAlign:"center",padding:20,color:"var(--dark)"}}>Ä°stif Makinesi yok.</div>:stackers.map(st=>(
          <div key={st.id} className="card" style={{marginBottom:12}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
              <h3 style={{fontSize:16,fontWeight:800}}>{st.name} <STBadge/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{st.id}</span></h3>
              <div style={{display:"flex",gap:6}}>
                <button className="btn btn-ghost btn-sm" onClick={()=>setEditFL({...st,isTP:false,isST:true})}>âœï¸ DÃ¼zenle</button>
                <button className="btn btn-dng btn-sm" onClick={()=>setConfirmDel({id:st.id,type:"Ä°stif Makinesi",msg:st.name+" silinecek. Emin misiniz?"})}>ğŸ—‘ Sil</button>
              </div>
            </div>
            <div className="g-auto">
              <div><div className="lbl">MARKA</div><div>{st.brand||"â€”"}</div></div>
              <div><div className="lbl">MODEL</div><div>{st.model||"â€”"}</div></div>
              <div><div className="lbl">DURUM</div><div><StatusBadge s={getSTStatus(st)}/></div></div>
            </div>
          </div>
        ))}
      </div>)}
    </div>
  );
  const QRPage=()=>(<div style={{padding:24,maxWidth:1100,margin:"0 auto"}}><div style={{display:"flex",alignItems:"center",gap:12,marginBottom:24}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setPg("dash")}>â†</button><div><h2 style={{fontSize:22,fontWeight:800}}>QR Kod / Barkod</h2><p style={{fontSize:13,color:"var(--dim)"}}>YazdÄ±rÄ±p ekipmanlara yapÄ±ÅŸtÄ±rÄ±n</p></div></div>
    {data.forklifts.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--amber)",marginBottom:10}}>âš™ FORKLÄ°FTLER</div>}
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginBottom:24}}>{data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={"forklift://"+f.id} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{f.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{f.brand} {f.model}</div><div style={{marginTop:4}}><FuelBadge fuelType={fuelType}/></div><div className="mono" style={{fontSize:12,color:"var(--amber)",marginTop:3}}>{f.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSel(f);setSelTP(null);setSelST(null);setPg("mob");setTab("status")}}>Mobil AÃ§</button></div>;})}</div>
    {transpalets.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--cyan)",marginBottom:10}}>ğŸ”‹ ELEKTRÄ°KLÄ° TRANSPALETLER</div>}
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16,marginBottom:24}}>{transpalets.map(tp=><div key={tp.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={"transpalet://"+tp.id} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{tp.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{tp.brand} {tp.model}</div><div style={{marginTop:4}}><TPBadge/></div><div className="mono" style={{fontSize:12,color:"var(--cyan)",marginTop:3}}>{tp.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSelTP(tp);setSel(null);setSelST(null);setTpTab("status");setPg("mob")}}>Mobil AÃ§</button></div>)}</div>
    {stackers.length>0&&<div style={{fontSize:13,fontWeight:700,color:"var(--pink)",marginBottom:10}}>ğŸ—ï¸ Ä°STÄ°F MAKÄ°NELERÄ°</div>}
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16}}>{stackers.map(st=><div key={st.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={"stacker://"+st.id} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{st.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{st.brand} {st.model}</div><div style={{marginTop:4}}><STBadge/></div><div className="mono" style={{fontSize:12,color:"var(--pink)",marginTop:3}}>{st.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSelST(st);setSel(null);setSelTP(null);setStTab("status");setPg("mob")}}>Mobil AÃ§</button></div>)}</div>
    {!data.forklifts.length&&!transpalets.length&&!stackers.length&&<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Ekipman yok.</div>}
  </div>);  const Mobile=()=>{
    if(!sel&&!selTP&&!selST){
      return(
        <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
          <div style={{textAlign:"center",marginBottom:16}}><div style={{fontSize:12,color:"var(--amber)",fontWeight:700,letterSpacing:2}}>MOBÄ°L GÄ°RÄ°Å</div><h2 style={{fontSize:20,fontWeight:800,marginTop:4}}>Ekipman SeÃ§in</h2></div>
          {!data.forklifts.length&&!transpalets.length&&!stackers.length&&<div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z ekipman yok.</div>}
          {data.forklifts.length>0&&<div style={{fontSize:12,fontWeight:700,color:"var(--amber)",marginBottom:8}}>FORKLÄ°FTLER</div>}
          {data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:gS(f).inF?"#ef444440":undefined}} onClick={()=>{setSel(f);setTab("status")}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:'flex',alignItems:'center',gap:6}}>{f.name} <FuelBadge fuelType={fuelType}/> <span style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></div><div style={{fontSize:12,color:"var(--dim)"}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><div className="mono" style={{fontSize:16,fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div><Badge f={f}/></div></div></div>;})}
          {transpalets.length>0&&<div style={{fontSize:12,fontWeight:700,color:"var(--cyan)",marginBottom:8,marginTop:16}}>TRANSPALETLER</div>}
          {transpalets.map(tp=>{const tpS=getTPStatus(tp);return(
            <div key={tp.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:tpS.hasFault?"#ef444440":tpS.overdue?"#ef444430":undefined}} onClick={()=>{setSelTP(tp);setTpTab("status")}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:"flex",alignItems:"center",gap:6}}>{tp.name} <TPBadge/></div><div style={{fontSize:12,color:"var(--dim)"}}>{[tp.brand,tp.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><StatusBadge s={tpS}/></div></div>
            </div>);})}
          {stackers.length>0&&<div style={{fontSize:12,fontWeight:700,color:"var(--pink)",marginBottom:8,marginTop:16}}>Ä°STÄ°F MAKÄ°NELERÄ°</div>}
          {stackers.map(st=>{const stS=getSTStatus(st);return(
            <div key={st.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:stS.hasFault?"#ef444440":stS.overdue?"#ef444430":undefined}} onClick={()=>{setSelST(st);setStTab("status")}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:"flex",alignItems:"center",gap:6}}>{st.name} <STBadge/></div><div style={{fontSize:12,color:"var(--dim)"}}>{[st.brand,st.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><StatusBadge s={stS}/></div></div>
            </div>);})}
          <button className="btn btn-ghost" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setPg("dash");setSel(null);setSelTP(null);setSelST(null)}}>â† Ana Panel</button>
        </div>
      );
    }
    if(sel){
      const st=gS(sel);
      const fuelType=getFuelType(sel.id);
      const selIsElectric=isElectric(fuelType);
      return(
        <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setSel(null)}>â†</button><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{sel.name}</span><FuelBadge fuelType={fuelType}/><Badge f={sel}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[sel.brand,sel.model].filter(Boolean).join(" â€¢ ")} â€¢ {sel.hours}h</div></div></div>
          <div className="tabs" style={{marginBottom:12}}>
            {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"m250",l:"250h"},{k:"m500",l:"500h"},{k:"m2000",l:"2000h"},{k:"wk",l:"HaftalÄ±k"}].map(t=>
              <div key={t.k} className={`tab${tab===t.k?" active":""}`} onClick={()=>setTab(t.k)}>{t.l}</div>)}
          </div>
          {tab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
            <div className="card" style={{borderLeft:"3px solid "+(st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>250 SAAT BAKIM</div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o2?"var(--red)":st.w2?"var(--amber)":"#4ade80"}}>{st.o2?Math.abs(st.r2)+"h":st.r2+"h"}</div><div style={{fontSize:11,color:st.o2?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o2?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l2h}h<br/>Sonraki: {st.n2}h</div></div>
              <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(250-Math.max(0,st.r2))/250*100))+"%",background:st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)"}}/></div>
            </div>
            <div className="card" style={{borderLeft:"3px solid "+(st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>500 SAAT BAKIM</div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o5?"var(--red)":st.w5?"var(--amber)":"#4ade80"}}>{st.o5?Math.abs(st.r5)+"h":st.r5+"h"}</div><div style={{fontSize:11,color:st.o5?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o5?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l5h}h<br/>Sonraki: {st.n5}h</div></div>
              <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(500-Math.max(0,st.r5))/500*100))+"%",background:st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)"}}/></div>
            </div>
            <div className="card" style={{borderLeft:"3px solid "+(st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>2000 SAAT BAKIM</div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o20?"var(--red)":st.w20?"var(--amber)":"#4ade80"}}>{st.o20?Math.abs(st.r20)+"h":st.r20+"h"}</div><div style={{fontSize:11,color:st.o20?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o20?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l20h}h<br/>Sonraki: {st.n20}h</div></div>
              <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(2000-Math.max(0,st.r20))/2000*100))+"%",background:st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)"}}/></div>
            </div>
            <div className="card" style={{borderLeft:"3px solid "+(st.ow?"var(--red)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>HaftalÄ±k KONTROL</div>
              <div style={{fontSize:14,fontWeight:700,color:st.ow?"var(--red)":"#4ade80",marginTop:3}}>{st.ow?"âš  "+st.dw+" gÃ¼n gecikmiÅŸ":st.dw<999?(7-st.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
            </div>
            {st.opn.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
              <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({st.opn.length})</div>
              {st.opn.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}><div style={{fontWeight:600}}>{f.desc}</div><div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.od)}</div></div>)}
            </div>}
          </div>}
          {tab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={sel} onSubmit={handleFaultSubmit} isNoHours={false}/>
            {st.opn.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)"}}>
              <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
              {st.opn.map(f=>(
                <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                  <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                  <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.od)}</div>
                  <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                </div>
              ))}
            </div>}
          </div>}
          {tab==="m250"&&<FormTemplate title={"250 SAAT BAKIM"+(selIsElectric?" âš¡":"")} color="var(--amber)" items={getListForType(lists,'m250',fuelType)} onSubmit={handle250} sel={sel}/>}
          {tab==="m500"&&<FormTemplate title={"500 SAAT BAKIM"+(selIsElectric?" âš¡":"")} color="var(--blue)" items={getListForType(lists,'m500',fuelType)} onSubmit={handle500} sel={sel}/>}
          {tab==="m2000"&&<FormTemplate title={"2000 SAAT BAKIM"+(selIsElectric?" âš¡":"")} color="#a855f7" items={getListForType(lists,'m2000',fuelType)} onSubmit={handle2000} sel={sel}/>}
          {tab==="wk"&&<FormTemplate title={"HaftalÄ±k KONTROL"+(selIsElectric?" âš¡":"")} color="var(--green)" items={getListForType(lists,'weekly',fuelType)} onSubmit={handleWk} sel={sel}/>}
        </div>
      );
    }
    if(selTP){
      const tpS=getTPStatus(selTP);
      return(
        <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
            <button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>{setSelTP(null);setTpTab("status")}}>â†</button>
            <div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{selTP.name}</span><TPBadge/><StatusBadge s={tpS}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[selTP.brand,selTP.model].filter(Boolean).join(" â€¢ ")}</div></div>
          </div>
          <div className="tabs" style={{marginBottom:12}}>
            {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"monthly",l:"HaftalÄ±k"},{k:"history",l:"GeÃ§miÅŸ"}].map(t=>
              <div key={t.k} className={`tab${tpTab===t.k?" active":""}`} onClick={()=>setTpTab(t.k)}>{t.l}</div>
            )}
          </div>
          {tpTab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
            <div className="card" style={{borderLeft:"3px solid "+(tpS.overdue?"var(--red)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>HaftalÄ±k KONTROL</div>
              <div style={{fontSize:16,fontWeight:700,color:tpS.overdue?"var(--red)":"#4ade80",marginTop:4}}>{tpS.overdue?"âš  "+tpS.dw+" gÃ¼n gecikmiÅŸ":tpS.dw<999?(7-tpS.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
              {tpS.last&&<div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Son kontrol: {fd(tpS.last.dt)} â€” {tpS.last.tech}</div>}
            </div>
            {tpS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
              <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({tpS.openFaults.length})</div>
              {tpS.openFaults.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}><div style={{fontWeight:600}}>{f.desc}</div><div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div></div>)}
            </div>}
          </div>}
          {tpTab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={selTP} isNoHours={true} onSubmit={(d)=>submitTPFault(selTP.id,selTP.name,d.by,d.desc,d.prio,d.date)}/>
            {tpS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)"}}>
              <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
              {tpS.openFaults.map(f=>(
                <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                  <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                  <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
                  <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setTpRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                </div>
              ))}
            </div>}
          </div>}
          {tpTab==="monthly"&&<FormTemplate title="ğŸ”‹ TRANSPALET HaftalÄ±k KONTROL" color="var(--cyan)" items={lists.tp_monthly} onSubmit={handleTPCheck} sel={{hours:0}} noHours={true}/>}
          {tpTab==="history"&&<div>
            {tpS.checks.length>0&&<div style={{marginBottom:14}}>
              <div style={{fontSize:12,fontWeight:700,color:"var(--cyan)",marginBottom:8}}>HaftalÄ±k KONTROLLER</div>
              {tpS.checks.map(c=>(<div key={c.id} className="card" style={{marginBottom:6,borderLeft:"3px solid var(--cyan)",cursor:"pointer"}} onClick={()=>setDetailModal({type:"tp_monthly",record:{...c,fn:selTP.name}})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontWeight:700,fontSize:13}}>{fd(c.dt)}</span><span className="badge" style={{background:"#06b6d420",color:"#22d3ee"}}>{c.done} yapÄ±ldÄ± â€” detay â†’</span></div>
                <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Personel: <b style={{color:"var(--dim)"}}>{c.tech}</b></div>
              </div>))}
            </div>}
            {tpS.faults.length>0&&<div>
              <div style={{fontSize:12,fontWeight:700,color:"var(--red)",marginBottom:8}}>ARIZA KAYITLARI</div>
              {tpS.faults.map(f=>(<div key={f.id} className="card" style={{marginBottom:6,borderLeft:"3px solid "+(f.st==='open'?'var(--red)':'var(--green)')}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}>
                  <div style={{flex:1}}>
                    <span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e",marginBottom:4}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"KAPALI âœ…"}</span>
                    <p style={{fontSize:13,marginTop:4,lineHeight:1.5}}>{f.desc}</p>
                    <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b> â€¢ {fd(f.dt)}</div>
                    {f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}
                  </div>
                  {f.st==="open"&&<button className="btn btn-green btn-sm" onClick={()=>setTpRepTgt(f)}>ğŸ”§ Kapat</button>}
                </div>
              </div>))}
            </div>}
            {tpS.checks.length===0&&tpS.faults.length===0&&<div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z kayÄ±t yok</div>}
          </div>}
        </div>
      );
    }
    if(selST){
      const stS=getSTStatus(selST);
      return(
        <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
            <button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>{setSelST(null);setStTab("status")}}>â†</button>
            <div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{selST.name}</span><STBadge/><StatusBadge s={stS}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[selST.brand,selST.model].filter(Boolean).join(" â€¢ ")}</div></div>
          </div>
          <div className="tabs" style={{marginBottom:12}}>
            {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"monthly",l:"HaftalÄ±k"},{k:"history",l:"GeÃ§miÅŸ"}].map(t=>
              <div key={t.k} className={`tab${stTab===t.k?" active":""}`} onClick={()=>setStTab(t.k)}>{t.l}</div>
            )}
          </div>
          {stTab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
            <div className="card" style={{borderLeft:"3px solid "+(stS.overdue?"var(--red)":"var(--green)")}}>
              <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>HaftalÄ±k KONTROL</div>
              <div style={{fontSize:16,fontWeight:700,color:stS.overdue?"var(--red)":"#4ade80",marginTop:4}}>{stS.overdue?"âš  "+stS.dw+" gÃ¼n gecikmiÅŸ":stS.dw<999?(7-stS.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
              {stS.last&&<div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Son kontrol: {fd(stS.last.dt)} â€” {stS.last.tech}</div>}
            </div>
            {stS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
              <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({stS.openFaults.length})</div>
              {stS.openFaults.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}><div style={{fontWeight:600}}>{f.desc}</div><div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div></div>)}
            </div>}
          </div>}
          {stTab==="fault"&&<div style={{display:"flex",flexDirection:"column",gap:16}}>
            <FaultForm sel={selST} isNoHours={true} onSubmit={(d)=>submitSTFault(selST.id,selST.name,d.by,d.desc,d.prio,d.date)}/>
            {stS.openFaults.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)"}}>
              <h3 style={{fontSize:15,fontWeight:700,color:"var(--red)",marginBottom:10}}>ğŸ”´ AÃ§Ä±k ArÄ±zalar</h3>
              {stS.openFaults.map(f=>(
                <div key={f.id} style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:8}}>
                  <div style={{fontWeight:600,fontSize:13}}>{f.desc}</div>
                  <div style={{color:"var(--mute)",fontSize:11,marginTop:4,marginBottom:8}}>Bildiren: {f.by} â€¢ {fd(f.dt)}</div>
                  <button className="btn btn-green btn-sm" style={{width:"100%",justifyContent:"center"}} onClick={()=>setStRepTgt(f)}>ğŸ”§ ArÄ±zayÄ± Kapat</button>
                </div>
              ))}
            </div>}
          </div>}
          {stTab==="monthly"&&<FormTemplate title="ğŸ—ï¸ Ä°STÄ°F MAKÄ°NESÄ° KONTROLÃœ" color="var(--pink)" items={lists.st_monthly} onSubmit={handleSTCheck} sel={{hours:0}} noHours={true}/>}
          {stTab==="history"&&<div>
            {stS.checks.length>0&&<div style={{marginBottom:14}}>
              <div style={{fontSize:12,fontWeight:700,color:"var(--pink)",marginBottom:8}}>HaftalÄ±k KONTROLLER</div>
              {stS.checks.map(c=>(<div key={c.id} className="card" style={{marginBottom:6,borderLeft:"3px solid var(--pink)",cursor:"pointer"}} onClick={()=>setDetailModal({type:"st_monthly",record:{...c,fn:selST.name}})}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontWeight:700,fontSize:13}}>{fd(c.dt)}</span><span className="badge" style={{background:"#ec489920",color:"#f472b6"}}>{c.done} yapÄ±ldÄ± â€” detay â†’</span></div>
                <div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Personel: <b style={{color:"var(--dim)"}}>{c.tech}</b></div>
              </div>))}
            </div>}
            {stS.faults.length>0&&<div>
              <div style={{fontSize:12,fontWeight:700,color:"var(--red)",marginBottom:8}}>ARIZA KAYITLARI</div>
              {stS.faults.map(f=>(<div key={f.id} className="card" style={{marginBottom:6,borderLeft:"3px solid "+(f.st==='open'?'var(--red)':'var(--green)')}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}>
                  <div style={{flex:1}}>
                    <span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e",marginBottom:4}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"KAPALI âœ…"}</span>
                    <p style={{fontSize:13,marginTop:4,lineHeight:1.5}}>{f.desc}</p>
                    <div style={{fontSize:11,color:"var(--mute)",marginTop:4}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b> â€¢ {fd(f.dt)}</div>
                    {f.st==='closed'&&<div style={{fontSize:11,color:"var(--green)",marginTop:3}}>Kapatan: {f.closedBy} â€¢ {fd(f.closedDt)}{f.closedDesc&&(' â€” '+f.closedDesc)}</div>}
                  </div>
                  {f.st==="open"&&<button className="btn btn-green btn-sm" onClick={()=>setStRepTgt(f)}>ğŸ”§ Kapat</button>}
                </div>
              </div>))}
            </div>}
            {stS.checks.length===0&&stS.faults.length===0&&<div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z kayÄ±t yok</div>}
          </div>}
        </div>
      );
    }
  };
  const SettingsModal=()=>(
    <div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" onClick={e=>e.stopPropagation()}>      <h3>âš™ Ayarlar</h3>
      <div style={{display:'flex',flexDirection:'column',gap:10,marginTop:15}}>
        <button className="btn btn-blue" onClick={()=>{setModal('list_edit')}}>ğŸ“ Kontrol listelerini dÃ¼zenle</button>
        <button className="btn btn-ghost" onClick={()=>{setModal('add')}}>+ Yeni Forklift Ekle</button>
        <button className="btn btn-cyan" onClick={()=>{setModal('add_tp')}}>+ Yeni Transpalet Ekle</button>
        <button className="btn btn-pink" onClick={()=>{setModal('add_st')}}>+ Yeni Ä°stif Makinesi Ekle</button>
      </div>
      <div style={{marginTop:20,fontSize:12,color:'var(--dim)',textAlign:'center'}}>Selectron v6.1 â€” Cloud Sync</div>
    </div></div>
  );
  const AddTPModal=()=>(<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #06b6d430"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--cyan)"}}>ğŸ”‹ Yeni Transpalet Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Transpalet AdÄ± *</label><input ref={tpRefs.name} className="inp" placeholder="Ã¶r: Transpalet 1"/></div>
      <div className="grid-2">
        <div><label className="lbl">Marka</label><input ref={tpRefs.brand} className="inp" placeholder="Ã¶r: Linde"/></div>
        <div><label className="lbl">Model</label><input ref={tpRefs.model} className="inp" placeholder="Ã¶r: T20"/></div>
      </div>
    </div>
    <button className="btn btn-cyan" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addTP}>+ Transpalet Ekle</button>
  </div></div>);
  const AddSTModal=()=>(<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #ec489930"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--pink)"}}>ğŸ—ï¸ Yeni Ä°stif Makinesi Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <div><label className="lbl">Makine AdÄ± *</label><input ref={stRefs.name} className="inp" placeholder="Ã¶r: Ä°stif 1"/></div>
      <div className="grid-2">
        <div><label className="lbl">Marka</label><input ref={stRefs.brand} className="inp" placeholder="Ã¶r: Jungheinrich"/></div>
        <div><label className="lbl">Model</label><input ref={stRefs.model} className="inp" placeholder="Ã¶r: EJC"/></div>
      </div>
    </div>
    <button className="btn btn-pink" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addST}>+ Ä°stif Makinesi Ekle</button>
  </div></div>);
  const AddFLModal=()=>{
    return(<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #f59e0b30"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--amber)"}}>Yeni Forklift Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
      <div className="grid-2">
        <div><label className="lbl">Forklift AdÄ± *</label><input ref={flRefs.name} className="inp" placeholder="Ã¶r: Forklift 1"/></div>
        <div><label className="lbl">Marka</label><input ref={flRefs.brand} className="inp" placeholder="Ã¶r: Toyota"/></div>
        <div><label className="lbl">Model</label><input ref={flRefs.model} className="inp" placeholder="Ã¶r: 8FG25"/></div>
        <div><label className="lbl">Mevcut Saat</label><input ref={flRefs.hours} className="inp" type="number" placeholder="0"/></div>
      </div>
      <div style={{marginTop:10}}>
        <label className="lbl">YakÄ±t Tipi</label>
        <select ref={flRefs.fuel} className="inp" defaultValue="diesel">
          {FUELS.map(f=><option key={f.v} value={f.v}>{f.e} {f.l}</option>)}
        </select>
      </div>
      <button className="btn btn-amber" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addFL}>+ Forklift Ekle</button>
    </div></div>);
  };
  return(<div>
    {toast&&<div className="toast">{toast}</div>}
    {loading&&<div className="loading-screen"><div>Ä°ÅŸleniyor...</div></div>}
    {pg==="dash"&&<Dash/>}
    {pg==="mob"&&<Mobile/>}
    {pg==="qr"&&<QRPage/>}
    {modal==="settings"&&<SettingsModal/>}
    {modal==="add"&&<AddFLModal/>}
    {modal==="add_tp"&&<AddTPModal/>}
    {modal==="add_st"&&<AddSTModal/>}
    {modal==="list_edit"&&<ListEditor onClose={()=>setModal("settings")} onSave={setLists} lists={lists} sendData={sendData}/>}
    <RepairModal/>
    <TPRepairModal/>
    <STRepairModal/>
    {editFL&&<EditEquipmentModal/>}
    {detailModal&&<MaintDetail type={detailModal.type} record={detailModal.record} onClose={()=>setDetailModal(null)}/>}
    {confirmDel&&<Confirm msg={confirmDel.msg} onYes={()=>{if(confirmDel.type==="Transpalet"||confirmDel.type==="Ä°stif Makinesi"||confirmDel.type==="Forklift"){deleteEquipment(confirmDel.id,confirmDel.type)}setConfirmDel(null);}} onNo={()=>setConfirmDel(null)}/>}
    {fuelModal&&<FuelTypeModal forklift={fuelModal} onClose={()=>setFuelModal(null)} onSave={()=>fetchData()} currentFuel={getFuelType(fuelModal.id)} sendData={sendData}/>}
  </div>);
}
ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
</script>
</body>
</html>