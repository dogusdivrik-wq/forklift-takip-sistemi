<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forklift BakÄ±m Sistemi Pro</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* OPUS DESIGN SYSTEM */
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e1a;--card:#131825;--border:#1e293b;--inp:#0f172a;--text:#e2e8f0;--dim:#94a3b8;--mute:#64748b;--dark:#475569;--amber:#f59e0b;--red:#ef4444;--green:#22c55e;--blue:#3b82f6}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.btn{padding:10px 16px;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-weight:700;font-size:13px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .15s}
.btn:active{transform:scale(.97)}
.btn-amber{background:var(--amber);color:#000}.btn-red{background:var(--red);color:#fff}
.btn-green{background:var(--green);color:#000}.btn-blue{background:var(--blue);color:#fff}
.btn-ghost{background:transparent;color:var(--dim);border:1px solid var(--border)}
.btn-sm{padding:6px 10px;font-size:11px;border-radius:6px}
.btn-xs{padding:4px 8px;font-size:10px;border-radius:5px}
.btn-dng{background:transparent;color:var(--red);border:1px solid #ef444440}
.inp{width:100%;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:13px;outline:none;color:white;}
.inp:focus{border-color:var(--amber)}.inp::placeholder{color:var(--dark)}
select.inp{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%2394a3b8' d='M5 7L1 3h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px}
textarea.inp{resize:vertical;min-height:80px}
.lbl{font-size:11px;color:var(--mute);font-weight:600;margin-bottom:4px;display:block;letter-spacing:.3px;text-transform:uppercase;}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
.mono{font-family:'JetBrains Mono',monospace}
.tabs{display:flex;gap:4px;background:var(--inp);border-radius:10px;padding:4px;border:1px solid var(--border);overflow-x:auto;}
.tab{flex:1;padding:8px 6px;text-align:center;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;color:var(--dim);transition:all .2s;user-select:none;white-space:nowrap;}
.tab.active{background:var(--amber);color:#000}
.chk-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--inp);border:1px solid var(--border);border-radius:8px;cursor:pointer;user-select:none}
.chk-item.done{border-color:#22c55e25;background:#22c55e08}
.chkbox{width:20px;height:20px;border-radius:5px;border:2px solid var(--dark);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chkbox.done{background:var(--green);border-color:var(--green)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.g-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;backdrop-filter:blur(3px);}
.mbody{max-width:550px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.5);}
.prog{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:8px}
.pfill{height:100%;border-radius:3px;transition:width .4s ease}
.mcard{padding:14px;background:var(--inp);border-radius:10px;border-left:3px solid}
.dr{display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.dr:last-child{border-bottom:none}
.dl{color:var(--mute);min-width:110px;font-weight:600;flex-shrink:0}
.dv{color:var(--text);flex:1}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--green);color:#000;padding:12px 24px;border-radius:12px;font-weight:700;font-size:14px;z-index:2000;box-shadow:0 4px 20px #22c55e40}
.loading-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 3000; color: white; flex-direction: column; gap: 15px; backdrop-filter: blur(5px); font-weight:700;}
.fl-filter-chip{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;user-select:none;border:1px solid var(--border);background:var(--inp);color:var(--dim);transition:all .2s;white-space:nowrap}
.fl-filter-chip.active{border-color:var(--amber);background:#f59e0b18;color:var(--amber)}
.fuel-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700}
.fuel-badge.electric{background:#a855f720;color:#c084fc;border:1px solid #a855f730}
.fuel-badge.diesel{background:#64748b20;color:#94a3b8;border:1px solid #64748b30}
.fuel-badge.gasoline{background:#f59e0b20;color:#fbbf24;border:1px solid #f59e0b30}
.fuel-badge.lpg{background:#f9731620;color:#fb923c;border:1px solid #f9731630}
.fuel-badge.hybrid{background:#22c55e20;color:#4ade80;border:1px solid #22c55e30}
@media(max-width:600px){.grid-2{grid-template-columns:1fr}.g-auto{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="app"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo,useRef,memo}=React;

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby29FSo8URGOLlHAkNUevL1SCwXtzR83Tttal0fiYluGfiNy8qYpEtu5CFokt1kRu0O/exec";

/* DEFAULT LÄ°STELER - STANDART (Dizel/Benzinli/LPG/Hibrit) */
const DEF_M250=["Motor yaÄŸÄ± seviyesini kontrol et", "YaÄŸ filtresi", "Hava filtresi", "Hidrolik yaÄŸ seviyesi", "Fren hidroliÄŸi", "Lastik basÄ±nÃ§larÄ±", "Zincir gerginliÄŸi", "Ã‡atal aÅŸÄ±nmasÄ±", "Gres yaÄŸlama", "Hidrolik hortumlar", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Egzoz sistemi", "IÅŸÄ±klar ve Korna", "Emniyet kemeri", "El freni"];
const DEF_M500=["Motor yaÄŸÄ± deÄŸiÅŸimi", "YaÄŸ filtresi deÄŸiÅŸimi", "Hava filtresi deÄŸiÅŸimi", "YakÄ±t filtresi", "Hidrolik yaÄŸ deÄŸiÅŸimi", "Hidrolik filtre", "Diferansiyel yaÄŸÄ±", "Fren balatalarÄ±", "AsansÃ¶r rulmanlarÄ±", "Motor takozlarÄ±", "AlternatÃ¶r kayÄ±ÅŸÄ±", "SoÄŸutma sistemi", "Bujiler/EnjektÃ¶rler", "TÃ¼m contalar"];
const DEF_M2000=["Motor komple bakÄ±m", "ÅanzÄ±man yaÄŸÄ± deÄŸiÅŸimi", "ÅanzÄ±man filtresi", "Diferansiyel komple bakÄ±m", "Hidrolik sistem komple bakÄ±m", "Hidrolik pompa kontrolÃ¼", "Hidrolik silindir contalarÄ±", "Direksiyon sistemi komple", "Fren sistemi komple revizyon", "Ã–n aks/Arka aks kontrolÃ¼", "AsansÃ¶r zinciri deÄŸiÅŸimi", "Ã‡atal kontrol/deÄŸiÅŸim", "TÃ¼m rulmanlar kontrol", "Elektrik sistemi komple kontrol", "MarÅŸ motoru/AlternatÃ¶r kontrol", "RadyatÃ¶r temizlik/kontrol", "Egzoz sistemi komple", "TÃ¼m hortum ve kelepÃ§eler", "Kabin/Koruma kafesi kontrol", "Genel test ve kalibrasyon"];
const DEF_WCHK=["Ã‡alÄ±ÅŸma saati", "Motor yaÄŸÄ±", "SoÄŸutma suyu", "Hidrolik yaÄŸ", "Fren testi", "Direksiyon testi", "Ã‡atallar", "Lastikler", "AydÄ±nlatma", "Korna", "Emniyet kemeri", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Genel temizlik"];

/* DEFAULT LÄ°STELER - ELEKTRÄ°KLÄ° */
const DEF_EM250=["Batarya su seviyesi kontrolÃ¼", "Batarya kutup baÅŸlarÄ± temizliÄŸi", "Åarj sistemi kontrolÃ¼", "Hidrolik yaÄŸ seviyesi", "Fren hidroliÄŸi", "Lastik basÄ±nÃ§larÄ±", "Zincir gerginliÄŸi", "Ã‡atal aÅŸÄ±nmasÄ±", "Gres yaÄŸlama", "Hidrolik hortumlar", "SÄ±zÄ±ntÄ± kontrolÃ¼", "IÅŸÄ±klar ve Korna", "Emniyet kemeri", "El freni"];
const DEF_EM500=["Batarya yoÄŸunluk testi", "Batarya baÄŸlantÄ± kontrolÃ¼", "Åarj cihazÄ± kontrolÃ¼", "Hidrolik yaÄŸ deÄŸiÅŸimi", "Hidrolik filtre", "Fren balatalarÄ±", "AsansÃ¶r rulmanlarÄ±", "Motor fÄ±rÃ§alarÄ± kontrolÃ¼", "KontaktÃ¶r kontrolÃ¼", "Kablolama kontrolÃ¼", "TÃ¼m contalar"];
const DEF_EM2000=["Batarya kapasite testi", "Batarya komple kontrol", "Elektrik motoru komple bakÄ±m", "Motor fÄ±rÃ§alarÄ± deÄŸiÅŸimi", "Kontrol Ã¼nitesi (controller) bakÄ±m", "Hidrolik sistem komple bakÄ±m", "Hidrolik pompa kontrolÃ¼", "Hidrolik silindir contalarÄ±", "Direksiyon sistemi komple", "Fren sistemi komple revizyon", "Ã–n aks/Arka aks kontrolÃ¼", "AsansÃ¶r zinciri deÄŸiÅŸimi", "Ã‡atal kontrol/deÄŸiÅŸim", "TÃ¼m rulmanlar kontrol", "TÃ¼m kablolar ve konnektÃ¶rler", "TÃ¼m hortum ve kelepÃ§eler", "Kabin/Koruma kafesi kontrol", "Genel test ve kalibrasyon"];
const DEF_EWCHK=["Ã‡alÄ±ÅŸma saati", "Batarya su seviyesi", "Batarya ÅŸarj durumu", "Hidrolik yaÄŸ", "Fren testi", "Direksiyon testi", "Ã‡atallar", "Lastikler", "AydÄ±nlatma", "Korna", "Emniyet kemeri", "SÄ±zÄ±ntÄ± kontrolÃ¼", "Genel temizlik"];

const FUELS=[{v:"diesel",l:"Dizel",e:"â›½"},{v:"gasoline",l:"Benzinli",e:"â›½"},{v:"lpg",l:"LPG",e:"ğŸ”¥"},{v:"electric",l:"Elektrikli",e:"âš¡"},{v:"hybrid",l:"Hibrit",e:"ğŸ”‹"}];
const PRIO={low:{l:"DÃ¼ÅŸÃ¼k",c:"#60a5fa"},normal:{l:"Normal",c:"#fbbf24"},high:{l:"YÃ¼ksek",c:"#f97316"},critical:{l:"Kritik",c:"#ef4444"}};

const uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);
const fd=d=>d?new Date(d).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”";
const gf=t=>FUELS.find(f=>f.v===t)||{v:"diesel",l:"Dizel",e:"â›½"};
const isElectric = (fuel) => fuel === "electric";

/* LÄ°STE YÃ–NETÄ°MÄ° (LocalStorage) */
const getSavedLists = () => {
    const s = localStorage.getItem("opus_lists");
    if(s) {
        const parsed = JSON.parse(s);
        // Geriye uyumluluk: eski kayÄ±tlarda elektrikli listeler yoksa ekle
        if(!parsed.m2000) parsed.m2000 = DEF_M2000;
        if(!parsed.em250) parsed.em250 = DEF_EM250;
        if(!parsed.em500) parsed.em500 = DEF_EM500;
        if(!parsed.em2000) parsed.em2000 = DEF_EM2000;
        if(!parsed.eweekly) parsed.eweekly = DEF_EWCHK;
        return parsed;
    }
    return { m250: DEF_M250, m500: DEF_M500, m2000: DEF_M2000, weekly: DEF_WCHK, em250: DEF_EM250, em500: DEF_EM500, em2000: DEF_EM2000, eweekly: DEF_EWCHK };
};

/* YakÄ±t tipi localStorage yÃ¶netimi */
const getFuelTypes = () => JSON.parse(localStorage.getItem("opus_fuel_types") || "{}");
const saveFuelType = (flId, fuelType) => {
    const ft = getFuelTypes();
    ft[flId] = fuelType;
    localStorage.setItem("opus_fuel_types", JSON.stringify(ft));
};
const getFuelType = (flId) => getFuelTypes()[flId] || "diesel";

/* Forklift tipine gÃ¶re doÄŸru listeyi seÃ§ */
const getListForType = (lists, maintType, fuelType) => {
    const elc = isElectric(fuelType);
    switch(maintType) {
        case 'm250': return elc ? lists.em250 : lists.m250;
        case 'm500': return elc ? lists.em500 : lists.m500;
        case 'm2000': return elc ? lists.em2000 : lists.m2000;
        case 'weekly': return elc ? lists.eweekly : lists.weekly;
        default: return [];
    }
};

/* --- BÄ°LEÅENLER --- */
const FuelBadge = ({fuelType}) => {
    const f = gf(fuelType);
    return <span className={`fuel-badge ${fuelType}`}>{f.e} {f.l}</span>;
};

const ChkList=memo(function ChkList({items,chkRef}){
  const [checks,setChecks]=useState({});
  useEffect(()=>{chkRef.current=checks;},[checks]);
  return(<div style={{display:"flex",flexDirection:"column",gap:4,maxHeight:260,overflowY:"auto",paddingRight:4}}>
  {items.map((item,i)=>(
  <div key={i} className={`chk-item${checks[i]?" done":""}`} onClick={()=>setChecks(p=>({...p,[i]:!p[i]}))}>
  <div className={`chkbox${checks[i]?" done":""}`}>{checks[i]&&"âœ“"}</div>
  <span style={{fontSize:13,color:checks[i]?"var(--text)":"var(--dim)"}}>{item}</span>
  </div>
  ))}
  </div>);
});

function QRCode({data,sz=120}){
  const url = "https://api.qrserver.com/v1/create-qr-code/?size="+sz+"x"+sz+"&data=" + encodeURIComponent(window.location.href.split('?')[0] + "?id=" + data.split('://')[1]);
  return <img src={url} style={{borderRadius:8, border:'4px solid white'}} width={sz} height={sz} alt="QR" />;
}

function Confirm({msg,onYes,onNo}){
  return(<div className="overlay" onClick={onNo}><div className="card mbody" style={{maxWidth:380,textAlign:"center"}} onClick={e=>e.stopPropagation()}>
  <p style={{fontSize:15,marginBottom:16,lineHeight:1.6}}>{msg}</p>
  <div style={{display:"flex",gap:8,justifyContent:"center"}}><button className="btn btn-red" onClick={onYes}>Evet</button><button className="btn btn-ghost" onClick={onNo}>Ä°ptal</button></div>
  </div></div>);
}

const FormTemplate = ({ title, color, items, onSubmit, sel }) => {
    const r={tech:useRef(),hours:useRef(),notes:useRef(),date:useRef()};
    const chkRef=useRef({});
    const today = new Date().toISOString().split('T')[0];

    const handle=()=>{
        const tech=r.tech.current.value.trim();
        const hours=parseFloat(r.hours.current.value);
        const date=r.date.current.value;
        if(!tech || isNaN(hours) || !date) return alert("Ä°sim, Saat ve Tarih zorunludur!");
        if(hours < sel.hours) {
            if(!confirm(`âš ï¸ UYARI: GirdiÄŸiniz saat (${hours}), forkliftin mevcut saatinden (${sel.hours}) DAHA DÃœÅÃœK.\n\nBu genelde imkansÄ±zdÄ±r. Yine de kaydetmek istiyor musunuz?`)) return;
        }
        onSubmit({tech, hours, date, notes:r.notes.current.value, chk:chkRef.current});
        r.tech.current.value=""; r.hours.current.value=""; r.notes.current.value="";
    };

    return (<div className="card">
        <h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:color}}>{title}</h3>
        <div style={{display:"flex",flexDirection:"column",gap:10}}>
            <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={today} /></div>
            <div className="grid-2">
                <div><label className="lbl">Personel</label><input ref={r.tech} className="inp" placeholder="Ad Soyad"/></div>
                <div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>
            </div>
            {items && <>
                <div style={{fontSize:12,color:"var(--dim)",fontWeight:600,marginTop:5}}>YapÄ±lacak Ä°ÅŸler</div>
                <ChkList items={items} chkRef={chkRef}/>
            </>}
            <div><label className="lbl">Notlar</label><textarea ref={r.notes} className="inp" placeholder="Detaylar..."/></div>
            <button className="btn" style={{background:color, color:color==='var(--amber)'?'black':'white', width:'100%', justifyContent:'center'}} onClick={handle}>KAYDET</button>
        </div>
    </div>);
}

const FaultForm=({sel,onSubmit})=>{
    const r={by:useRef(),hours:useRef(),prio:useRef(),desc:useRef(),date:useRef()};
    const today = new Date().toISOString().split('T')[0];
    const handle=()=>{
        const by=r.by.current.value.trim(),desc=r.desc.current.value.trim(), date=r.date.current.value;
        const hours = parseFloat(r.hours.current.value);
        if(!by||!desc||!date)return alert("Eksik bilgi.");
        if(hours < sel.hours) {
            if(!confirm(`âš ï¸ GirdiÄŸiniz saat (${hours}) mevcut saatten (${sel.hours}) dÃ¼ÅŸÃ¼k! Devam edilsin mi?`)) return;
        }
        onSubmit({by,hours,prio:r.prio.current.value,desc,date});
        r.by.current.value="";r.hours.current.value="";r.desc.current.value="";r.prio.current.value="normal";
    };
    return(<div className="card"><h3 style={{fontSize:15,fontWeight:700,marginBottom:12,color:"var(--red)"}}>ğŸ”´ ArÄ±za Bildirimi</h3>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
    <div><label className="lbl">Tarih</label><input ref={r.date} type="date" className="inp" defaultValue={today} /></div>
    <div><label className="lbl">Bildiren</label><input ref={r.by} className="inp" placeholder="Ad Soyad"/></div>
    <div className="grid-2">
        <div><label className="lbl">Saat</label><input ref={r.hours} className="inp" type="number" placeholder={sel.hours}/></div>
        <div><label className="lbl">Ã–ncelik</label><select ref={r.prio} className="inp" defaultValue="normal">{Object.entries(PRIO).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}</select></div>
    </div>
    <div><label className="lbl">AÃ§Ä±klama</label><textarea ref={r.desc} className="inp" placeholder="ArÄ±za nedir?"/></div>
    <button className="btn btn-red" style={{width:"100%",justifyContent:"center"}} onClick={handle}>ğŸ”´ ArÄ±za Bildir</button>
    </div></div>);
};

/* LÄ°STE DÃœZENLEME MODALI - ELEKTRÄ°KLÄ° LÄ°STELER EKLENDÄ° */
const ListEditor = ({ onClose, onSave }) => {
    const [lists, setLists] = useState(getSavedLists());
    const [activeTab, setActiveTab] = useState("m250");
    const [newItem, setNewItem] = useState("");
    const currentList = lists[activeTab];
    const add = () => { if(newItem){ setLists({...lists, [activeTab]: [...currentList, newItem]}); setNewItem(""); }};
    const del = (idx) => { setLists({...lists, [activeTab]: currentList.filter((_,i)=>i!==idx)}); };
    const save = () => { localStorage.setItem("opus_lists", JSON.stringify(lists)); onSave(lists); onClose(); };

    const tabDefs = [
        {k:'m250', l:'250h', icon:'â›½'},
        {k:'m500', l:'500h', icon:'â›½'},
        {k:'m2000', l:'2000h', icon:'â›½'},
        {k:'weekly', l:'AylÄ±k', icon:'â›½'},
        {k:'em250', l:'250h', icon:'âš¡'},
        {k:'em500', l:'500h', icon:'âš¡'},
        {k:'em2000', l:'2000h', icon:'âš¡'},
        {k:'eweekly', l:'AylÄ±k', icon:'âš¡'},
    ];

    return (<div className="overlay" onClick={onClose}><div className="card mbody" onClick={e=>e.stopPropagation()}>
        <h3 style={{marginBottom:6}}>ğŸ“ Kontrol Listelerini DÃ¼zenle</h3>
        
        {/* Standart Listeler */}
        <div style={{fontSize:11, color:'var(--mute)', fontWeight:700, marginTop:12, marginBottom:4, letterSpacing:1}}>â›½ STANDART (Dizel/Benzin/LPG/Hibrit)</div>
        <div className="tabs" style={{marginBottom:6}}>
            {tabDefs.filter(t=>!t.k.startsWith('e')).map(t=>(
                <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
            ))}
        </div>

        {/* Elektrikli Listeler */}
        <div style={{fontSize:11, color:'#c084fc', fontWeight:700, marginTop:8, marginBottom:4, letterSpacing:1}}>âš¡ ELEKTRÄ°KLÄ°</div>
        <div className="tabs" style={{marginBottom:10}}>
            {tabDefs.filter(t=>t.k.startsWith('e')).map(t=>(
                <div key={t.k} className={`tab ${activeTab===t.k?'active':''}`} style={activeTab===t.k?{background:'#a855f7',color:'#fff'}:{}} onClick={()=>setActiveTab(t.k)}>{t.l}</div>
            ))}
        </div>

        {/* Aktif sekme bilgisi */}
        <div style={{fontSize:12, fontWeight:700, color: activeTab.startsWith('e') ? '#c084fc' : 'var(--amber)', marginBottom:8, display:'flex', alignItems:'center', gap:6}}>
            <span>{activeTab.startsWith('e') ? 'âš¡' : 'â›½'}</span>
            <span>{activeTab.startsWith('e') ? 'Elektrikli' : 'Standart'} â€” {activeTab.replace('e','').replace('weekly','AylÄ±k').replace('m','').replace('250','250 Saat').replace('500','500 Saat').replace('2000','2000 Saat')}</span>
            <span style={{marginLeft:'auto', fontSize:11, color:'var(--dim)'}}>{currentList.length} madde</span>
        </div>

        <div style={{display:'flex', gap:5, marginBottom:10}}>
            <input className="inp" value={newItem} onChange={e=>setNewItem(e.target.value)} placeholder="Yeni madde..." onKeyDown={e=>{if(e.key==='Enter')add()}} />
            <button className="btn btn-amber" onClick={add}>+</button>
        </div>
        <div style={{maxHeight:250, overflowY:'auto'}}>
            {currentList.map((it,i)=>(<div key={i} style={{display:'flex', justifyContent:'space-between', alignItems:'center', padding:8, borderBottom:'1px solid #333'}}><span style={{fontSize:13}}>{it}</span><button style={{color:'red', background:'none', border:'none', cursor:'pointer', fontSize:14}} onClick={()=>del(i)}>ğŸ—‘</button></div>))}
            {currentList.length===0 && <div style={{padding:20, textAlign:'center', color:'var(--dark)', fontSize:13}}>Liste boÅŸ. YukarÄ±dan madde ekleyin.</div>}
        </div>
        <button className="btn btn-green" style={{width:'100%', marginTop:10, justifyContent:'center'}} onClick={save}>ğŸ’¾ KAYDET VE Ã‡IK</button>
    </div></div>);
}

/* YAKIT TÄ°PÄ° DEÄÄ°ÅTÄ°RME MODALI */
const FuelTypeModal = ({forklift, onClose, onSave}) => {
    const [selected, setSelected] = useState(getFuelType(forklift.id));
    const save = () => { saveFuelType(forklift.id, selected); onSave(); onClose(); };
    return (<div className="overlay" onClick={onClose}><div className="card mbody" style={{maxWidth:400}} onClick={e=>e.stopPropagation()}>
        <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:14}}>
            <h3 style={{fontSize:16, fontWeight:700}}>YakÄ±t Tipi DeÄŸiÅŸtir</h3>
            <button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button>
        </div>
        <div style={{fontSize:13, color:'var(--dim)', marginBottom:14}}><b style={{color:'var(--text)'}}>{forklift.name}</b> iÃ§in yakÄ±t tipini seÃ§in</div>
        <div style={{display:'flex', flexDirection:'column', gap:6}}>
            {FUELS.map(f=>(
                <div key={f.v} onClick={()=>setSelected(f.v)} 
                    style={{display:'flex', alignItems:'center', gap:10, padding:'12px 14px', borderRadius:10, cursor:'pointer', border:`2px solid ${selected===f.v?(f.v==='electric'?'#a855f7':'var(--amber)'):'var(--border)'}`, background:selected===f.v?(f.v==='electric'?'#a855f710':'#f59e0b08'):'var(--inp)', transition:'all .2s'}}>
                    <span style={{fontSize:20}}>{f.e}</span>
                    <span style={{fontWeight:700, fontSize:14, color:selected===f.v?'var(--text)':'var(--dim)'}}>{f.l}</span>
                    {selected===f.v && <span style={{marginLeft:'auto', color:f.v==='electric'?'#a855f7':'var(--amber)', fontWeight:800}}>âœ“</span>}
                </div>
            ))}
        </div>
        <div style={{marginTop:14, padding:10, borderRadius:8, background:'#f59e0b10', border:'1px solid #f59e0b20', fontSize:12, color:'var(--amber)'}}>
            âš  YakÄ±t tipi deÄŸiÅŸtirildiÄŸinde, bakÄ±m formlarÄ±ndaki kontrol listesi otomatik olarak ilgili tipe gÃ¶re deÄŸiÅŸecektir.
        </div>
        <button className="btn btn-green" style={{width:'100%', marginTop:12, justifyContent:'center'}} onClick={save}>ğŸ’¾ Kaydet</button>
    </div></div>);
};

/* ANA UYGULAMA */
function App(){
  const [data,setData]=useState({forklifts:[],faults:[],m250:[],m500:[],m2000:[],weekly:[]});
  const [lists, setLists] = useState(getSavedLists());
  const [pg,setPg]=useState("dash");
  const [sub,setSub]=useState("overview");
  const [sel,setSel]=useState(null);
  const [tab,setTab]=useState("status");
  const [modal,setModal]=useState(null);
  const [filt,setFilt]=useState("all");
  const [dateFilt, setDateFilt] = useState({start:"", end:""});
  const [detailModal,setDetailModal]=useState(null);
  const [confirmDel,setConfirmDel]=useState(null);
  const [repTgt,setRepTgt]=useState(null);
  const [toast,setToast]=useState(null);
  const [editFL,setEditFL]=useState(null);
  const [loading, setLoading]=useState(false);
  const [deletedIDs, setDeletedIDs] = useState(() => JSON.parse(localStorage.getItem('deleted_fl_ids') || "[]"));
  const [selFL, setSelFL] = useState(null);
  const [fuelModal, setFuelModal] = useState(null);
  const [fuelRefresh, setFuelRefresh] = useState(0); // YakÄ±t tipi deÄŸiÅŸince UI'Ä± tetiklemek iÃ§in

  const flRefs={name:useRef(),brand:useRef(),model:useRef(),hours:useRef(),fuel:useRef()};
  const rpRefs={by:useRef(),hours:useRef(),desc:useRef(),parts:useRef(),date:useRef()};

  const fetchData = () => {
    setLoading(true);
    fetch(GOOGLE_SCRIPT_URL + "?action=read")
      .then(r => r.json())
      .then(resp => {
        setLoading(false);
        if(resp.data) processGoogleData(resp.data);
      })
      .catch(e => { setLoading(false); showToast("BaÄŸlantÄ± hatasÄ±"); });
  };

  const processGoogleData = (rawData) => {
    const newData = { forklifts:[], faults:[], m250:[], m500:[], m2000:[], weekly:[] };
    const flMap = {};

    const repairs = rawData.filter(r => r.type === 'repair');

    rawData.forEach(row => {
      if(deletedIDs.includes(row.flId)) return;
      if(row.type === 'forklift_register') {
        flMap[row.flId] = { 
            id: row.flId, name: row.flName, brand: row.person, 
            model: row.note, hours: Number(row.hours), 
            status: 'active',
            fuel: getFuelType(row.flId) // LocalStorage'dan yakÄ±t tipini al
        };
      }
    });

    rawData.forEach(row => {
      if(deletedIDs.includes(row.flId)) return;
      if(flMap[row.flId] && Number(row.hours) > flMap[row.flId].hours) {
          flMap[row.flId].hours = Number(row.hours);
      }
      
      const checksArr = (row.checks && row.checks.trim()) ? row.checks.split(',').map(s=>s.trim()).filter(s=>s!=='') : [];

      const baseRec = {
          id: row.id, fid: row.flId, fn: row.flName,
          h: Number(row.hours), notes: row.note, dt: row.timestamp,
          done: checksArr.length,
          checksArr: checksArr
      };

      if(row.type === 'm250') newData.m250.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm250', getFuelType(row.flId)).length});
      if(row.type === 'm500') newData.m500.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm500', getFuelType(row.flId)).length});
      if(row.type === 'm2000') newData.m2000.push({...baseRec, tech: row.person, tot: getListForType(lists, 'm2000', getFuelType(row.flId)).length});
      if(row.type === 'weekly') newData.weekly.push({...baseRec, tech: row.person, tot: getListForType(lists, 'weekly', getFuelType(row.flId)).length});
      if(row.type === 'fault') {
          const isRepaired = repairs.some(rep => rep.flId === row.flId && new Date(rep.timestamp) > new Date(row.timestamp));
          const status = isRepaired ? 'closed' : 'open';
          newData.faults.push({...baseRec, desc: row.note, by: row.person, st: status, od: row.timestamp, prio:'high'});
          if(status === 'open' && flMap[row.flId]) flMap[row.flId].status = 'fault';
      }
    });

    newData.forklifts = Object.values(flMap);
    setData(newData);
  };

  const sendData = (type, payload) => {
    setLoading(true);
    const d = new FormData();
    d.append("action", "write");
    d.append("id", uid());
    d.append("type", type);
    d.append("flId", payload.flId || sel?.id);
    d.append("flName", payload.flName || sel?.name);
    d.append("person", payload.person); 
    d.append("hours", payload.hours);
    d.append("note", payload.note || payload.desc || "");
    if(payload.date) d.append("customDate", payload.date); 
    
    let chkStr = "";
    if(payload.chk) {
        // DoÄŸru listeyi seÃ§: forklift tipine gÃ¶re
        const fuelType = sel ? getFuelType(sel.id) : "diesel";
        const listArr = getListForType(lists, type, fuelType);
        chkStr = Object.keys(payload.chk).filter(k=>payload.chk[k]).map(k=>listArr[k]).join(", ");
    }
    d.append("checks", chkStr);

    fetch(GOOGLE_SCRIPT_URL, { method: "POST", body: d })
      .then(r => r.json())
      .then(resp => {
        if(resp.result === "success") {
          showToast("Kaydedildi!");
          fetchData(); setTab("status"); setModal(null); setRepTgt(null);
        } else { alert("Hata"); setLoading(false); }
      })
      .catch(e => { setLoading(false); alert("BaÄŸlantÄ± HatasÄ±"); });
  };

  useEffect(()=>{ fetchData(); 
    const p = new URLSearchParams(window.location.search);
    const qid = p.get('id');
    if(qid) setTimeout(() => { window.autoSelectId = qid; }, 2000);
  },[]);

  useEffect(() => {
    if(window.autoSelectId && data.forklifts.length > 0) {
        const f = data.forklifts.find(x => x.id === window.autoSelectId);
        if(f) { setSel(f); setPg("mob"); window.autoSelectId = null; }
    }
  }, [data]);

  const showToast=m=>{setToast(m);setTimeout(()=>setToast(null),2e3);};
  
  const gS=useCallback(f=>{
    const fuelType = getFuelType(f.id);
    const m250List = getListForType(lists, 'm250', fuelType);
    const m500List = getListForType(lists, 'm500', fuelType);
    const m2000List = getListForType(lists, 'm2000', fuelType);

    const m2=data.m250.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const m5=data.m500.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const m20=data.m2000.filter(m=>m.fid===f.id).sort((a,b)=>b.h-a.h);
    const ws=data.weekly.filter(w=>w.fid===f.id).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
    const fts=data.faults.filter(x=>x.fid===f.id);
    const opn=fts.filter(x=>x.st==="open");
    const l2h=m2[0]?.h||0,l5h=m5[0]?.h||0,l20h=m20[0]?.h||0;
    const n2=l2h+250,n5=l5h+500,n20=l20h+2000,r2=n2-f.hours,r5=n5-f.hours,r20=n20-f.hours;
    const dw=ws[0]?Math.floor((Date.now()-new Date(ws[0].dt).getTime())/864e5):999;
    return{l2:m2[0],l5:m5[0],l20:m20[0],lw:ws[0],l2h,l5h,l20h,n2,n5,n20,r2,r5,r20,o2:r2<=0,o5:r5<=0,o20:r20<=0,w2:r2>0&&r2<=30,w5:r5>0&&r5<=50,w20:r20>0&&r20<=200,dw,ow:dw>30,opn,allF:fts,inF:opn.length>0||f.status==="fault"};
  },[data,lists,fuelRefresh]);

  const deleteForklift = (id) => {
      const newDel = [...deletedIDs, id];
      setDeletedIDs(newDel);
      localStorage.setItem('deleted_fl_ids', JSON.stringify(newDel));
      fetchData();
      showToast("Forklift Gizlendi (Silindi)");
  };

  const addFL=()=>{
    const name=flRefs.name.current?.value?.trim();if(!name)return alert("Ad zorunlu.");
    const flId = "FL-"+uid();
    const fuelType = flRefs.fuel.current?.value || "diesel";
    // YakÄ±t tipini localStorage'a kaydet
    saveFuelType(flId, fuelType);
    sendData('forklift_register', {
        flId: flId, flName: name,
        person: flRefs.brand.current.value.trim(), 
        hours: parseFloat(flRefs.hours.current.value)||0,
        note: flRefs.model.current.value.trim() 
    });
  };

  const handleFaultSubmit=({by,hours,prio,desc,date})=> sendData('fault', {person:by, hours, note:desc, date});
  const handle250=({tech,hours,notes,chk,date})=> sendData('m250', {person:tech, hours, note:notes, chk, date});
  const handle500=({tech,hours,notes,chk,date})=> sendData('m500', {person:tech, hours, note:notes, chk, date});
  const handle2000=({tech,hours,notes,chk,date})=> sendData('m2000', {person:tech, hours, note:notes, chk, date});
  const handleWk=({tech,hours,notes,chk,date})=> sendData('weekly', {person:tech, hours, note:notes, chk, date});
  const doCloseFault=()=>{
    const by=rpRefs.by.current?.value?.trim(); if(!by)return alert("Ä°sim gir");
    const date = rpRefs.date.current.value;
    sendData('repair', {flId: repTgt.fid, person:by, hours: rpRefs.hours.current?.value, note: rpRefs.desc.current?.value, date});
  };

  const stats=useMemo(()=>{
    let ov=0,wr=0,ft=0;
    data.forklifts.forEach(f=>{const s=gS(f);if(s.inF)ft++;if(s.o2||s.o5||s.o20||s.ow)ov++;else if(s.w2||s.w5||s.w20)wr++;});
    return{tot:data.forklifts.length,ft,ov,wr,of:data.faults.filter(f=>f.st==="open").length};
  },[data,gS]);

  const Badge=({f})=>{const s=gS(f);
    if(s.inF)return<span className="badge" style={{background:"#ef444425",color:"#ef4444"}}>ğŸ”´ ARIZALI</span>;
    if(s.o2||s.o5||s.o20)return<span className="badge" style={{background:"#ef444418",color:"#f87171"}}>âš  GecikmiÅŸ</span>;
    if(s.w2||s.w5||s.w20)return<span className="badge" style={{background:"#f59e0b18",color:"#fbbf24"}}>â° YaklaÅŸÄ±yor</span>;
    return<span className="badge" style={{background:"#22c55e18",color:"#4ade80"}}>âœ“ Aktif</span>;
  };

  const MaintDetail=({type,record,onClose})=>{
    // Detay modalÄ±nda doÄŸru listeyi gÃ¶ster
    const fuelType = getFuelType(record.fid);
    const items = getListForType(lists, type, fuelType);
    const color=type==="m250"?"var(--amber)":type==="m500"?"var(--blue)":type==="m2000"?"#a855f7":"var(--green)";
    const doneItems = record.checksArr || [];
    return(<div className="overlay" onClick={onClose}><div className="card mbody" style={{border:`1px solid ${color}40`}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
    <h3 style={{fontSize:16,fontWeight:700,color}}>{type.toUpperCase()} DETAYI</h3><button className="btn btn-ghost btn-sm" onClick={onClose}>âœ•</button></div>
    <div style={{marginBottom:12}}>
    <div className="dr"><span className="dl">Forklift</span><span className="dv" style={{fontWeight:700}}>{record.fn} <FuelBadge fuelType={fuelType}/></span></div>
    <div className="dr"><span className="dl">Personel</span><span className="dv">{record.tech||"â€”"}</span></div>
    <div className="dr"><span className="dl">Saat</span><span className="dv mono">{record.h}h</span></div>
    <div className="dr"><span className="dl">Tarih</span><span className="dv">{fd(record.dt)}</span></div>
    {record.notes&&<div className="dr"><span className="dl">Notlar</span><span className="dv">{record.notes}</span></div>}
    </div>
    <div style={{fontSize:12,color:"var(--mute)",fontWeight:600,marginBottom:8}}>YAPILAN Ä°ÅLER ({doneItems.length}/{items.length})</div>
    <div style={{display:"flex",flexDirection:"column",gap:3,maxHeight:300,overflowY:"auto"}}>
    {items.filter(item => doneItems.includes(item)).map((item,i)=>{
    return(<div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#22c55e08",borderRadius:6,border:"1px solid #22c55e20"}}><span style={{fontSize:14}}>âœ…</span><span style={{fontSize:12,color:"var(--text)"}}>{item}</span></div>);})}
    </div></div></div>);
  };

  const DateFilterBar = () => (
      <div style={{display:'flex', gap:10, marginBottom:10, alignItems:'center', background:'var(--inp)', padding:8, borderRadius:8, flexWrap:'wrap'}}>
        <div style={{fontSize:12, fontWeight:700, color:'var(--dim)'}}>TARÄ°H FÄ°LTRESÄ°:</div>
        <input type="date" className="inp" style={{padding:5, width:'auto'}} onChange={e=>setDateFilt({...dateFilt, start:e.target.value})} />
        <span style={{color:'var(--dim)'}}>-</span>
        <input type="date" className="inp" style={{padding:5, width:'auto'}} onChange={e=>setDateFilt({...dateFilt, end:e.target.value})} />
        {(dateFilt.start||dateFilt.end) && <button className="btn btn-ghost btn-xs" onClick={()=>setDateFilt({start:"", end:""})}>Temizle</button>}
      </div>
  );

  const filterByDate = (items) => {
      if(!dateFilt.start && !dateFilt.end) return items;
      return items.filter(i => {
          const d = i.dt.split('T')[0];
          if(dateFilt.start && d < dateFilt.start) return false;
          if(dateFilt.end && d > dateFilt.end) return false;
          return true;
      });
  };

  const FlFilterBar = () => (
      <div style={{display:'flex', gap:6, marginBottom:14, flexWrap:'wrap', alignItems:'center'}}>
        <span style={{fontSize:11, color:'var(--mute)', fontWeight:700}}>FORKLÄ°FT:</span>
        <div className={`fl-filter-chip${selFL===null?' active':''}`} onClick={()=>setSelFL(null)}>TÃ¼mÃ¼</div>
        {data.forklifts.map(f=>(
            <div key={f.id} className={`fl-filter-chip${selFL===f.id?' active':''}`} onClick={()=>setSelFL(selFL===f.id?null:f.id)}>
                {isElectric(getFuelType(f.id))?'âš¡':'â›½'} {f.name}
            </div>
        ))}
      </div>
  );

  // DASHBOARD
  const Dash=()=>(
    <div style={{padding:24,maxWidth:1200,margin:"0 auto"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12,marginBottom:24}}>
        <div><h1 style={{fontSize:26,fontWeight:900}}><span style={{color:"var(--amber)"}}>âš™</span> Forklift BakÄ±m</h1><p style={{color:"var(--mute)",fontSize:13,marginTop:2}}>Ana Kontrol Paneli</p></div>
        <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
          <button className="btn btn-amber" onClick={()=>setPg("qr")}>ğŸ“± QR</button>
          <button className="btn btn-blue" onClick={()=>{setPg("mob");setSel(null)}}>ğŸ“‹ Mobil GiriÅŸ</button>
          <button className="btn btn-ghost" onClick={()=>{setEditFL(null);setModal("settings")}}>âš™ Ayarlar</button>
        </div>
      </div>
      
      <div className="g-auto" style={{marginBottom:24}}>
        {[{l:"Toplam",v:stats.tot,c:"var(--blue)"},{l:"ArÄ±zalÄ±",v:stats.ft,c:stats.ft?"var(--red)":"var(--green)"},{l:"GecikmiÅŸ",v:stats.ov,c:stats.ov?"var(--red)":"var(--green)"},{l:"YaklaÅŸan",v:stats.wr,c:stats.wr?"var(--amber)":"var(--green)"},{l:"AÃ§Ä±k ArÄ±za",v:stats.of,c:stats.of?"var(--red)":"var(--green)"}].map((s,i)=>
          <div key={i} className="card" style={{padding:14,borderLeft:`3px solid ${s.c}`}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700,textTransform:"uppercase"}}>{s.l}</div><div className="mono" style={{fontSize:26,fontWeight:800,color:s.c,marginTop:2}}>{s.v}</div></div>
        )}
      </div>

      <div className="tabs" style={{marginBottom:18,maxWidth:700}}>
        {[{k:"overview",l:"Genel BakÄ±ÅŸ"},{k:"faults",l:"ArÄ±zalar"},{k:"maint",l:"BakÄ±m KayÄ±tlarÄ±"},{k:"weekly",l:"AylÄ±k"},{k:"fleet",l:"Filo YÃ¶netimi"}].map(t=>
          <div key={t.k} className={`tab${sub===t.k?" active":""}`} onClick={()=>setSub(t.k)} style={{fontSize:12}}>{t.l}</div>
        )}
      </div>

      {data.forklifts.length>=1 && ["overview","faults","maint","weekly"].includes(sub) && <FlFilterBar />}
      {["faults","maint","weekly"].includes(sub)&&<DateFilterBar />}
      
      {sub==="overview"&&(()=>{
        const flList = selFL ? data.forklifts.filter(f=>f.id===selFL) : data.forklifts;
        if(!flList.length) return <div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>HenÃ¼z forklift yok. Ayarlardan ekleyin.</div>;
        return flList.map(f=>{const s=gS(f);const fuelType=getFuelType(f.id);return(
        <div key={f.id} className="card" style={{marginBottom:12,borderColor:s.inF?"#ef444440":s.o2||s.o5||s.o20?"#f59e0b25":undefined}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
            <div><div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}><h3 style={{fontSize:17,fontWeight:800}}>{f.name}</h3><FuelBadge fuelType={fuelType}/><span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span><Badge f={f}/></div><div style={{fontSize:12,color:"var(--dim)",marginTop:2}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div>
            <div style={{display:"flex",alignItems:"center",gap:8}}><div className="mono" style={{fontSize:22,fontWeight:800,color:"var(--amber)"}}>{f.hours}h</div></div>
          </div>
          <div className="g-auto" style={{marginTop:14}}>
            <div className="mcard" style={{borderLeftColor:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>250 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o2?"var(--red)":s.w2?"var(--amber)":"#4ade80",marginTop:3}}>{s.o2?Math.abs(s.r2)+"h GECÄ°KMÄ°Å":s.r2+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(250-Math.max(0,s.r2))/250*100)+"%",background:s.o2?"var(--red)":s.w2?"var(--amber)":"var(--green)"}}/></div></div>
            <div className="mcard" style={{borderLeftColor:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>500 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o5?"var(--red)":s.w5?"var(--amber)":"#4ade80",marginTop:3}}>{s.o5?Math.abs(s.r5)+"h GECÄ°KMÄ°Å":s.r5+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(500-Math.max(0,s.r5))/500*100)+"%",background:s.o5?"var(--red)":s.w5?"var(--amber)":"var(--green)"}}/></div></div>
            <div className="mcard" style={{borderLeftColor:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>2000 SAAT</div><div style={{fontSize:14,fontWeight:700,color:s.o20?"var(--red)":s.w20?"var(--amber)":"#4ade80",marginTop:3}}>{s.o20?Math.abs(s.r20)+"h GECÄ°KMÄ°Å":s.r20+"h kalan"}</div><div className="prog"><div className="pfill" style={{width:Math.min(100,(2000-Math.max(0,s.r20))/2000*100)+"%",background:s.o20?"var(--red)":s.w20?"var(--amber)":"var(--green)"}}/></div></div>
            <div className="mcard" style={{borderLeftColor:s.ow?"var(--red)":"var(--green)"}}><div style={{fontSize:10,color:"var(--mute)",fontWeight:700}}>AYLIK</div><div style={{fontSize:14,fontWeight:700,color:s.ow?"var(--red)":"#4ade80",marginTop:3}}>{s.ow?s.dw+" gÃ¼n gecikmiÅŸ":s.dw<999?(30-s.dw)+" gÃ¼n kalan":"YapÄ±lmadÄ±"}</div></div>
          </div>
        </div>);
      })})()}

      {sub==="faults"&&(()=>{
          let fs=data.faults.filter(f=>selFL?f.fid===selFL:true).sort((a,b)=>new Date(b.od)-new Date(a.od));
          fs = filterByDate(fs);
          if(!fs.length)return<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>ArÄ±za kaydÄ± yok</div>;
          return fs.map(f=><div key={f.id} className="card" style={{marginBottom:8,borderLeft:`3px solid ${f.st==="open"?(PRIO[f.prio]?.c||"#fbbf24"):"var(--green)"}`}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}><span style={{fontWeight:700,fontSize:14}}>{f.fn}</span><span className="badge" style={{background:f.st==="open"?"#ef444420":"#22c55e20",color:f.st==="open"?"#ef4444":"#22c55e"}}>{f.st==="open"?"ğŸ”´ AÃ‡IK":"âœ… KAPALI"}</span></div><p style={{fontSize:13,marginTop:6,lineHeight:1.5}}>{f.desc}</p><div style={{fontSize:11,color:"var(--mute)",marginTop:6}}>Bildiren: <b style={{color:"var(--dim)"}}>{f.by}</b> â€¢ Saat: {f.h}h â€¢ {fd(f.od)}</div></div><div style={{display:"flex",flexDirection:"column",gap:4}}>{f.st==="open"&&<button className="btn btn-green btn-sm" onClick={()=>setRepTgt(f)}>ğŸ”§ Kapat</button>}</div></div></div>);
      })()}

      {sub==="maint"&&<div>
        {(()=>{
            let rs=[...data.m250,...data.m500,...data.m2000].filter(m=>selFL?m.fid===selFL:true).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
            rs = filterByDate(rs);
            if(!rs.length)return<div className="card" style={{textAlign:"center",padding:24,color:"var(--dark)",marginBottom:16}}>KayÄ±t yok</div>;
            return rs.map(r=>{
                const fuelType = getFuelType(r.fid);
                const m2000Len = getListForType(lists, 'm2000', fuelType).length;
                const m500Len = getListForType(lists, 'm500', fuelType).length;
                const type=r.tot===m2000Len?"m2000":r.tot===m500Len?"m500":"m250";
                const color=type==="m2000"?"#a855f7":type==="m500"?"var(--blue)":"var(--amber)";
                const colorBg=type==="m2000"?"#a855f720":type==="m500"?"#3b82f620":"#f59e0b20";
                return<div key={r.id} className="card" style={{marginBottom:6,borderLeft:`3px solid ${color}`,cursor:"pointer"}} onClick={()=>setDetailModal({type,record:r})}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}><div><span style={{fontWeight:700}}>{r.fn}</span>{isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>}<span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>@ {r.h}h</span></div><span className="badge" style={{background:colorBg,color}}>{r.done}/{r.tot} â€” detay â†’</span></div><div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>Teknisyen: <b style={{color:"var(--dim)"}}>{r.tech}</b> â€¢ {fd(r.dt)}</div></div>;
            });
        })()}
      </div>}

      {sub==="weekly"&&(()=>{
          let ws=data.weekly.filter(w=>selFL?w.fid===selFL:true).sort((a,b)=>new Date(b.dt)-new Date(a.dt));
          ws = filterByDate(ws);
          if(!ws.length)return<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>KayÄ±t yok</div>;
          return ws.map(w=>{
              const fuelType = getFuelType(w.fid);
              return <div key={w.id} className="card" style={{marginBottom:6,borderLeft:"3px solid var(--green)",cursor:"pointer"}} onClick={()=>setDetailModal({type:"weekly",record:w})}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}><div><span style={{fontWeight:700}}>{w.fn}</span>{isElectric(fuelType)&&<span style={{marginLeft:5,fontSize:10}}>âš¡</span>}<span className="mono" style={{color:"var(--mute)",fontSize:12,marginLeft:8}}>{w.h}h</span></div><span className="badge" style={{background:"#22c55e20",color:"#4ade80"}}>{w.done}/{w.tot} â€” detay â†’</span></div><div style={{fontSize:11,color:"var(--mute)",marginTop:3}}>OperatÃ¶r: <b style={{color:"var(--dim)"}}>{w.tech}</b> â€¢ {fd(w.dt)}</div></div>;
          });
      })()}

      {sub==="fleet"&&(!data.forklifts.length?<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Forklift yok.</div>:data.forklifts.map(f=>{
          const fuelType = getFuelType(f.id);
          return <div key={f.id} className="card" style={{marginBottom:12}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
            <h3 style={{fontSize:16,fontWeight:800}}>{f.name} <FuelBadge fuelType={fuelType}/> <span className="mono" style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></h3>
            <div style={{display:"flex",gap:6}}>
                <button className="btn btn-ghost btn-sm" onClick={()=>setFuelModal(f)}>â›½ YakÄ±t Tipi</button>
                <button className="btn btn-dng btn-sm" onClick={()=>setConfirmDel({type:"forklift",id:f.id,msg:`"${f.name}" sistemden gizlenecek. Devam edilsin mi?`})}>ğŸ—‘ Sil</button>
            </div>
          </div>
          <div className="g-auto">
            <div><div className="lbl">MARKA</div><div>{f.brand||"â€”"}</div></div>
            <div><div className="lbl">MODEL</div><div>{f.model||"â€”"}</div></div>
            <div><div className="lbl">SAAT</div><div className="mono" style={{fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div></div>
            <div><div className="lbl">YAKIT TÄ°PÄ°</div><div><FuelBadge fuelType={fuelType}/></div></div>
          </div>
        </div>;
      }))}
    </div>
  );

  const QRPage=()=>(<div style={{padding:24,maxWidth:1100,margin:"0 auto"}}><div style={{display:"flex",alignItems:"center",gap:12,marginBottom:24}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setPg("dash")}>â†</button><div><h2 style={{fontSize:22,fontWeight:800}}>QR Kod / Barkod</h2><p style={{fontSize:13,color:"var(--dim)"}}>YazdÄ±rÄ±p forkliftlere yapÄ±ÅŸtÄ±rÄ±n</p></div></div>{!data.forklifts.length&&<div className="card" style={{textAlign:"center",padding:40,color:"var(--dark)"}}>Forklift yok.</div>}<div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:16}}>{data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{textAlign:"center",padding:20}}><QRCode data={`forklift://${f.id}`} sz={130}/><div style={{fontWeight:800,fontSize:16,marginTop:10}}>{f.name}</div><div style={{color:"var(--dim)",fontSize:12}}>{f.brand} {f.model}</div><div style={{marginTop:4}}><FuelBadge fuelType={fuelType}/></div><div className="mono" style={{fontSize:12,color:"var(--amber)",marginTop:3}}>{f.id}</div><button className="btn btn-ghost btn-sm" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setSel(f);setPg("mob");setTab("status")}}>Mobil AÃ§</button></div>;})}</div></div>);

  const Mobile=()=>{
    if(!sel)return(
    <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
    <div style={{textAlign:"center",marginBottom:16}}><div style={{fontSize:12,color:"var(--amber)",fontWeight:700,letterSpacing:2}}>FORKLÄ°FT BAKIM</div><h2 style={{fontSize:20,fontWeight:800,marginTop:4}}>Forklift SeÃ§in</h2></div>
    {!data.forklifts.length&&<div className="card" style={{textAlign:"center",padding:30,color:"var(--dark)"}}>HenÃ¼z forklift yok.</div>}
    {data.forklifts.map(f=>{const fuelType=getFuelType(f.id);return <div key={f.id} className="card" style={{marginBottom:8,cursor:"pointer",borderColor:gS(f).inF?"#ef444440":undefined}} onClick={()=>{setSel(f);setTab("status")}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontWeight:700,display:'flex',alignItems:'center',gap:6}}>{f.name} <FuelBadge fuelType={fuelType}/> <span style={{fontSize:11,color:"var(--mute)"}}>{f.id}</span></div><div style={{fontSize:12,color:"var(--dim)"}}>{[f.brand,f.model].filter(Boolean).join(" â€¢ ")}</div></div><div style={{textAlign:"right"}}><div className="mono" style={{fontSize:16,fontWeight:700,color:"var(--amber)"}}>{f.hours}h</div><Badge f={f}/></div></div></div>;})}
    <button className="btn btn-ghost" style={{width:"100%",justifyContent:"center",marginTop:10}} onClick={()=>{setPg("dash");setSel(null)}}>â† Ana Panel</button>
    </div>
    );

    const st=gS(sel);
    const fuelType = getFuelType(sel.id);
    const selIsElectric = isElectric(fuelType);

    return(
    <div style={{maxWidth:420,margin:"0 auto",padding:16}}>
    <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}><button className="btn btn-ghost" style={{padding:"5px 8px"}} onClick={()=>setSel(null)}>â†</button><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:800,fontSize:16}}>{sel.name}</span><FuelBadge fuelType={fuelType}/><Badge f={sel}/></div><div style={{fontSize:11,color:"var(--dim)"}}>{[sel.brand,sel.model].filter(Boolean).join(" â€¢ ")} â€¢ {sel.hours}h</div></div></div>
    <div className="tabs" style={{marginBottom:12}}>
    {[{k:"status",l:"Durum"},{k:"fault",l:"ArÄ±za"},{k:"m250",l:"250h"},{k:"m500",l:"500h"},{k:"m2000",l:"2000h"},{k:"wk",l:"AylÄ±k"}].map(t=>
    <div key={t.k} className={`tab${tab===t.k?" active":""}`} onClick={()=>setTab(t.k)}>{t.l}</div>)}
    </div>

    {tab==="status"&&<div style={{display:"flex",flexDirection:"column",gap:8}}>
        <div className="card" style={{borderLeft:`3px solid ${st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)"}`}}>
            <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>250 SAAT BAKIM</div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o2?"var(--red)":st.w2?"var(--amber)":"#4ade80"}}>{st.o2?Math.abs(st.r2)+"h":st.r2+"h"}</div><div style={{fontSize:11,color:st.o2?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o2?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l2h}h<br/>Sonraki: {st.n2}h</div></div>
            <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(250-Math.max(0,st.r2))/250*100))+"%",background:st.o2?"var(--red)":st.w2?"var(--amber)":"var(--green)"}}/></div>
        </div>
        <div className="card" style={{borderLeft:`3px solid ${st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)"}`}}>
            <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>500 SAAT BAKIM</div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o5?"var(--red)":st.w5?"var(--amber)":"#4ade80"}}>{st.o5?Math.abs(st.r5)+"h":st.r5+"h"}</div><div style={{fontSize:11,color:st.o5?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o5?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l5h}h<br/>Sonraki: {st.n5}h</div></div>
            <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(500-Math.max(0,st.r5))/500*100))+"%",background:st.o5?"var(--red)":st.w5?"var(--amber)":"var(--green)"}}/></div>
        </div>
        <div className="card" style={{borderLeft:`3px solid ${st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)"}`}}>
            <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>2000 SAAT BAKIM</div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div className="mono" style={{fontSize:22,fontWeight:800,color:st.o20?"var(--red)":st.w20?"var(--amber)":"#4ade80"}}>{st.o20?Math.abs(st.r20)+"h":st.r20+"h"}</div><div style={{fontSize:11,color:st.o20?"var(--red)":"var(--dim)",fontWeight:600}}>{st.o20?"GECÄ°KMÄ°Å!":"kalan"}</div></div><div style={{fontSize:10,color:"var(--mute)",textAlign:"right"}}>Son: {st.l20h}h<br/>Sonraki: {st.n20}h</div></div>
            <div className="prog"><div className="pfill" style={{width:Math.min(100,Math.max(0,(2000-Math.max(0,st.r20))/2000*100))+"%",background:st.o20?"var(--red)":st.w20?"var(--amber)":"var(--green)"}}/></div>
        </div>
        <div className="card" style={{borderLeft:`3px solid ${st.ow?"var(--red)":"var(--green)"}`}}>
            <div style={{fontSize:10,color:"var(--mute)",fontWeight:700,letterSpacing:1}}>AYLIK KONTROL</div>
            <div style={{fontSize:14,fontWeight:700,color:st.ow?"var(--red)":"#4ade80",marginTop:3}}>{st.ow?"âš  "+st.dw+" gÃ¼n gecikmiÅŸ":st.dw<999?(30-st.dw)+" gÃ¼n kalan":"HenÃ¼z yapÄ±lmadÄ±"}</div>
        </div>
        {st.opn.length>0&&<div className="card" style={{borderLeft:"3px solid var(--red)",background:"#ef444408"}}>
            <div style={{fontSize:10,color:"var(--red)",fontWeight:700}}>ğŸ”´ AÃ‡IK ARIZALAR ({st.opn.length})</div>
            {st.opn.map(f=><div key={f.id} style={{marginTop:6,padding:8,background:"var(--inp)",borderRadius:6,fontSize:12}}><div style={{fontWeight:600}}>{f.desc}</div><div style={{color:"var(--mute)",fontSize:11,marginTop:3}}>Bildiren: {f.by} â€¢ {fd(f.od)}</div></div>)}
        </div>}
    </div>}
    {tab==="fault"&&<FaultForm sel={sel} onSubmit={handleFaultSubmit}/>}
    {tab==="m250"&&<FormTemplate title={`250 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="var(--amber)" items={getListForType(lists,'m250',fuelType)} onSubmit={handle250} sel={sel}/>}
    {tab==="m500"&&<FormTemplate title={`500 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="var(--blue)" items={getListForType(lists,'m500',fuelType)} onSubmit={handle500} sel={sel}/>}
    {tab==="m2000"&&<FormTemplate title={`2000 SAAT BAKIM ${selIsElectric?'âš¡':''}`} color="#a855f7" items={getListForType(lists,'m2000',fuelType)} onSubmit={handle2000} sel={sel}/>}
    {tab==="wk"&&<FormTemplate title={`AYLIK KONTROL ${selIsElectric?'âš¡':''}`} color="var(--green)" items={getListForType(lists,'weekly',fuelType)} onSubmit={handleWk} sel={sel}/>}
    </div>
    );
  };

  const SettingsModal = () => (
      <div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" onClick={e=>e.stopPropagation()}>
        <h3>âš™ Ayarlar</h3>
        <div style={{display:'flex', flexDirection:'column', gap:10, marginTop:15}}>
            <button className="btn btn-blue" onClick={()=>{setModal('list_edit')}}>ğŸ“ Kontrol Listelerini DÃ¼zenle</button>
            <button className="btn btn-ghost" onClick={()=>{setModal('add')}}>+ Yeni Forklift Ekle</button>
        </div>
        <div style={{marginTop:20, fontSize:12, color:'var(--dim)', textAlign:'center'}}>Selectron v5.0 (Opus)</div>
      </div></div>
  );

  const AddFLModal=()=>{
  return(<div className="overlay" onClick={()=>setModal(null)}><div className="card mbody" style={{border:"1px solid #f59e0b30"}} onClick={e=>e.stopPropagation()}>
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:18,fontWeight:800,color:"var(--amber)"}}>Yeni Forklift Ekle</h3><button className="btn btn-ghost btn-sm" onClick={()=>setModal(null)}>âœ•</button></div>
  <div className="grid-2">
  <div><label className="lbl">Forklift AdÄ± *</label><input ref={flRefs.name} className="inp" placeholder="Ã¶r: Forklift 1"/></div>
  <div><label className="lbl">Marka</label><input ref={flRefs.brand} className="inp" placeholder="Ã¶r: Toyota"/></div>
  <div><label className="lbl">Model</label><input ref={flRefs.model} className="inp" placeholder="Ã¶r: 8FG25"/></div>
  <div><label className="lbl">Mevcut Saat</label><input ref={flRefs.hours} className="inp" type="number" placeholder="0"/></div>
  </div>
  {/* YAKIT TÄ°PÄ° SEÃ‡Ä°MÄ° */}
  <div style={{marginTop:10}}>
    <label className="lbl">YakÄ±t Tipi</label>
    <select ref={flRefs.fuel} className="inp" defaultValue="diesel">
        {FUELS.map(f=><option key={f.v} value={f.v}>{f.e} {f.l}</option>)}
    </select>
  </div>
  <button className="btn btn-amber" style={{width:"100%",justifyContent:"center",marginTop:14}} onClick={addFL}>+ Forklift Ekle</button>
  </div></div>);
  };

  const RepairModal=()=>repTgt&&(
  <div className="overlay" onClick={()=>setRepTgt(null)}><div className="card mbody" style={{border:"1px solid #22c55e30"}} onClick={e=>e.stopPropagation()}>
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h3 style={{fontSize:16,fontWeight:700,color:"#4ade80"}}>ğŸ”§ ArÄ±za Tamiri Kapat</h3><button className="btn btn-ghost btn-sm" onClick={()=>setRepTgt(null)}>âœ•</button></div>
  <div style={{padding:10,background:"var(--inp)",borderRadius:8,marginBottom:12,fontSize:13}}><div style={{fontWeight:700}}>{repTgt.fn}</div><div style={{color:"var(--dim)",marginTop:4}}>{repTgt.desc}</div></div>
  <div style={{display:"flex",flexDirection:"column",gap:10}}>
  <div><label className="lbl">Tarih</label><input ref={rpRefs.date} type="date" className="inp" defaultValue={new Date().toISOString().split('T')[0]} /></div>
  <div><label className="lbl">Tamir Eden *</label><input ref={rpRefs.by} className="inp" placeholder="Teknisyen adÄ±"/></div>
  <div><label className="lbl">Forklift Saati</label><input ref={rpRefs.hours} className="inp" type="number" placeholder="Saat"/></div>
  <div><label className="lbl">YapÄ±lan Ä°ÅŸlemler *</label><textarea ref={rpRefs.desc} className="inp" placeholder="Tamir detaylarÄ±..."/></div>
  <button className="btn btn-green" style={{width:"100%",justifyContent:"center"}} onClick={doCloseFault}>âœ… ArÄ±zayÄ± Kapat</button>
  </div>
  </div></div>
  );

  return(<div>
  {toast&&<div className="toast">{toast}</div>}
  {loading && <div className="loading-screen"><div>Ä°ÅŸleniyor...</div></div>}
  {pg==="dash"&&<Dash/>}
  {pg==="mob"&&<Mobile/>}
  {pg==="qr"&&<QRPage/>}
  {modal==="settings" && <SettingsModal />}
  {modal==="add"&&<AddFLModal/>}
  {modal==="list_edit" && <ListEditor onClose={()=>setModal("settings")} onSave={setLists} />}
  <RepairModal/>
  {detailModal&&<MaintDetail type={detailModal.type} record={detailModal.record} onClose={()=>setDetailModal(null)}/>}
  {confirmDel&&<Confirm msg={confirmDel.msg} onYes={()=>{deleteForklift(confirmDel.id); setConfirmDel(null);}} onNo={()=>setConfirmDel(null)}/>}
  {fuelModal&&<FuelTypeModal forklift={fuelModal} onClose={()=>setFuelModal(null)} onSave={()=>{setFuelRefresh(p=>p+1); fetchData();}} />}
  </div>);
}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
</script>
</body>
</html>
